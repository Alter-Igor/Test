{"version":3,"file":"createActionPlan-factory.js","names":["createModel","actionModel","actionOptions","wfModel","stepModel","self","defaults","config","description","type","mandatory","order","callToActionVar","outputVariable","outputCollection","connections","options","$","extend","ko","observable","ui","allowCta","allowMandatory","types","value","name","item","_","find","t","subscribe","validation","Validator","required","actionModelErrorCount","pureComputed","fails","callToActionVarSelector","trackVariable","outputVariableSelector","outputCollectionSelector","mustBeCollection","mustNotBeCollection","dispose"],"sources":["../../../src/WorkflowActions/CreateActionPlan/createActionPlan-factory.ts"],"sourcesContent":["ï»¿\n(function()\n{ \n    var createModel = function(actionModel:any, actionOptions:any, wfModel:any, stepModel:any)\n    {\n        // Reference self as the action model we're extending\n        var self = actionModel;\n \n        // Setup model defaults and extend from loaded config\n        var defaults =\n        {\n            // Your custom config is passed in this object\n            config:\n            {\n                description: null,         // Action plan description\n                type: \"checkbox\",        \n                mandatory: false,\n                order: 100,                // Action plan ordering\n                callToActionVar: null,     // Optional call to action to add to this item\n                outputVariable: null,      // Output variable\n                outputCollection: null,    // Output this action plan item to a list of them\n            },\n\n            // The list of connections as persisted\n            connections: {}\n        };\n        var options = $.extend(true, {}, defaults, actionOptions);\n\n        // Add this action's specific config to the model\n        self.config.description = ko.observable(options.config.description);\n        self.config.type = ko.observable(options.config.type);\n        self.config.mandatory = ko.observable(options.config.mandatory);\n        self.config.order = ko.observable(options.config.order);\n        self.config.callToActionVar = ko.observable(options.config.callToActionVar);\n        self.config.outputVariable = ko.observable(options.config.outputVariable);\n        self.config.outputCollection = ko.observable(options.config.outputCollection);\n\n        self.ui.allowCta = ko.observable();\n        self.ui.allowMandatory = ko.observable();\n\n        self.ui.types = \n        [\n            { value: \"checkbox\", name: \"Checkbox\", allowCta: true, allowMandatory: true },\n            { value: \"infobox\", name: \"Info Box\", allowCta: true, allowMandatory: false },\n            { value: \"header\", name: \"Header\", allowCta: false, allowMandatory: false }\n        ];\n\n        if (self.config.type()) {\n            var item = _.find(self.ui.types, (t:any) => { return t.value === self.config.type(); });\n\n            if (!item) {\n                self.ui.allowCta(true);\n                self.ui.allowMandatory(false);\n            } else {\n                self.ui.allowCta(item.allowCta);\n                self.ui.allowMandatory(item.allowMandatory);\n            }\n        }\n        self.config.type.subscribe(() => {\n            var item = _.find(self.ui.types, (t:any) => { return t.value === self.config.type(); });\n\n            if (!item) {\n                self.ui.allowCta(true);\n                self.ui.allowMandatory(false);\n            } else {\n                self.ui.allowCta(item.allowCta);\n                self.ui.allowMandatory(item.allowMandatory);\n            }\n        });\n\n        \n        // Extend with this action's specific validation\n        self.validation.description = Validator.required(self, self.config.description, \"Description is required\");\n        self.validation.order = Validator.required(self, self.config.order, \"Ordering is required\");\n\n        // Extend the action model with our custom model validation\n        self.actionModelErrorCount = ko.pureComputed(function()\n        {\n            var fails = 0;\n            if (self.validation.description()) fails++;\n            if (self.validation.order()) fails++;\n            return fails;\n        });\n\n        // Track variable associated with C2A\n        self.ui.callToActionVarSelector = self.trackVariable(self.config.callToActionVar, \"/Entity/Call To Action\");\n        self.ui.outputVariableSelector = self.trackVariable(self.config.outputVariable, \"/Entity/Action Plan Item\");\n        self.ui.outputCollectionSelector = self.trackVariable(self.config.outputCollection, \"/Entity/Action Plan Item\",\n            {\n                mustBeCollection: true,\n                mustNotBeCollection: false\n            });\n    };\n\n    var dispose = function(actionModel:any)\n    {\n        var self = actionModel;\n        self.ui.callToActionVarSelector.dispose();\n        self.ui.outputVariableSelector.dispose();\n        self.ui.outputCollectionSelector.dispose();\n    };\n\n    return {\n        createModel: createModel,\n        dispose: dispose\n    };\n})();"],"mappings":"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"}