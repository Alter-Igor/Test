(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{enumFields:()=>p,enumMatterDetailFields:()=>g,runMe:()=>s});var n=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}d((o=o.apply(e,t||[])).next())}))};function o(e){let t=window.document.location.origin;return-1===e.indexOf(t)&&(0!==e.indexOf("/")&&(e="/"+e),e=t+e),e}var r=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}d((o=o.apply(e,t||[])).next())}))};var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}d((o=o.apply(e,t||[])).next())}))};function l(e,t){let n={roleConfig:[],ODSEntities:[]};if(!e)return n;let o=function(e){if(!e)return;let t=Sharedo.Core.Case.Aspects.Widgets.OdsEntityPicker;return e.aspects().filter((e=>e.widget instanceof t))}(e);return null==o||o.forEach((e=>{e.widget.odsEntities().forEach((e=>{e.roleSystemName&&e.roleSystemName()===t&&n.ODSEntities.push(e)})),e.widget.options.roleConfigModels.forEach((e=>{e.roleSystemName===t&&n.roleConfig.push(e)}))})),n}function a(e,t){return i(this,void 0,void 0,(function*(){let e=yield function(e){return r(this,void 0,void 0,(function*(){try{let t="/api/ods/_search";return yield function(e,t){return n(this,void 0,void 0,(function*(){return yield $ajax.post(o(e),t)}))}(window.document.location.origin+t,e)}catch(t){console.warn("ODS Search Error",t,e)}}))}(t);return console.log("%c ODS Search Result","color: #ff0000",e),e?(console.log("%c ODS Search Result","color: #ff0000",e),function(e){try{return e.rows.map((e=>JSON.parse(e.result)))}catch(t){console.warn("ODS Helper Error trying to extract rows from search result",t,e)}return[]}(e)):(console.log("%c ODS Search Result - undefined","color: #ff0000"),[])}))}var d=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function l(e){try{d(o.next(e))}catch(e){i(e)}}function a(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}d((o=o.apply(e,t||[])).next())}))};const u="matter-partner",c="client";function s(e){var t,n,o,r;let{expertMatterNumber:i,matterDetails:l,pipelineMatter:a}=function(e){if(!e.form)throw new Error("No form");let t=e.form.fieldsById[p.matterDetails];return{expertMatterNumber:e.form.fieldsById[p.expertMatterNumber],matterDetails:t,pipelineMatter:e.form.fieldsById[p.pipelineMatter]}}(e);if(!i)throw new Error("No expertMatterNumber");if(!l)throw new Error("No matterDetails");if(!a)throw new Error("No pipelineMatter");if(window.tester=e,void 0!==e.workItemContext.id()){let i=!0;if(!(null===(n=null===(t=e.workItemContext)||void 0===t?void 0:t.phaseName())||void 0===n?void 0:n.toLowerCase().includes("draft"))&&(null===(o=e.workItemContext)||void 0===o?void 0:o.phaseName())||(i=!1),!0===i)return console.log("%c [ModuleLoader] FB_MatterDetails - exit (only run on new)","background: #222; color: #bada55",e.workItemContext.id()),console.log("%c [ModuleLoader] context.workItemContext.id() ","background: #222; color: #bada55",e.workItemContext.id()),console.log("%c [ModuleLoader] context.workItemContext?.phaseName() ","background: #222; color: #bada55",null===(r=e.workItemContext)||void 0===r?void 0:r.phaseName()),!0}return f(l,0,a),function(e,t,n,o){var r,i,l,a;if(!e.form)throw new Error("No form");null===(r=t.fieldsById[g.matterDetailsPartnerName])||void 0===r||r.on("change",(function(e){var n;console.log("%c Partner name changed to: "+(null===(n=t.fieldsById[g.matterDetailsPartnerName])||void 0===n?void 0:n.getValue()),"color: pink; font-size: 20px;")})),null===(i=e.form.fieldsById[p.expertMatterNumber])||void 0===i||i.on("change",(function(r){f(t,0,o),v(e,t,n,o)})),null===(l=e.form.fieldsById[p.pipelineMatter])||void 0===l||l.on("change",(function(r){f(t,0,o),v(e,t,n,o)})),null===(a=e.form.fieldsById[p.jurisdictionsCountry])||void 0===a||a.on("change",(function(t){var n,o,r,i;return d(this,void 0,void 0,(function*(){let t=null===(o=null===(n=e.form)||void 0===n?void 0:n.fieldsById["jurisdictions-country"])||void 0===o?void 0:o.getValue();console.log("%c Jurisdiction changed to: "+(null===(i=null===(r=e.form)||void 0===r?void 0:r.fieldsById["jurisdictions-country"])||void 0===i?void 0:i.getValue()),"color: red; font-size: 20px;");let l=e.getAspect("Sharedo.Core.Legal.Aspects.Widgets.InstructionWorkTypeDetails"),a=yield $ajax.get(`/api/v1/public/modeller/optionSets/allValues/${t}`);if(!a)return void console.log("%c [ModuleLoader] getAspect return value","background: #222; color: #bada55",a);let d=(yield $ajax.get("/api/v1/public/modeller/optionSets/jurisdictions/values")).find((e=>e.name===a.name));d?l.widget.instruction.jurisdictionId(d.id):console.log("%c [ModuleLoader] getAspect return value","background: #222; color: #bada55",d)}))}))}(e,l,i,a),function(e){var t,n;let o=new Date,r=`T${o.getFullYear()}${o.getMonth()+1}${o.getDate()}${o.getHours()}${o.getMinutes()}${o.getSeconds()}${o.getMilliseconds()}`;null===(n=null===(t=e.form)||void 0===t?void 0:t.fieldsById[p.tempMatterNumber])||void 0===n||n.setValue(r)}(e),$ui.events.broadcast("script.matterDetailsLoaded",e),!0}function f(e,t,n){!function(e,t=!0){if(!e.fields)throw new Error("No fields");if(!e.fieldsById)throw new Error("No fieldsById");e.fields.forEach((e=>{e.readonly(!t)}))}(e,n.getValue())}function m(e){var t;return d(this,void 0,void 0,(function*(){null===(t=e.fields)||void 0===t||t.forEach((function(e){e.setValue("")}))}))}function v(e,t,r,s){var f,v,y,h,w,b,x,M,N,D,S,I,C,E,P,O,B,k,V;return d(this,void 0,void 0,(function*(){let j=yield function(e){return d(this,void 0,void 0,(function*(){let t=[];if(void 0===e||0===e.length)return t;let r=yield function(e){return n(this,void 0,void 0,(function*(){return yield $ajax.get(o(e))}))}(`/api/externalMatterProvider/details/${e}`);if(console.log("%c [ModuleLoader] getMatterData return value","background: #222; color: #bada55",r),r&&r.matterCode){let e={data:r};t.push(e)}return t}))}(r.getValue());console.log(j),m(t);let $=j.find((function(e){return r.getValue()===e.data.matterCode}));if(void 0===$||!0===s.getValue())return void m(t);if(!(null===(f=t.parent)||void 0===f?void 0:f.fieldsById))throw new Error("No client");let A=null===(y=null===(v=t.parent)||void 0===v?void 0:v.fieldsById["temp-matter-number"])||void 0===y?void 0:y.getValue();void 0===A||A.length,null===(w=null===(h=e.form)||void 0===h?void 0:h.fieldsById[p.expertMatterNumberValue])||void 0===w||w.setValue((null===(b=null==$?void 0:$.data)||void 0===b?void 0:b.matterCode)||""),null===(x=t.fieldsById[g.matterDetailsClientName])||void 0===x||x.setValue((null===(N=null===(M=null==$?void 0:$.data)||void 0===M?void 0:M.client)||void 0===N?void 0:N.name)||""),null===(D=t.fieldsById[g.matterDetailsClientCode])||void 0===D||D.setValue((null===(I=null===(S=null==$?void 0:$.data)||void 0===S?void 0:S.client)||void 0===I?void 0:I.code)||""),null===(C=t.fieldsById[g.matterDetailsName])||void 0===C||C.setValue((null===(E=null==$?void 0:$.data)||void 0===E?void 0:E.shortName)||""),null===(P=t.fieldsById[g.matterDetailsPartnerName])||void 0===P||P.setValue((null===(B=null===(O=null==$?void 0:$.data)||void 0===O?void 0:O.partner)||void 0===B?void 0:B.name)||""),null===(k=t.fieldsById[g.matterDetailsIb])||void 0===k||k.setValue((null===(V=null==$?void 0:$.data)||void 0===V?void 0:V.secure)||""),console.log("matterDetails.isValid():"+t.isValid());try{!function(e,t){(function(e){return i(this,void 0,void 0,(function*(){return a(0,{startPage:1,endPage:1,rowsPerPage:10,searchString:e,odsEntityTypes:[],availability:{isAvailable:null,isOutOfOffice:null,isNotAvailable:null},location:{postcode:null,range:10},connection:{systemName:null},competencies:[],teams:[],roles:[],odsTypes:["client"],wallManagement:!1})}))})(e.data.client.code).then((e=>{let n=e[0];console.log("%c Found Client name : "+(null==n?void 0:n.name),"color: pink; font-size: 20px;",e);let o=function(e){return l(e.blade,c)}(t),r=o.roleConfig[0],i=o.ODSEntities[0];if(!r||!i)return;if(!n)return void i.selected(!1);let a=r.addService.createSelectedEntityModel(n.id,"organisation",n.name);r.addService.selectedEntity(a)}))}($,e)}catch(e){console.log("Failed to auto updating ods pickers, user required to select manually")}try{!function(e,t){e.data.partner.name.split(",")[0],function(e){return i(this,void 0,void 0,(function*(){return a(0,{startPage:1,endPage:1,rowsPerPage:10,searchString:e,odsEntityTypes:[],availability:{isAvailable:null,isOutOfOffice:null,isNotAvailable:null},location:{postcode:null,range:10},connection:{systemName:null},competencies:[],teams:[],roles:[],odsTypes:["acl","alt-ediscovery-user-type","client","department","document-training-type","employee","expert","external-team","external","pod","structural","system-administrator"],wallManagement:!1})}))}(e.data.partner.email).then((e=>{let n=e[0];console.log("%c Partner name changed to: "+(null==n?void 0:n.id),"color: pink; font-size: 20px;",n);let o=function(e){return l(e.blade,u)}(t),r=o.roleConfig[0],i=o.ODSEntities[0];if(!r||!i)return;if(!n)return void i.selected(!1);let a=r.addService.createSelectedEntityModel(n.id,"user",n.firstName+" "+n.surname);r.addService.selectedEntity(a)}))}($,e)}catch(e){console.log("Failed to auto updating ods pickers, user required to select manually")}}))}var p,g;!function(e){e.customAltEdiscoveryInstructionMatterDetails="custom-alt-ediscovery-instruction-matter-details",e.jurisdictionsCountry="jurisdictions-country",e.pipelineMatter="pipeline-matter",e.expertMatterNumber="expert-matter-number",e.expertMatterNumberValue="expert-matter-number-value",e.tempMatterNumber="temp-matter-number",e.subMatterCode="sub-matter-code",e.abcMatterNumber="abc-matter-number",e.matterDetails="matter-details"}(p||(p={})),function(e){e.matterDetailsPartnerSelector="matter-details-partner-selector",e.matterDetailsPartnerName="matter-details-partner-name",e.matterDetailsClientName="matter-details-client-name",e.matterDetailsClientCode="matter-details-client-code",e.matterDetailsPracticeArea="matter-details-practice-area",e.matterDetailsName="matter-details-name",e.matterDetailsIb="matter-details-ib"}(g||(g={})),window.FB_MatterDetails=t})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE9BQVFnRixFQUFLRyxVQUFZLElBQU1ILEVBQUtJLFNBQzFIZixFQUFjRyxXQUFXRSxlQUFlSCxFQUFPLEdBRXZELENBOURRYyxDQUEwQmxDLEVBQWdCL0QsRSxDQUU5QyxNQUFNZCxHQUVGQyxRQUFRRyxJQUFJLHdFLEtBaUhwQixJQUFZaUIsRUFnQkFXLEdBaEJaLFNBQVlYLEdBQ1IsaUdBQ0EsK0NBQ0EsbUNBQ0EsNENBQ0EsdURBQ0Esd0NBQ0Esa0NBQ0Esc0NBQ0EsZ0NBRUgsQ0FYRCxDQUFZQSxJQUFBQSxFQUFVLEtBZ0J0QixTQUFZVyxHQUNSLGlFQUNBLHlEQUNBLHVEQUNBLHVEQUNBLDJEQUNBLDBDQUNBLHFDQUNILENBUkQsQ0FBWUEsSUFBQUEsRUFBc0IsSyIsInNvdXJjZXMiOlsid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovLy8uLi8uLi9Db21tb24vYXBpL2FwaS50cyIsIndlYnBhY2s6Ly8vLi4vLi4vQ29tbW9uL09kc0hlbHBlci50cyIsIndlYnBhY2s6Ly8vLi4vLi4vQ29tbW9uL2FwaS9vZHMvc2VhcmNoLnRzIiwid2VicGFjazovLy8uL0ZCX01hdHRlckRldGFpbHMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJcbi8qKlxuICogVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBhcGkgY2FsbHMgdG8gdGhlIGJhY2tlbmQuXG4gKiB1dGlsaXNpbmcgdGhlIGF4aW9zIGxpYnJhcnkgdG8gbWFrZSB0aGUgY2FsbHMuXG4gKiBpbmNsdXNpbmcgb2Ygd2VicGFja0lnbm9yZSBpcyB0byBhbGxvdyB0aGUgd2VicGFjayB0byBpZ25vcmUgdGhlIGNhbGxzIGFuZCBub3QgdHJ5IHRvIGJ1bmRsZSB0aGVtLlxuICovXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlUG9zdDxUPihhcGk6IHN0cmluZywgcG9zdEJvZHk6IGFueSkgOiBQcm9taXNlPFQ+e1xuICAgIHJldHVybiBhd2FpdCAkYWpheC5wb3N0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSwgcG9zdEJvZHkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUdldDxUPihhcGk6IHN0cmluZykgOiBQcm9taXNlPFQ+e1xuICAgIHJldHVybiBhd2FpdCAkYWpheC5nZXQoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyB2YWxpZGF0ZUFwaShhcGkpKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVQdXQ8VD4oYXBpOiBzdHJpbmcsIHBvc3RCb2R5OiBhbnkpIDogUHJvbWlzZTxUPntcbiAgICByZXR1cm4gYXdhaXQgJGFqYXgucHV0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSwgcG9zdEJvZHkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZURlbGV0ZTxUPihhcGk6IHN0cmluZykgOiBQcm9taXNlPFQ+e1xuICAgIHJldHVybiBhd2FpdCAkYWpheC5kZWxldGUoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyB2YWxpZGF0ZUFwaShhcGkpKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVBcGkoYXBpOiBzdHJpbmcpIDogc3RyaW5ne1xuICAgbGV0IGxvY2F0aW9uPSAgd2luZG93LmRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbjtcblxuICAgLy9pZiBhcGkgZG9lcyBub3QgaW5jbHVkZSB0aGUgbG9jYXRpb24gdGhlbiBhZGQgaXQuXG4gICAgaWYoYXBpLmluZGV4T2YobG9jYXRpb24pID09PSAtMSl7XG4gICAgICAgIC8vY2hlY2sgaWYgYXBpIHN0YXJ0IHdpdGggYSAvIGlmIG5vdCBhZGQgaXQuXG4gICAgICAgIGlmKGFwaS5pbmRleE9mKFwiL1wiKSAhPT0gMCl7XG4gICAgICAgICAgICBhcGkgPSBcIi9cIiArIGFwaTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYXBpID0gbG9jYXRpb24gKyBhcGk7XG4gICAgfVxuICAgIHJldHVybiBhcGk7XG4gICAgXG59IiwiLyoqXG4gKiBUaGlzIGZpbGUgY29udGFpbnMgaGVscGVyIGZ1bmN0aW9ucyBmb3Igd29ya2luZyB3aXRoIHRoZSBPRFMgQVBJXG4gKiBfc2VhcmNoIGlzIGEgd3JhcHBlciBhcm91bmQgdGhlIE9EUyBzZWFyY2ggZW5kcG9pbnRcbiAqL1xuaW1wb3J0IHsgSUFzcGVjdCB9IGZyb20gXCIuLi8uLi9UeXBpbmdzL0FzcGVjdC9JQXNwZWN0XCI7XG5pbXBvcnQgeyBJT0RTT3JnYW5pc2F0aW9uUmVzdWx0IH0gZnJvbSBcIi4uLy4uL1R5cGluZ3MvT2RzTGlzdC9JT0RTT3JnYW5pc2F0aW9uUmVzdWx0XCI7XG5pbXBvcnQgeyBJT0RTUGVyc29uUmVzdWx0IH0gZnJvbSBcIi4uLy4uL1R5cGluZ3MvT2RzTGlzdC9JT0RTUGVvcGxlU2VhcmNoUmVzdWx0XCI7XG5pbXBvcnQgeyBJT0RTZWFyY2hSZXN1bHQgfSBmcm9tIFwiLi4vLi4vVHlwaW5ncy9PZHNMaXN0L0lPRFNTZWFyY2hSZXN1bHRcIjtcbmltcG9ydCB7IFRTaGFyZURvQmxhZGUgfSBmcm9tIFwiLi4vLi4vVHlwaW5ncy9TaGFyZURvSlMvQWRkRWRpdFNoYXJlZG9cIjtcbmltcG9ydCB7IElSb2xlQ29uZmlnTW9kZWxzIH0gZnJvbSBcIi4uLy4uL1R5cGluZ3MvV2lkZ2V0c09kc0VudGl0eVBpY2tlci9JUm9sZUNvbmZpZ01vZGVsc1wiO1xuaW1wb3J0IHsgSU9kc1dpZGdldCwgSU9kc1dpZGdldE9EU0VudGl0aWVzIH0gZnJvbSBcIi4uLy4uL1R5cGluZ3MvV2lkZ2V0c09kc0VudGl0eVBpY2tlci9JV2lkZ2V0T2RzRW50aXR5UGlja2VyXCI7XG5pbXBvcnQgeyBfc2VhcmNoIH0gZnJvbSBcIi4vYXBpL29kcy9zZWFyY2hcIjtcblxuXG4vKipcbiAqIFVzZXMgdGhlIFwiL2FwaS9vZHMvX3NlYXJjaFwiIGVuZHBvaW50IHRvIHNlYXJjaCBmb3IgdXNlcnMuXG4gKiBAcGFyYW0gc2VhcmNoIFRoZSBzZWFyY2ggc3RyaW5nIHRvIHVzZSBzdWNoIGFzIHN1cm5hbWUgb3IgZW1haWwgYWRkcmVzc1xuICogQHJldHVybnMgXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2hGb3JVc2VycyhzZWFyY2g6IHN0cmluZykgOiBQcm9taXNlPElPRFNQZXJzb25SZXN1bHRbXT5cbiB7XG4gICAgbGV0IHBvc3RCb2R5ID0ge1xuICAgICAgICBcInN0YXJ0UGFnZVwiOiAxLFxuICAgICAgICBcImVuZFBhZ2VcIjogMSxcbiAgICAgICAgXCJyb3dzUGVyUGFnZVwiOiAxMCxcbiAgICAgICAgXCJzZWFyY2hTdHJpbmdcIjogc2VhcmNoLFxuICAgICAgICBcIm9kc0VudGl0eVR5cGVzXCI6IFtdLFxuICAgICAgICBcImF2YWlsYWJpbGl0eVwiOiB7XG4gICAgICAgICAgICBcImlzQXZhaWxhYmxlXCI6IG51bGwsXG4gICAgICAgICAgICBcImlzT3V0T2ZPZmZpY2VcIjogbnVsbCxcbiAgICAgICAgICAgIFwiaXNOb3RBdmFpbGFibGVcIjogbnVsbFxuICAgICAgICB9LFxuICAgICAgICBcImxvY2F0aW9uXCI6IHtcbiAgICAgICAgICAgIFwicG9zdGNvZGVcIjogbnVsbCxcbiAgICAgICAgICAgIFwicmFuZ2VcIjogMTBcbiAgICAgICAgfSxcbiAgICAgICAgXCJjb25uZWN0aW9uXCI6IHtcbiAgICAgICAgICAgIFwic3lzdGVtTmFtZVwiOiBudWxsXG4gICAgICAgIH0sXG4gICAgICAgIFwiY29tcGV0ZW5jaWVzXCI6IFtdLFxuICAgICAgICBcInRlYW1zXCI6IFtdLFxuICAgICAgICBcInJvbGVzXCI6IFtdLFxuICAgICAgICBcIm9kc1R5cGVzXCI6IFtcbiAgICAgICAgICAgIFwiYWNsXCIsXG4gICAgICAgICAgICBcImFsdC1lZGlzY292ZXJ5LXVzZXItdHlwZVwiLFxuICAgICAgICAgICAgXCJjbGllbnRcIixcbiAgICAgICAgICAgIFwiZGVwYXJ0bWVudFwiLFxuICAgICAgICAgICAgXCJkb2N1bWVudC10cmFpbmluZy10eXBlXCIsXG4gICAgICAgICAgICBcImVtcGxveWVlXCIsXG4gICAgICAgICAgICBcImV4cGVydFwiLFxuICAgICAgICAgICAgXCJleHRlcm5hbC10ZWFtXCIsXG4gICAgICAgICAgICBcImV4dGVybmFsXCIsXG4gICAgICAgICAgICBcInBvZFwiLFxuICAgICAgICAgICAgXCJzdHJ1Y3R1cmFsXCIsXG4gICAgICAgICAgICBcInN5c3RlbS1hZG1pbmlzdHJhdG9yXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJ3YWxsTWFuYWdlbWVudFwiOiBmYWxzZVxuICAgIH07XG4gICAgcmV0dXJuIHNlYXJjaE9kc0FuZFJldHVyblJvd3M8SU9EU1BlcnNvblJlc3VsdD4oc2VhcmNoLHBvc3RCb2R5KTtcbn1cblxuLyoqXG4gKiBVc2VzIHRoZSBcIi9hcGkvb2RzL19zZWFyY2hcIiBlbmRwb2ludCB0byBzZWFyY2ggZm9yIGNsaWVudHMuXG4gKiBAcGFyYW0gc2VhcmNoIFRoZSBzZWFyY2ggc3RyaW5nIHRvIHVzZSBzdWNoIGFzIGNsaWVudCBjb2RlIG9yIG5hbWVcbiAqIEByZXR1cm5zIEEgbGlzdCBvZiBjbGllbnRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2hGb3JDbGllbnRzKHNlYXJjaDogc3RyaW5nKTogUHJvbWlzZTxJT0RTT3JnYW5pc2F0aW9uUmVzdWx0W10+IHtcblxuICAgICAgICBsZXQgcG9zdEJvZHkgPSB7XG4gICAgICAgICAgICBcInN0YXJ0UGFnZVwiOiAxLFxuICAgICAgICAgICAgXCJlbmRQYWdlXCI6IDEsXG4gICAgICAgICAgICBcInJvd3NQZXJQYWdlXCI6IDEwLFxuICAgICAgICAgICAgXCJzZWFyY2hTdHJpbmdcIjogc2VhcmNoLFxuICAgICAgICAgICAgXCJvZHNFbnRpdHlUeXBlc1wiOiBbXSxcbiAgICAgICAgICAgIFwiYXZhaWxhYmlsaXR5XCI6IHtcbiAgICAgICAgICAgICAgICBcImlzQXZhaWxhYmxlXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJpc091dE9mT2ZmaWNlXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJpc05vdEF2YWlsYWJsZVwiOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJsb2NhdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgXCJwb3N0Y29kZVwiOiBudWxsLFxuICAgICAgICAgICAgICAgIFwicmFuZ2VcIjogMTBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImNvbm5lY3Rpb25cIjoge1xuICAgICAgICAgICAgICAgIFwic3lzdGVtTmFtZVwiOiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJjb21wZXRlbmNpZXNcIjogW10sXG4gICAgICAgICAgICBcInRlYW1zXCI6IFtdLFxuICAgICAgICAgICAgXCJyb2xlc1wiOiBbXSxcbiAgICAgICAgICAgIFwib2RzVHlwZXNcIjogW1xuICAgICAgICAgICAgICAgIFwiY2xpZW50XCJcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBcIndhbGxNYW5hZ2VtZW50XCI6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZWFyY2hPZHNBbmRSZXR1cm5Sb3dzPElPRFNPcmdhbmlzYXRpb25SZXN1bHQ+KHNlYXJjaCxwb3N0Qm9keSk7XG59XG5cblxuLy8gUmVnaW9uOiBHZXQgYWxsIHJvbGUgY29uZmlnIGZvciByb2xlXG4vLyBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhbGwgdGhlIHJvbGUgY29uZmlnIGZvciBhIGdpdmVuIHJvbGVcbi8vIEl0IGlzIHVzZWQgaW4gdGhlIFwiZ2V0Um9sZUNvbmZpZ0ZvclJvbGVcIiBmdW5jdGlvbiBiZWxvd1xuLy8gdGhlIGludGVyZmFjZSBpcyB1c2VkIHRvIHJldHVybiB0aGUgcmVzdWx0cyBvZiB0aGUgZnVuY3Rpb25cblxuLyoqXG4gKiBUaGlzIGludGVyZmFjZSBpcyB1c2VkIHRvIHJldHVybiB0aGUgcmVzdWx0cyBvZiB0aGUgZnVuY3Rpb25cbiAqIEBwcm9wZXJ0eSByb2xlQ29uZmlnIC0gdGhlIHJvbGUgY29uZmlnIGZvciB0aGUgZ2l2ZW4gcm9sZVxuICogQHByb3BlcnR5IE9EU0VudGl0aWVzIC0gdGhlIE9EUyBlbnRpdGllcyBmb3IgdGhlIGdpdmVuIHJvbGVcbiAqIEJvdGggYXJlIHJldHVybmVkIGFzIGJvdGggYXJlIG5lZWRlZCB3aGVuIHVwZGF0aW5nIHRoZSB3aWRnZXRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJR2V0QWxsUm9sZUNvbmZpZ0ZvclJvbGUge1xuICAgIHJvbGVDb25maWc6IElSb2xlQ29uZmlnTW9kZWxzW10sXG4gICAgT0RTRW50aXRpZXM6IElPZHNXaWRnZXRPRFNFbnRpdGllc1tdXG59XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiByZXR1cm5zIGFsbCB0aGUgcm9sZSBjb25maWcgZm9yIGEgZ2l2ZW4gcm9sZVxuICogQHBhcmFtIGJsYWRlIFxuICogQHBhcmFtIHJvbGUgXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEFsbFJvbGVDb25maWdGb3JSb2xlKGJsYWRlOiBUU2hhcmVEb0JsYWRlIHwgdW5kZWZpbmVkLCByb2xlOiBzdHJpbmcpOiBJR2V0QWxsUm9sZUNvbmZpZ0ZvclJvbGUge1xuICAgIGxldCByZXRWYWx1ZTogSUdldEFsbFJvbGVDb25maWdGb3JSb2xlID1cbiAgICB7XG4gICAgICAgIHJvbGVDb25maWc6IFtdLFxuICAgICAgICBPRFNFbnRpdGllczogW11cbiAgICB9O1xuICAgIGlmICghYmxhZGUpIHJldHVybiByZXRWYWx1ZTtcblxuICAgIGxldCBhbGxPZHNBc3BlY3RzID0gZ2V0T2RzV2lkZ2V0cyhibGFkZSk7XG5cbiAgICAvLyBwLm9wdGlvbnMucm9sZUNvbmZpZ01vZGVscy5mb3JFYWNoKChyOmFueSkgPT4ge1xuICAgIGFsbE9kc0FzcGVjdHM/LmZvckVhY2goYSA9PiB7XG5cbiAgICAgICAgYS53aWRnZXQub2RzRW50aXRpZXMoKS5mb3JFYWNoKG9kcyA9PiB7XG4gICAgICAgICAgICBpZiAoIW9kcy5yb2xlU3lzdGVtTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9kcy5yb2xlU3lzdGVtTmFtZSgpID09PSByb2xlKSB7XG4gICAgICAgICAgICAgICAgcmV0VmFsdWUuT0RTRW50aXRpZXMucHVzaChvZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIGEud2lkZ2V0Lm9wdGlvbnMucm9sZUNvbmZpZ01vZGVscy5mb3JFYWNoKHIgPT4ge1xuICAgICAgICAgICAgaWYgKHIucm9sZVN5c3RlbU5hbWUgPT09IHJvbGUpIHtcbiAgICAgICAgICAgICAgICByZXRWYWx1ZS5yb2xlQ29uZmlnLnB1c2gocik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICB9KVxuXG4gICAgLy8gaWYoIWFsbE9kc0FzcGVjdHMpIHJldHVybiByZXRWYWx1ZTtcbiAgICAvLyBsZXQgYXNwZWN0V2l0aFBhcnRuZXIgPSBhbGxPZHNBc3BlY3RzLmZpbHRlcihhPT5hLndpZGdldC5vZHNFbnRpdGllcygpLmZpbmQoKG86YW55KT0+by5yb2xlTmFtZT09PXJvbGUpKTtcbiAgICAvLyBpZighYXNwZWN0V2l0aFBhcnRuZXIpIHJldHVybiByZXRWYWx1ZTtcblxuICAgIC8vIGZvcihsZXQgYXNwZWN0IG9mIGFzcGVjdFdpdGhQYXJ0bmVyKVxuICAgIC8vIHtcbiAgICAvLyAgICAgbGV0IG9kc1BhcnRuZXIgPSBhc3BlY3Qud2lkZ2V0Lm9kc0VudGl0aWVzKCkuZmluZCgobzphbnkpPT5vLnJvbGVOYW1lPT09cm9sZSk7XG4gICAgLy8gICAgIGlmKCFvZHNQYXJ0bmVyKSBjb250aW51ZTtcbiAgICAvLyAgICAgcmV0VmFsdWUucHVzaChvZHNQYXJ0bmVyKTtcbiAgICAvLyB9XG4gICAgcmV0dXJuIHJldFZhbHVlO1xufVxuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdGhlIHJvbGUgY29uZmlnIGZvciBhIGdpdmVuIHJvbGVcbiAqIEBwYXJhbSBibGFkZVxuICogQHBhcmFtIHJvbGVcbiAqIEByZXR1cm5zXG4qKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPZHNXaWRnZXRzKGJsYWRlOiBUU2hhcmVEb0JsYWRlKTogSUFzcGVjdDxJT2RzV2lkZ2V0PltdIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoIWJsYWRlKSByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgbGV0IHR5cGVUb0NoZWNrID0gU2hhcmVkby5Db3JlLkNhc2UuQXNwZWN0cy5XaWRnZXRzLk9kc0VudGl0eVBpY2tlcjtcblxuICAgIGxldCByZXRWYWx1ZSA9IGJsYWRlLmFzcGVjdHMoKS5maWx0ZXIoYSA9PiBhLndpZGdldCBpbnN0YW5jZW9mIHR5cGVUb0NoZWNrKTtcbiAgICByZXR1cm4gcmV0VmFsdWU7XG5cbn1cblxuLy8gI3JlZ2lvbiBHZXQgYWxsIHJvbGUgY29uZmlnIGZvciByb2xlXG4vLyAjcmVnaW9uIHByaXZhdGUgZnVuY3Rpb25zXG4vKipcbiAqIFVzZXMgdGhlIFwiL2FwaS9vZHMvX3NlYXJjaFwiIGVuZHBvaW50IHRvIHNlYXJjaCBmb3IgY2xpZW50cy5cbiAqIEBwYXJhbSBzZWFyY2ggVGhlIHNlYXJjaCBzdHJpbmcgdG8gdXNlIHN1Y2ggYXMgY2xpZW50IGNvZGUgb3IgbmFtZVxuICogQHJldHVybnMgQSBsaXN0IG9mIGNsaWVudHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoT2RzQW5kUmV0dXJuUm93czxUPihzZWFyY2g6IHN0cmluZyxwb3N0Qm9keTphbnkpOiBQcm9taXNlPFRbXT4ge1xuICAgIGxldCBBUElSZXN1bHQgPSBhd2FpdCBfc2VhcmNoPFQ+KHBvc3RCb2R5KTtcbiAgICAvL2xvZyBjb2xvclxuICAgIGNvbnNvbGUubG9nKFwiJWMgT0RTIFNlYXJjaCBSZXN1bHRcIiwgXCJjb2xvcjogI2ZmMDAwMFwiLCBBUElSZXN1bHQpO1xuICAgIGlmKCFBUElSZXN1bHQpIFxuICAgIHtcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyBPRFMgU2VhcmNoIFJlc3VsdCAtIHVuZGVmaW5lZFwiLCBcImNvbG9yOiAjZmYwMDAwXCIpO1xuICAgICAgICByZXR1cm4gW107ICBcbiAgICB9XG4gICAgY29uc29sZS5sb2coXCIlYyBPRFMgU2VhcmNoIFJlc3VsdFwiLCBcImNvbG9yOiAjZmYwMDAwXCIsIEFQSVJlc3VsdCk7XG4gICAgcmV0dXJuIGV4dHJhY3RSb3dzRnJvbU9EU1NlYXJjaFJlc3VsdHM8VD4oQVBJUmVzdWx0KTtcbiAgXG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RSb3dzRnJvbU9EU1NlYXJjaFJlc3VsdHM8VD4oIEFQSVJlc3VsdDogSU9EU2VhcmNoUmVzdWx0PFQ+KSA6IFRbXVxuIHtcbiAgICB0cnlcbiAgICB7XG4gICAgICAgIGxldCByZXRWYWx1ZSA9IEFQSVJlc3VsdC5yb3dzLm1hcChyID0+IEpTT04ucGFyc2Uoci5yZXN1bHQpKTtcbiAgICAgICAgcmV0dXJuIHJldFZhbHVlO1xuICAgIH1cbiAgICBjYXRjaChlKVxuICAgIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiT0RTIEhlbHBlciBFcnJvciB0cnlpbmcgdG8gZXh0cmFjdCByb3dzIGZyb20gc2VhcmNoIHJlc3VsdFwiLCBlLEFQSVJlc3VsdCk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbn1cblxuXG5cbi8vICNlbmRyZWdpb24gcHJpdmF0ZSBmdW5jdGlvbnMiLCJpbXBvcnQgeyBJT0RTU2VhcmNoUG9zdEJvZHkgfSBmcm9tIFwiLi4vLi4vLi4vLi4vVHlwaW5ncy9hcGkvb2RzL19zZWFyY2hcIjtcbmltcG9ydCB7IElPRFNlYXJjaFJlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi8uLi9UeXBpbmdzL09kc0xpc3QvSU9EU1NlYXJjaFJlc3VsdFwiO1xuaW1wb3J0IHsgZXhlY3V0ZVBvc3QgfSBmcm9tIFwiLi4vYXBpXCI7XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9zZWFyY2g8VD4ocG9zdEJvZHk6SU9EU1NlYXJjaFBvc3RCb2R5KSA6IFByb21pc2U8SU9EU2VhcmNoUmVzdWx0PFQ+IHwgdW5kZWZpbmVkPlxue1xuICAgIHRyeVxuICAgIHtcbiAgICAgICAgbGV0IGFwaSA9IFwiL2FwaS9vZHMvX3NlYXJjaFwiO1xuICAgICAgICByZXR1cm4gYXdhaXQgZXhlY3V0ZVBvc3Q8SU9EU2VhcmNoUmVzdWx0PFQ+Pih3aW5kb3cuZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luICsgYXBpLCBwb3N0Qm9keSk7XG4gICAgfVxuICAgIGNhdGNoIChlKVxuICAgIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiT0RTIFNlYXJjaCBFcnJvclwiLCBlLHBvc3RCb2R5KTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuIiwiXG5pbXBvcnQgeyBJRm9ybUJ1aWxkZXJDb250ZXh0IH0gZnJvbSBcIi4uLy4uLy4uLy4uL1R5cGluZ3MvRm9ybUJ1aWxkZXIvSUZvcm1CdWlsZGVyQ29udGV4dFwiO1xuaW1wb3J0IHsgSVNoYXJlRG9PcHRpb25TZXQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vVHlwaW5ncy9PcHRpb25TZXRzL0lTaGFyZURvT3B0aW9uU2V0XCI7XG5pbXBvcnQgeyBJT2RzRW50aXR5IH0gZnJvbSBcIi4uLy4uLy4uLy4uL1R5cGluZ3MvV2lkZ2V0c09kc0VudGl0eVBpY2tlci9JT2RzRW50aXR5XCI7XG5pbXBvcnQgeyAgZ2V0QWxsUm9sZUNvbmZpZ0ZvclJvbGUsIHNlYXJjaEZvckNsaWVudHMsIHNlYXJjaEZvclVzZXJzIH0gZnJvbSBcIi4uLy4uLy4uL0NvbW1vbi9PZHNIZWxwZXJcIjtcbmltcG9ydCB7IGV4ZWN1dGVHZXQgfSBmcm9tIFwiLi4vLi4vLi4vQ29tbW9uL2FwaS9hcGlcIjtcbmltcG9ydCB7IEZvcm1CdWlsZGVyIH0gZnJvbSBcIi4uLy4uLy4uL01vZHVsZUxvYWRlci9BbHBoYWNhQWRhcHRlclwiO1xuaW1wb3J0IHsgSUV4cGVydE1hdHRlciB9IGZyb20gXCIuLi9UeXBpbmdzL0lFeHBlcnRNYXR0ZXJEYXRhXCI7XG5cbnR5cGUgT2RzV2lkZ2V0ID0ge1xuICAgIFtrZXk6c3RyaW5nXTogYW55XG59O1xuXG4vL2NvbnN0YW50cyBcbmNvbnN0IG1hdHRlclBhcnRuZXJSb2xlU3lzdGVtTmFtZSA9IFwibWF0dGVyLXBhcnRuZXJcIjtcbmNvbnN0IGNsaWVudFJvbGVTeXN0ZW1OYW1lID0gXCJjbGllbnRcIjtcblxuLy9UaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBmcm9tIHRoZSBtb2R1bGUtbG9hZGVyIHdlYmNvbXBvbmVudCBpbiB0aGUgZm9ybSBidWlsZGVyXG5leHBvcnQgZnVuY3Rpb24gcnVuTWUoY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dCkgOiBib29sZWFuIHtcbiAgIFxuICAgIGxldCB7IGV4cGVydE1hdHRlck51bWJlciwgbWF0dGVyRGV0YWlscywgcGlwZWxpbmVNYXR0ZXIgfSA9IGNyZWF0ZVZhcmlhYmxlcyhjb250ZXh0KTtcblxuICAgIGlmKCFleHBlcnRNYXR0ZXJOdW1iZXIpIHRocm93IG5ldyBFcnJvcihcIk5vIGV4cGVydE1hdHRlck51bWJlclwiKTtcbiAgICBpZighbWF0dGVyRGV0YWlscykgdGhyb3cgbmV3IEVycm9yKFwiTm8gbWF0dGVyRGV0YWlsc1wiKTtcbiAgICBpZighcGlwZWxpbmVNYXR0ZXIpIHRocm93IG5ldyBFcnJvcihcIk5vIHBpcGVsaW5lTWF0dGVyXCIpO1xuICAgIFxuICAgICh3aW5kb3cgYXMgYW55KS50ZXN0ZXIgPSBjb250ZXh0OyAvL2p1c3QgZm9yIGRlYnVnZ2luZ1xuICAgIFxuICAgIGlmKGNvbnRleHQud29ya0l0ZW1Db250ZXh0LmlkKCkgIT09IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICAgIGxldCBleGl0ID0gdHJ1ZTtcbiAgICAgICAgLy9pZiB0aGUgd29yayBpdGVtIGlzIG5ldyBvciBpbiBkcmFmdCBkb250IGV4aXRcbiAgICAgICAgaWYoY29udGV4dC53b3JrSXRlbUNvbnRleHQ/LnBoYXNlTmFtZSgpPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZHJhZnRcIikgfHwgIWNvbnRleHQud29ya0l0ZW1Db250ZXh0Py5waGFzZU5hbWUoKSlcbiAgICAgICAge1xuICAgICAgICAgICAgZXhpdCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihleGl0PT09dHJ1ZSlcbiAgICAgICAge1xuICAgICAgICAgICAgIC8vb25seSBydW4gdGhpcyBjb2RlIGlmIHRoZSB3b3JrIGl0ZW0gaXMgbmV3XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjIFtNb2R1bGVMb2FkZXJdIEZCX01hdHRlckRldGFpbHMgLSBleGl0IChvbmx5IHJ1biBvbiBuZXcpXCIsIFwiYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTVcIiwgY29udGV4dC53b3JrSXRlbUNvbnRleHQuaWQoKSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjIFtNb2R1bGVMb2FkZXJdIGNvbnRleHQud29ya0l0ZW1Db250ZXh0LmlkKCkgXCIsIFwiYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTVcIiwgY29udGV4dC53b3JrSXRlbUNvbnRleHQuaWQoKSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjIFtNb2R1bGVMb2FkZXJdIGNvbnRleHQud29ya0l0ZW1Db250ZXh0Py5waGFzZU5hbWUoKSBcIiwgXCJiYWNrZ3JvdW5kOiAjMjIyOyBjb2xvcjogI2JhZGE1NVwiLCBjb250ZXh0LndvcmtJdGVtQ29udGV4dD8ucGhhc2VOYW1lKCkpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoaWRlU2hvd01hdHRlckRldGFpbHMobWF0dGVyRGV0YWlscywgZXhwZXJ0TWF0dGVyTnVtYmVyLCBwaXBlbGluZU1hdHRlcik7XG4gICAgLy9hZGQgYSBjaGFuZ2UgZXZlbnQgdG8gdGhlIGV4cGVydC1tYXR0ZXItbnVtYmVyXG4gICAgYWRkRXZlbnRIYW5kbGVycyhjb250ZXh0LCBtYXR0ZXJEZXRhaWxzLCBleHBlcnRNYXR0ZXJOdW1iZXIsIHBpcGVsaW5lTWF0dGVyKTtcbiAgICBnZW5lcmF0ZVRlbXBNYXR0ZXJOdW1iZXIoY29udGV4dCk7XG5cbiAgICAkdWkuZXZlbnRzLmJyb2FkY2FzdChcInNjcmlwdC5tYXR0ZXJEZXRhaWxzTG9hZGVkXCIsIGNvbnRleHQpO1xuICAgIHJldHVybiB0cnVlO1xufVxuXG4vLyBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdmFyaWFibGVzIGZvciB0aGUgZm9ybS5cbmZ1bmN0aW9uIGNyZWF0ZVZhcmlhYmxlcyhjb250ZXh0OiBJRm9ybUJ1aWxkZXJDb250ZXh0KSB7XG4gICAgLy8gR2V0IHRoZSBmaWVsZHNcbiAgICAvLyBsZXQgbWF0dGVyRGV0YWlscyA9IGNvbnRleHQuZmllbGRzW2VudW1GaWVsZHMubWF0dGVyRGV0YWlsc107XG5cbiAgICBpZighY29udGV4dC5mb3JtKSB0aHJvdyBuZXcgRXJyb3IoXCJObyBmb3JtXCIpO1xuXG4gICAgbGV0IG1hdHRlckRldGFpbHMgPSBjb250ZXh0LmZvcm0uZmllbGRzQnlJZFtlbnVtRmllbGRzLm1hdHRlckRldGFpbHNdOyBcbiAgICBsZXQgZXhwZXJ0TWF0dGVyTnVtYmVyID0gY29udGV4dC5mb3JtLmZpZWxkc0J5SWRbZW51bUZpZWxkcy5leHBlcnRNYXR0ZXJOdW1iZXJdO1xuICAgIGxldCBwaXBlbGluZU1hdHRlciA9IGNvbnRleHQuZm9ybS5maWVsZHNCeUlkW2VudW1GaWVsZHMucGlwZWxpbmVNYXR0ZXJdO1xuICAgIFxuXG4gICAgLy8gUmV0dXJuIHRoZSB2YXJpYWJsZXNcbiAgICByZXR1cm4geyBleHBlcnRNYXR0ZXJOdW1iZXIsIG1hdHRlckRldGFpbHMsIHBpcGVsaW5lTWF0dGVyIH07XG59XG5cbmZ1bmN0aW9uIGFkZEV2ZW50SGFuZGxlcnMoY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dCwgbWF0dGVyRGV0YWlsczogRm9ybUJ1aWxkZXIsIGV4cGVydE1hdHRlck51bWJlcjogRm9ybUJ1aWxkZXIsIHBpcGVsaW5lTWF0dGVyOiBGb3JtQnVpbGRlcikge1xuICAgIGlmKCFjb250ZXh0LmZvcm0pIHRocm93IG5ldyBFcnJvcihcIk5vIGZvcm1cIik7XG4gICAgLy9hZGQgZXZlbnQgaGFuZGxldCBmb3IgZXhwZXJ0LW1hdHRlci1udW1iZXIgY2hhbmdlZFxuICAgIG1hdHRlckRldGFpbHMuZmllbGRzQnlJZFtlbnVtTWF0dGVyRGV0YWlsRmllbGRzLm1hdHRlckRldGFpbHNQYXJ0bmVyTmFtZV0/Lm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICh0aGlzOiBhbnksIGV2OiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyBQYXJ0bmVyIG5hbWUgY2hhbmdlZCB0bzogXCIgKyBtYXR0ZXJEZXRhaWxzLmZpZWxkc0J5SWRbZW51bU1hdHRlckRldGFpbEZpZWxkcy5tYXR0ZXJEZXRhaWxzUGFydG5lck5hbWVdPy5nZXRWYWx1ZSgpLCBcImNvbG9yOiBwaW5rOyBmb250LXNpemU6IDIwcHg7XCIpO1xuICAgIH0pO1xuXG4gICAgLy9hZGQgZXZlbnQgaGFuZGxldCBmb3IgZXhwZXJ0LW1hdHRlci1udW1iZXIgY2hhbmdlZFxuICAgIGNvbnRleHQuZm9ybS5maWVsZHNCeUlkW2VudW1GaWVsZHMuZXhwZXJ0TWF0dGVyTnVtYmVyXT8ub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKHRoaXM6IGFueSwgZXY6IGFueSkge1xuICAgICAgICAvLyBoaWRlIG9yIHNob3cgdGhlIG1hdHRlciBkZXRhaWxzIGZpZWxkXG4gICAgICAgIGhpZGVTaG93TWF0dGVyRGV0YWlscyhtYXR0ZXJEZXRhaWxzLCBleHBlcnRNYXR0ZXJOdW1iZXIsIHBpcGVsaW5lTWF0dGVyKTtcbiAgICAgICAgLy8gdXBkYXRlIHRoZSBtYXR0ZXIgZGV0YWlscyBmaWVsZFxuICAgICAgICB1cGRhdGVNYXR0ZXJEZXRhaWxzKGNvbnRleHQsbWF0dGVyRGV0YWlscywgZXhwZXJ0TWF0dGVyTnVtYmVyLCBwaXBlbGluZU1hdHRlcik7XG4gICAgfSk7XG5cbiAgICAvL2FkZCBldmVudCBoYW5kbGV0IGZvciBwaXBlbGluZS1tYXR0ZXIgY2hhbmdlZFxuICAgIGNvbnRleHQuZm9ybS5maWVsZHNCeUlkW2VudW1GaWVsZHMucGlwZWxpbmVNYXR0ZXJdPy5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAodGhpczogYW55LCBldjogYW55KSB7XG4gICAgICAgIC8vIGhpZGUgb3Igc2hvdyB0aGUgbWF0dGVyIGRldGFpbHMgZmllbGRcbiAgICAgICAgaGlkZVNob3dNYXR0ZXJEZXRhaWxzKG1hdHRlckRldGFpbHMsIGV4cGVydE1hdHRlck51bWJlciwgcGlwZWxpbmVNYXR0ZXIpO1xuICAgICAgICAvLyB1cGRhdGUgdGhlIG1hdHRlciBkZXRhaWxzIGZpZWxkXG4gICAgICAgIHVwZGF0ZU1hdHRlckRldGFpbHMoY29udGV4dCxtYXR0ZXJEZXRhaWxzLCBleHBlcnRNYXR0ZXJOdW1iZXIsIHBpcGVsaW5lTWF0dGVyKTsgXG4gICAgfSk7XG5cbiAgICAvL2FkZCBldmVudCBoYW5kbGV0IGZvciBqdXJpc2RpY3Rpb24gY2hhbmdlZFxuICAgIC8vdXBkYXRlIHRoZSBPT0IgSnVyaXNkaWN0aW9uIGFzcGVjdCBmaWVsZCBhbmQgZm9ybWJ1aWxkZXIgZmllbGRzXG4gICAgY29udGV4dC5mb3JtLmZpZWxkc0J5SWRbZW51bUZpZWxkcy5qdXJpc2RpY3Rpb25zQ291bnRyeV0/Lm9uKFwiY2hhbmdlXCIsIGFzeW5jIGZ1bmN0aW9uICh0aGlzOiBhbnksIGV2OiBhbnkpIHtcbiAgICAgICAgLy91cGRhdGUgYmxhZGUganVyaXNkaWN0aW9uICAgICBcbiAgICAgICAgbGV0IHNlbGVjdGVkSWQgPSBjb250ZXh0LmZvcm0/LmZpZWxkc0J5SWRbXCJqdXJpc2RpY3Rpb25zLWNvdW50cnlcIl0/LmdldFZhbHVlKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiJWMgSnVyaXNkaWN0aW9uIGNoYW5nZWQgdG86IFwiICsgY29udGV4dC5mb3JtPy5maWVsZHNCeUlkW1wianVyaXNkaWN0aW9ucy1jb3VudHJ5XCJdPy5nZXRWYWx1ZSgpLCBcImNvbG9yOiByZWQ7IGZvbnQtc2l6ZTogMjBweDtcIik7XG4gICAgICAgIGxldCBhc3BlY3QgPSBjb250ZXh0LmdldEFzcGVjdChcIlNoYXJlZG8uQ29yZS5MZWdhbC5Bc3BlY3RzLldpZGdldHMuSW5zdHJ1Y3Rpb25Xb3JrVHlwZURldGFpbHNcIik7XG4gICAgICAgIGxldCBzZWxlY3RlZEp1cmlzZGljdGlvbkNvdW50cnkgPSBhd2FpdCAkYWpheC5nZXQoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqL2AvYXBpL3YxL3B1YmxpYy9tb2RlbGxlci9vcHRpb25TZXRzL2FsbFZhbHVlcy8ke3NlbGVjdGVkSWR9YCkgYXMgSVNoYXJlRG9PcHRpb25TZXQ7XG4gICAgICAgIGlmICghc2VsZWN0ZWRKdXJpc2RpY3Rpb25Db3VudHJ5KSB7XG4gICAgICAgICAgICAvL2xvZyBpc3N1ZVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCIlYyBbTW9kdWxlTG9hZGVyXSBnZXRBc3BlY3QgcmV0dXJuIHZhbHVlXCIsIFwiYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTVcIiwgc2VsZWN0ZWRKdXJpc2RpY3Rpb25Db3VudHJ5KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3B0aW9ucyA9IGF3YWl0ICRhamF4LmdldCgvKiB3ZWJwYWNrSWdub3JlOiB0cnVlICovYC9hcGkvdjEvcHVibGljL21vZGVsbGVyL29wdGlvblNldHMvanVyaXNkaWN0aW9ucy92YWx1ZXNgKTtcbiAgICAgICAgbGV0IHNlbGVjdGVkSnVyaXNkaWN0aW9uID0gb3B0aW9ucy5maW5kKChvcHRpb246IElTaGFyZURvT3B0aW9uU2V0KSA9PiBvcHRpb24ubmFtZSA9PT0gc2VsZWN0ZWRKdXJpc2RpY3Rpb25Db3VudHJ5Lm5hbWUpO1xuICAgICAgICBpZiAoIXNlbGVjdGVkSnVyaXNkaWN0aW9uKSB7XG4gICAgICAgICAgICAvL2xvZyBpc3N1ZVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCIlYyBbTW9kdWxlTG9hZGVyXSBnZXRBc3BlY3QgcmV0dXJuIHZhbHVlXCIsIFwiYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTVcIiwgc2VsZWN0ZWRKdXJpc2RpY3Rpb24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFzcGVjdC53aWRnZXQuaW5zdHJ1Y3Rpb24uanVyaXNkaWN0aW9uSWQoc2VsZWN0ZWRKdXJpc2RpY3Rpb24uaWQpO1xuICAgIH0pO1xufVxuXG4vLyBoaWRlIG9yIHNob3cgdGhlIG1hdHRlciBkZXRhaWxzIGZpZWxkXG5mdW5jdGlvbiBoaWRlU2hvd01hdHRlckRldGFpbHMobWF0dGVyRGV0YWlsczogRm9ybUJ1aWxkZXIgLCBleHBlcnRNYXR0ZXJOdW1iZXI6IEZvcm1CdWlsZGVyLCBwaXBlbGluZU1hdHRlcjogRm9ybUJ1aWxkZXIpIHtcbiAgICBzZXRNYXR0ZXJEZXRhaWxzU3RhdGUobWF0dGVyRGV0YWlscywgcGlwZWxpbmVNYXR0ZXIuZ2V0VmFsdWUoKSk7XG59XG5cbi8vIG1ha2UgYWxsIGNoaWxkIHByb3BlcnRpZXMgcmVhZG9ubHlcbmZ1bmN0aW9uIHNldE1hdHRlckRldGFpbHNTdGF0ZShtYXR0ZXJEZXRhaWxzOiBGb3JtQnVpbGRlciwgc3RhdHVzOiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGlmKCFtYXR0ZXJEZXRhaWxzLmZpZWxkcykgdGhyb3cgbmV3IEVycm9yKFwiTm8gZmllbGRzXCIpO1xuICAgIGlmKCFtYXR0ZXJEZXRhaWxzLmZpZWxkc0J5SWQpIHRocm93IG5ldyBFcnJvcihcIk5vIGZpZWxkc0J5SWRcIik7XG4gICAgLy8gZ2V0IGFsbCB0aGUgY2hpbGQgcHJvcGVydGllc1xuICAgIG1hdHRlckRldGFpbHMuZmllbGRzLmZvckVhY2goY2hpbGQgPT5cbiAgICB7XG4gICAgICAgIC8vIHNldCB0aGUgcmVhZG9ubHkgc3RhdHVzIG9mIHRoZSBjaGlsZCBwcm9wZXJ0eVxuICAgICAgICBjaGlsZC5yZWFkb25seSghc3RhdHVzKTtcbiAgICB9KTtcbn1cblxuLy8gY2xlYXIgYWxsIHRoZSBjaGlsZCBwcm9wZXJ0aWVzIG9mIHRoZSBtYXR0ZXIgZGV0YWlscyBzdWIgYXJlYSBvZiB0aGUgZm9ybSBidWlsZGVyXG5hc3luYyBmdW5jdGlvbiBjbGVhck1hdHRlckRldGFpbHMobWF0dGVyRGV0YWlsczogRm9ybUJ1aWxkZXIpIHtcbiAgICBtYXR0ZXJEZXRhaWxzLmZpZWxkcz8uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQ6IGFueSkge1xuICAgICAgICBjaGlsZC5zZXRWYWx1ZShcIlwiKTtcbiAgICB9KTsgXG59XG5cblxuLyogXG4xLiBXZSBmaXJzdCBnZXQgdGhlIGRhdGEgZnJvbSB0aGUgZW5kcG9pbnQgYnkgY2FsbGluZyBnZXRNYXR0ZXJEYXRhKCkgZnVuY3Rpb25cbjIuIFRoZW4gd2UgY2xlYXIgdGhlIG1hdHRlckRldGFpbHNcbjMuIFdlIGZpbmQgdGhlIHNlbGVjdGVkIG1hdHRlciBieSB1c2luZyB0aGUgbWF0dGVyIGNvZGUgYW5kIGNsaWVudCBjb2RlIGZyb20gdGhlIGRhdGEgd2UgZ290IGZyb20gdGhlIGVuZHBvaW50XG40LiBJZiB0aGUgbWF0dGVyIGlzIHVuZGVmaW5lZCwgd2UgY2xlYXIgdGhlIG1hdHRlckRldGFpbHMgYW5kIHJldHVyblxuNS4gSWYgdGhlIG1hdHRlciBpcyBub3QgdW5kZWZpbmVkLCB3ZSBzZXQgdGhlIHZhbHVlcyBvZiB0aGUgbWF0dGVyRGV0YWlscyBmaWVsZHMgKi9cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZU1hdHRlckRldGFpbHMoY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dCxtYXR0ZXJEZXRhaWxzOiBGb3JtQnVpbGRlciwgZXhwZXJ0TWF0dGVyTnVtYmVyOiBGb3JtQnVpbGRlciwgcGlwZWxpbmVNYXR0ZXI6IEZvcm1CdWlsZGVyKSB7XG5cbiAgICBcbiAgICBsZXQgZGF0YSA9IGF3YWl0IGdldE1hdHRlckRhdGEoZXhwZXJ0TWF0dGVyTnVtYmVyLmdldFZhbHVlKCkpO1xuICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgIGNsZWFyTWF0dGVyRGV0YWlscyhtYXR0ZXJEZXRhaWxzKTsgLy9jbGVhciB0aGUgbWF0dGVyIGRldGFpbHMgZm9ybVxuICAgIGxldCBzZWxlY3RlZE1hdHRlciA9IGRhdGEuZmluZChmdW5jdGlvbiAobWF0dGVyOiBhbnkpIHtcbiAgICAgICAgLy9zZXQgdGhlIGRpc3BsYXkgcG9ydGlvbiBvZiB0aGUgZXhwZXJ0LW1hdHRlci1udW1iZXIgZmllbGRcbiAgICAgICAvLyByZXR1cm4gZXhwZXJ0TWF0dGVyTnVtYmVyLmdldFZhbHVlKCkgPT09IGAke21hdHRlci5kYXRhLm1hdHRlckNvZGV9IC0gJHttYXR0ZXIuZGF0YS5jbGllbnQubmFtZX1gO1xuICAgICAgIHJldHVybiBleHBlcnRNYXR0ZXJOdW1iZXIuZ2V0VmFsdWUoKSA9PT0gbWF0dGVyLmRhdGEubWF0dGVyQ29kZTtcbiAgICAgICAgXG4gICAgfSk7XG5cbiAgICBpZiAoc2VsZWN0ZWRNYXR0ZXIgPT09IHVuZGVmaW5lZCB8fCBwaXBlbGluZU1hdHRlci5nZXRWYWx1ZSgpID09PSB0cnVlKSB7IC8vaWYgdGhlIG1hdHRlciBpcyBub3QgZm91bmQgb3IgaWYgdGhlIG1hdHRlciBpcyBhIHBpcGVsaW5lIG1hdHRlciwgY2xlYXIgdGhlIG1hdHRlciBkZXRhaWxzIGZvcm0gYW5kIHJldHVyblxuICAgICAgICBjbGVhck1hdHRlckRldGFpbHMobWF0dGVyRGV0YWlscyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZighbWF0dGVyRGV0YWlscy5wYXJlbnQ/LmZpZWxkc0J5SWQpIHRocm93IG5ldyBFcnJvcihcIk5vIGNsaWVudFwiKTtcbiAgICBsZXQgdGVtcE1hdHRlck51bWJlciA9IG1hdHRlckRldGFpbHMucGFyZW50Py5maWVsZHNCeUlkWyd0ZW1wLW1hdHRlci1udW1iZXInXT8uZ2V0VmFsdWUoKTtcblxuICAgIGlmICh0ZW1wTWF0dGVyTnVtYmVyID09PSB1bmRlZmluZWQgfHwgdGVtcE1hdHRlck51bWJlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gbWF0dGVyRGV0YWlscy5wYXJlbnQuY2hpbGRyZW5CeVByb3BlcnR5SWRbJ3RlbXAtbWF0dGVyLW51bWJlciddLnNldFZhbHVlKFwiTi9BXCIpO1xuICAgIH1cblxuICAgICAvL3NldCB0aGUgdmFsdWUgcG9ydGlvbiBvZiB0aGUgZXhwZXJ0LW1hdHRlci1udW1iZXIgZmllbGRcbiAgICAgY29udGV4dC5mb3JtPy5maWVsZHNCeUlkW2VudW1GaWVsZHMuZXhwZXJ0TWF0dGVyTnVtYmVyVmFsdWVdPy5zZXRWYWx1ZShzZWxlY3RlZE1hdHRlcj8uZGF0YT8ubWF0dGVyQ29kZSB8fCBcIlwiKTtcbiAgICAgICBcblxuICAgIG1hdHRlckRldGFpbHMuZmllbGRzQnlJZFtlbnVtTWF0dGVyRGV0YWlsRmllbGRzLm1hdHRlckRldGFpbHNDbGllbnROYW1lXT8uc2V0VmFsdWUoc2VsZWN0ZWRNYXR0ZXI/LmRhdGE/LmNsaWVudD8ubmFtZSB8fCBcIlwiKTtcbiAgICBtYXR0ZXJEZXRhaWxzLmZpZWxkc0J5SWRbZW51bU1hdHRlckRldGFpbEZpZWxkcy5tYXR0ZXJEZXRhaWxzQ2xpZW50Q29kZV0/LnNldFZhbHVlKHNlbGVjdGVkTWF0dGVyPy5kYXRhPy5jbGllbnQ/LmNvZGUgfHwgXCJcIik7XG4gICAvLyBtYXR0ZXJEZXRhaWxzLmZpZWxkc0J5SWRbZW51bU1hdHRlckRldGFpbEZpZWxkcy5tYXR0ZXJEZXRhaWxzUHJhY3RpY2VBcmVhXT8uc2V0VmFsdWUoc2VsZWN0ZWRNYXR0ZXI/LmRhdGE/LnByYWN0aWNlQXJlYT8ubmFtZSB8fCBcIlwiKTtcbiAgICBtYXR0ZXJEZXRhaWxzLmZpZWxkc0J5SWRbZW51bU1hdHRlckRldGFpbEZpZWxkcy5tYXR0ZXJEZXRhaWxzTmFtZV0/LnNldFZhbHVlKHNlbGVjdGVkTWF0dGVyPy5kYXRhPy5zaG9ydE5hbWUgfHwgXCJcIik7XG4gICAgbWF0dGVyRGV0YWlscy5maWVsZHNCeUlkW2VudW1NYXR0ZXJEZXRhaWxGaWVsZHMubWF0dGVyRGV0YWlsc1BhcnRuZXJOYW1lXT8uc2V0VmFsdWUoc2VsZWN0ZWRNYXR0ZXI/LmRhdGE/LnBhcnRuZXI/Lm5hbWUgfHwgXCJcIik7XG4gICAgbWF0dGVyRGV0YWlscy5maWVsZHNCeUlkW2VudW1NYXR0ZXJEZXRhaWxGaWVsZHMubWF0dGVyRGV0YWlsc0liXT8uc2V0VmFsdWUoc2VsZWN0ZWRNYXR0ZXI/LmRhdGE/LnNlY3VyZSB8fCBcIlwiKTtcblxuICAgIGNvbnNvbGUubG9nKFwibWF0dGVyRGV0YWlscy5pc1ZhbGlkKCk6XCIgKyBtYXR0ZXJEZXRhaWxzLmlzVmFsaWQoKSk7XG5cblxuICAgIHRyeVxuICAgIHtcbiAgICAgICAgdHJ5VXBkYXRlQ2xpZW50T2RzUGlja2VyKHNlbGVjdGVkTWF0dGVyLCBjb250ZXh0KTtcbiAgICB9XG4gICAgY2F0Y2goZSlcbiAgICB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRmFpbGVkIHRvIGF1dG8gdXBkYXRpbmcgb2RzIHBpY2tlcnMsIHVzZXIgcmVxdWlyZWQgdG8gc2VsZWN0IG1hbnVhbGx5XCIpO1xuICAgIH1cblxuICAgIHRyeVxuICAgIHtcbiAgICAgICAgdHJ5VXBkYXRlUGFydG5lck9kc1BpY2tlcihzZWxlY3RlZE1hdHRlciwgY29udGV4dCk7XG4gICAgfVxuICAgIGNhdGNoKGUpXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBhdXRvIHVwZGF0aW5nIG9kcyBwaWNrZXJzLCB1c2VyIHJlcXVpcmVkIHRvIHNlbGVjdCBtYW51YWxseVwiKTtcbiAgICB9XG4gICAgXG59XG5cblxuLyoqXG4gKiBUcnkgdG8gdXBkYXRlIHRoZSBjbGllbnQgb2RzIHBpY2tlciB1c2luZyB0aGUgc2VsZWN0ZWQgbWF0dGVyIFxuICogVXNlcyBzZWFyY2hGb3JDbGllbnQgZnVuY3Rpb24gd2hpYyBpcyBhIGNvbW1vbiBvZHMgaGVscGVyIGZ1bmN0aW9uXG4gKiBAcGFyYW0gc2VsZWN0ZWRNYXR0ZXIgVGhlIHNlbGVjdGVkIG1hdHRlclxuICogQHBhcmFtIGNvbnRleHQgVGhlIGZvcm0gYnVpbGRlciBjb250ZXh0XG4gKi9cbmZ1bmN0aW9uIHRyeVVwZGF0ZUNsaWVudE9kc1BpY2tlcihzZWxlY3RlZE1hdHRlcjogSUV4cGVydE1hdHRlciwgY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dCkge1xuICAgIGxldCBjbGllbnRDb2RlID0gc2VsZWN0ZWRNYXR0ZXIuZGF0YS5jbGllbnQuY29kZTtcbiAgICBzZWFyY2hGb3JDbGllbnRzKGNsaWVudENvZGUpLnRoZW4oKGNsaWVudHMpID0+IHtcbiAgICAgICAgbGV0IGNsaWVudCA9IGNsaWVudHNbMF07XG4gICAgICAgIGNvbnNvbGUubG9nKFwiJWMgRm91bmQgQ2xpZW50IG5hbWUgOiBcIiArIGNsaWVudD8ubmFtZSwgXCJjb2xvcjogcGluazsgZm9udC1zaXplOiAyMHB4O1wiLCBjbGllbnRzKTtcbiAgICAgICAgbGV0IG9kc0NsaWVudCA9IGdldENsaWVudE9kc1BpY2tlcihjb250ZXh0KTtcbiAgICAgICAgbGV0IG9kc1JvbGVDb25maWcgPSBvZHNDbGllbnQucm9sZUNvbmZpZ1swXTtcbiAgICAgICAgbGV0IG9kc0VudGl0aWVzID0gb2RzQ2xpZW50Lk9EU0VudGl0aWVzWzBdO1xuICAgIFxuICAgICAgICBpZiAoIW9kc1JvbGVDb25maWcgfHwgIW9kc0VudGl0aWVzKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGlmICghY2xpZW50KSB7XG4gICAgICAgICAgICBvZHNFbnRpdGllcy5zZWxlY3RlZChmYWxzZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVudGl0eSA6IElPZHNFbnRpdHkgPSBvZHNSb2xlQ29uZmlnLmFkZFNlcnZpY2UuY3JlYXRlU2VsZWN0ZWRFbnRpdHlNb2RlbChjbGllbnQuaWQsIFwib3JnYW5pc2F0aW9uXCIsIGNsaWVudC5uYW1lKTtcbiAgICAgICAgb2RzUm9sZUNvbmZpZy5hZGRTZXJ2aWNlLnNlbGVjdGVkRW50aXR5KGVudGl0eSk7XG4gICAgfSk7XG59XG5cbi8qKlxuICogVHJpZXMgdG8gdXBkYXRlIHRoZSBwYXJ0bmVyIG9kcyBwaWNrZXJcbiAqIEBwYXJhbSBzZWxlY3RlZE1hdHRlciBUaGUgc2VsZWN0ZWQgbWF0dGVyXG4gKiBAcGFyYW0gY29udGV4dCAgVGhlIGZvcm0gYnVpbGRlciBjb250ZXh0XG4gKi9cbmZ1bmN0aW9uIHRyeVVwZGF0ZVBhcnRuZXJPZHNQaWNrZXIoc2VsZWN0ZWRNYXR0ZXI6IElFeHBlcnRNYXR0ZXIsIGNvbnRleHQ6IElGb3JtQnVpbGRlckNvbnRleHQpIHtcbiAgICBsZXQgcGFydG5lckxhc3ROYW1lID0gc2VsZWN0ZWRNYXR0ZXIuZGF0YS5wYXJ0bmVyLm5hbWUuc3BsaXQoXCIsXCIpWzBdO1xuICAgIHNlYXJjaEZvclVzZXJzKHNlbGVjdGVkTWF0dGVyLmRhdGEucGFydG5lci5lbWFpbCkudGhlbigodXNlcnMpID0+IHtcbiAgICAgICAgbGV0IHVzZXIgPSB1c2Vyc1swXTtcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyBQYXJ0bmVyIG5hbWUgY2hhbmdlZCB0bzogXCIgKyB1c2VyPy5pZCwgXCJjb2xvcjogcGluazsgZm9udC1zaXplOiAyMHB4O1wiLCB1c2VyKTtcbiAgICAgICAgbGV0IG9kc01hdHRlclBhcnRuZXIgPSBnZXRQYXJ0bmVyT2RzUGlja2VyKGNvbnRleHQpO1xuICAgICAgICBsZXQgb2RzUm9sZUNvbmZpZyA9IG9kc01hdHRlclBhcnRuZXIucm9sZUNvbmZpZ1swXTtcbiAgICAgICAgbGV0IG9kc0VudGl0aWVzID0gb2RzTWF0dGVyUGFydG5lci5PRFNFbnRpdGllc1swXTtcbiAgICBcbiAgICAgICAgaWYgKCFvZHNSb2xlQ29uZmlnIHx8ICFvZHNFbnRpdGllcylcbiAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgIG9kc0VudGl0aWVzLnNlbGVjdGVkKGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBlbnRpdHkgOiBJT2RzRW50aXR5ID0gb2RzUm9sZUNvbmZpZy5hZGRTZXJ2aWNlLmNyZWF0ZVNlbGVjdGVkRW50aXR5TW9kZWwodXNlci5pZCwgXCJ1c2VyXCIsIHVzZXIuZmlyc3ROYW1lICsgXCIgXCIgKyB1c2VyLnN1cm5hbWUpO1xuICAgICAgICBvZHNSb2xlQ29uZmlnLmFkZFNlcnZpY2Uuc2VsZWN0ZWRFbnRpdHkoZW50aXR5KTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBDYWxsIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBtYXR0ZXIgZGF0YVxuICogQHJldHVybnMgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyIHdpdGhvdXQgY2FjaGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TWF0dGVyRGF0YShleHBlcnRNYXR0ZXJOdW1iZXI/OnN0cmluZykgOiBQcm9taXNlPElFeHBlcnRNYXR0ZXJbXT4ge1xuICAgIFxuICAgIGxldCByZXRWYWx1ZTpJRXhwZXJ0TWF0dGVyW10gPSBbXTtcbiAgICBpZihleHBlcnRNYXR0ZXJOdW1iZXIgPT09IHVuZGVmaW5lZCB8fCBleHBlcnRNYXR0ZXJOdW1iZXIubGVuZ3RoID09PSAwKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHJldFZhbHVlO1xuICAgIH1cbiAgIFxuICAgIC8vcmV0dXJuIGF3YWl0ICRhamF4LmdldCgvKiB3ZWJwYWNrSWdub3JlOiB0cnVlICovIHdpbmRvdy5kb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4gKyBcIi9faWRlRmlsZXMvU2FtcGxlRGF0YS9lRGlzY292ZXJ5L21hdHRlcnMuanNvblwiKSBhcyBJRXhwZXJ0TWF0dGVyW107XG4gICBcblxuICAgIC8vIC8vZ2V0IHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciB3aXRob3V0IGNhY2hlXG4gICAgbGV0IGRhdGEgPSBhd2FpdCBleGVjdXRlR2V0PGFueT4oYC9hcGkvZXh0ZXJuYWxNYXR0ZXJQcm92aWRlci9kZXRhaWxzLyR7ZXhwZXJ0TWF0dGVyTnVtYmVyfWApO1xuICAgICBjb25zb2xlLmxvZyhcIiVjIFtNb2R1bGVMb2FkZXJdIGdldE1hdHRlckRhdGEgcmV0dXJuIHZhbHVlXCIsIFwiYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTVcIiwgZGF0YSlcbiAgICAgaWYoZGF0YSAmJiBkYXRhLm1hdHRlckNvZGUpXG4gICAgIHtcbiAgICAgICAgbGV0IG1hdHRlcjpJRXhwZXJ0TWF0dGVyID0ge1xuICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICB9O1xuXG4gICAgICAgICByZXRWYWx1ZS5wdXNoKG1hdHRlcik7XG4gICAgIH1cbiAgICAvLyB7XG4gICAgLy8gICAgIHJldFZhbHVlID0gZGF0YS5leHRlcm5hbE1hdHRlclByb3ZpZGVyU2VhcmNoUmVzdWx0cyBhcyBJRXhwZXJ0TWF0dGVyW107XG4gICAgLy8gfVxuICAgICByZXR1cm4gcmV0VmFsdWU7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgdGVtcCBtYXR0ZXIgbnVtYmVyIGFuZCBzZXRzIGl0IHRvIHRoZSB0ZW1wLW1hdHRlci1udW1iZXIgZmllbGRcbiAqIEBwYXJhbSBjb250ZXh0IFRoZSBmb3JtIGJ1aWxkZXIgY29udGV4dFxuICovXG5mdW5jdGlvbiBnZW5lcmF0ZVRlbXBNYXR0ZXJOdW1iZXIoY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dClcbntcbiAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgbGV0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICBsZXQgZGF5ID0gZGF0ZS5nZXREYXRlKCk7IFxuICAgIGxldCBob3VyID0gZGF0ZS5nZXRIb3VycygpO1xuICAgIGxldCBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICBsZXQgc2Vjb25kID0gZGF0ZS5nZXRTZWNvbmRzKCk7XG4gICAgbGV0IG1pbGxpc2Vjb25kID0gZGF0ZS5nZXRNaWxsaXNlY29uZHMoKTtcbiAgICBsZXQgdGVtcE1hdHRlck51bWJlciA9IGBUJHt5ZWFyfSR7bW9udGh9JHtkYXl9JHtob3VyfSR7bWludXRlfSR7c2Vjb25kfSR7bWlsbGlzZWNvbmR9YDtcbiAgICBjb250ZXh0LmZvcm0/LmZpZWxkc0J5SWRbZW51bUZpZWxkcy50ZW1wTWF0dGVyTnVtYmVyXT8uc2V0VmFsdWUodGVtcE1hdHRlck51bWJlcik7XG59XG5cbi8qKlxuICogRW51bSBmb3IgdGhlIGZpZWxkcyBpbiB0aGUgZm9ybSBidWlsZGVyXG4gKi9cbmV4cG9ydCBlbnVtIGVudW1GaWVsZHMge1xuICAgIGN1c3RvbUFsdEVkaXNjb3ZlcnlJbnN0cnVjdGlvbk1hdHRlckRldGFpbHMgPSBcImN1c3RvbS1hbHQtZWRpc2NvdmVyeS1pbnN0cnVjdGlvbi1tYXR0ZXItZGV0YWlsc1wiLFxuICAgIGp1cmlzZGljdGlvbnNDb3VudHJ5ID0gXCJqdXJpc2RpY3Rpb25zLWNvdW50cnlcIixcbiAgICBwaXBlbGluZU1hdHRlciA9IFwicGlwZWxpbmUtbWF0dGVyXCIsXG4gICAgZXhwZXJ0TWF0dGVyTnVtYmVyID0gXCJleHBlcnQtbWF0dGVyLW51bWJlclwiLFxuICAgIGV4cGVydE1hdHRlck51bWJlclZhbHVlID0gXCJleHBlcnQtbWF0dGVyLW51bWJlci12YWx1ZVwiLFxuICAgIHRlbXBNYXR0ZXJOdW1iZXIgPSBcInRlbXAtbWF0dGVyLW51bWJlclwiLFxuICAgIHN1Yk1hdHRlckNvZGUgPSBcInN1Yi1tYXR0ZXItY29kZVwiLFxuICAgIGFiY01hdHRlck51bWJlciA9IFwiYWJjLW1hdHRlci1udW1iZXJcIixcbiAgICBtYXR0ZXJEZXRhaWxzID0gXCJtYXR0ZXItZGV0YWlsc1wiLFxuICAgIFxufVxuXG4vKipcbiAqIEVudW0gZm9yIHRoZSBmaWVsZHMgaW4gdGhlIG1hdHRlciBkZXRhaWxzIHN1YiBhcmVhIG9mIHRoZSBmb3JtIGJ1aWxkZXJcbiAqL1xuZXhwb3J0IGVudW0gZW51bU1hdHRlckRldGFpbEZpZWxkcyB7XG4gICAgbWF0dGVyRGV0YWlsc1BhcnRuZXJTZWxlY3RvciA9IFwibWF0dGVyLWRldGFpbHMtcGFydG5lci1zZWxlY3RvclwiLFxuICAgIG1hdHRlckRldGFpbHNQYXJ0bmVyTmFtZSA9IFwibWF0dGVyLWRldGFpbHMtcGFydG5lci1uYW1lXCIsXG4gICAgbWF0dGVyRGV0YWlsc0NsaWVudE5hbWUgPSBcIm1hdHRlci1kZXRhaWxzLWNsaWVudC1uYW1lXCIsXG4gICAgbWF0dGVyRGV0YWlsc0NsaWVudENvZGUgPSBcIm1hdHRlci1kZXRhaWxzLWNsaWVudC1jb2RlXCIsXG4gICAgbWF0dGVyRGV0YWlsc1ByYWN0aWNlQXJlYSA9IFwibWF0dGVyLWRldGFpbHMtcHJhY3RpY2UtYXJlYVwiLFxuICAgIG1hdHRlckRldGFpbHNOYW1lID0gXCJtYXR0ZXItZGV0YWlscy1uYW1lXCIsXG4gICAgbWF0dGVyRGV0YWlsc0liID0gXCJtYXR0ZXItZGV0YWlscy1pYlwiXG59XG5cbi8qKlxuICogU2VhcmNoZXMgZm9yIHRoZSBwYXJ0bmVyIG9kcyBwaWNrZXIgaW4gdGhlIGJsYWRlIHVzaW5nIGNvbW1vbiBvZHMgaGVscGVyIGZ1bmN0aW9uc1xuICogQHBhcmFtIGNvbnRleHQgXG4gKiBAcmV0dXJucyBcbiAqL1xuZnVuY3Rpb24gZ2V0UGFydG5lck9kc1BpY2tlcihjb250ZXh0OiBJRm9ybUJ1aWxkZXJDb250ZXh0KSB7XG4gICAgcmV0dXJuIGdldEFsbFJvbGVDb25maWdGb3JSb2xlKGNvbnRleHQuYmxhZGUsbWF0dGVyUGFydG5lclJvbGVTeXN0ZW1OYW1lKTtcbn1cblxuLyoqXG4gKiBTZWFyY2hlcyBmb3IgdGhlIHBhcnRuZXIgb2RzIHBpY2tlciBpbiB0aGUgYmxhZGUgdXNpbmcgY29tbW9uIG9kcyBoZWxwZXIgZnVuY3Rpb25zXG4gKiBAcGFyYW0gY29udGV4dCBcbiAqIEByZXR1cm5zIFxuICovXG5mdW5jdGlvbiBnZXRDbGllbnRPZHNQaWNrZXIoY29udGV4dDogSUZvcm1CdWlsZGVyQ29udGV4dCkge1xuICAgIHJldHVybiBnZXRBbGxSb2xlQ29uZmlnRm9yUm9sZShjb250ZXh0LmJsYWRlLCBjbGllbnRSb2xlU3lzdGVtTmFtZSk7XG59XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidmFsaWRhdGVBcGkiLCJhcGkiLCJsb2NhdGlvbiIsIndpbmRvdyIsImRvY3VtZW50Iiwib3JpZ2luIiwiaW5kZXhPZiIsImdldEFsbFJvbGVDb25maWdGb3JSb2xlIiwiYmxhZGUiLCJyb2xlIiwicmV0VmFsdWUiLCJyb2xlQ29uZmlnIiwiT0RTRW50aXRpZXMiLCJhbGxPZHNBc3BlY3RzIiwidHlwZVRvQ2hlY2siLCJTaGFyZWRvIiwiQ29yZSIsIkNhc2UiLCJBc3BlY3RzIiwiV2lkZ2V0cyIsIk9kc0VudGl0eVBpY2tlciIsImFzcGVjdHMiLCJmaWx0ZXIiLCJhIiwid2lkZ2V0IiwiZ2V0T2RzV2lkZ2V0cyIsImZvckVhY2giLCJvZHNFbnRpdGllcyIsIm9kcyIsInJvbGVTeXN0ZW1OYW1lIiwicHVzaCIsIm9wdGlvbnMiLCJyb2xlQ29uZmlnTW9kZWxzIiwiciIsInNlYXJjaE9kc0FuZFJldHVyblJvd3MiLCJzZWFyY2giLCJwb3N0Qm9keSIsIkFQSVJlc3VsdCIsIiRhamF4IiwicG9zdCIsImV4ZWN1dGVQb3N0IiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiX3NlYXJjaCIsImxvZyIsInJvd3MiLCJtYXAiLCJKU09OIiwicGFyc2UiLCJyZXN1bHQiLCJleHRyYWN0Um93c0Zyb21PRFNTZWFyY2hSZXN1bHRzIiwibWF0dGVyUGFydG5lclJvbGVTeXN0ZW1OYW1lIiwiY2xpZW50Um9sZVN5c3RlbU5hbWUiLCJydW5NZSIsImNvbnRleHQiLCJleHBlcnRNYXR0ZXJOdW1iZXIiLCJtYXR0ZXJEZXRhaWxzIiwicGlwZWxpbmVNYXR0ZXIiLCJmb3JtIiwiRXJyb3IiLCJmaWVsZHNCeUlkIiwiZW51bUZpZWxkcyIsImNyZWF0ZVZhcmlhYmxlcyIsInRlc3RlciIsInVuZGVmaW5lZCIsIndvcmtJdGVtQ29udGV4dCIsImlkIiwiZXhpdCIsInBoYXNlTmFtZSIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJoaWRlU2hvd01hdHRlckRldGFpbHMiLCJlbnVtTWF0dGVyRGV0YWlsRmllbGRzIiwibWF0dGVyRGV0YWlsc1BhcnRuZXJOYW1lIiwib24iLCJldiIsImdldFZhbHVlIiwidXBkYXRlTWF0dGVyRGV0YWlscyIsImp1cmlzZGljdGlvbnNDb3VudHJ5Iiwic2VsZWN0ZWRJZCIsImFzcGVjdCIsImdldEFzcGVjdCIsInNlbGVjdGVkSnVyaXNkaWN0aW9uQ291bnRyeSIsInNlbGVjdGVkSnVyaXNkaWN0aW9uIiwiZmluZCIsIm9wdGlvbiIsIm5hbWUiLCJpbnN0cnVjdGlvbiIsImp1cmlzZGljdGlvbklkIiwiYWRkRXZlbnRIYW5kbGVycyIsImRhdGUiLCJEYXRlIiwidGVtcE1hdHRlck51bWJlciIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsImdldE1pbGxpc2Vjb25kcyIsInNldFZhbHVlIiwiZ2VuZXJhdGVUZW1wTWF0dGVyTnVtYmVyIiwiJHVpIiwiZXZlbnRzIiwiYnJvYWRjYXN0Iiwic3RhdHVzIiwiZmllbGRzIiwiY2hpbGQiLCJyZWFkb25seSIsInNldE1hdHRlckRldGFpbHNTdGF0ZSIsImNsZWFyTWF0dGVyRGV0YWlscyIsImRhdGEiLCJsZW5ndGgiLCJleGVjdXRlR2V0IiwibWF0dGVyQ29kZSIsIm1hdHRlciIsImdldE1hdHRlckRhdGEiLCJzZWxlY3RlZE1hdHRlciIsInBhcmVudCIsImV4cGVydE1hdHRlck51bWJlclZhbHVlIiwibWF0dGVyRGV0YWlsc0NsaWVudE5hbWUiLCJjbGllbnQiLCJtYXR0ZXJEZXRhaWxzQ2xpZW50Q29kZSIsImNvZGUiLCJtYXR0ZXJEZXRhaWxzTmFtZSIsInNob3J0TmFtZSIsInBhcnRuZXIiLCJtYXR0ZXJEZXRhaWxzSWIiLCJzZWN1cmUiLCJpc1ZhbGlkIiwic2VhcmNoRm9yQ2xpZW50cyIsInRoZW4iLCJjbGllbnRzIiwib2RzQ2xpZW50IiwiZ2V0Q2xpZW50T2RzUGlja2VyIiwib2RzUm9sZUNvbmZpZyIsInNlbGVjdGVkIiwiZW50aXR5IiwiYWRkU2VydmljZSIsImNyZWF0ZVNlbGVjdGVkRW50aXR5TW9kZWwiLCJzZWxlY3RlZEVudGl0eSIsInRyeVVwZGF0ZUNsaWVudE9kc1BpY2tlciIsInNwbGl0Iiwic2VhcmNoRm9yVXNlcnMiLCJlbWFpbCIsInVzZXJzIiwidXNlciIsIm9kc01hdHRlclBhcnRuZXIiLCJnZXRQYXJ0bmVyT2RzUGlja2VyIiwiZmlyc3ROYW1lIiwic3VybmFtZSIsInRyeVVwZGF0ZVBhcnRuZXJPZHNQaWNrZXIiXSwic291cmNlUm9vdCI6IiJ9