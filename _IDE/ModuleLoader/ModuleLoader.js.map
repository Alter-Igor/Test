{"version":3,"file":"ModuleLoader.js","names":["console","log","template","document","createElement","innerHTML","ModuleLoader","HTMLElement","constructor","attachShadow","mode","shadowRoot","Error","thisShadowRoot","appendChild","content","cloneNode","connectedCallback","slots","querySelectorAll","scriptURL","assignedNodes","textContent","scriptUrl","window","location","origin","Date","getTime","then","module","runMe","parentElement","closestForm","closest","context","createFormBuilderContext","catch","err","render","customElements","define","element","retValue","koContext","ko","contextFor","fields","getAlpacaFormFields","form","getAlpacaForm","workItemContext","$parentContext","$data","options","model","alpaca","$","childrenByPropertyId"],"sources":["../../src/ModuleLoader/ModuleLoader.ts"],"sourcesContent":["import { IFormBuilderContext } from \"../Typings/FormBuilder/IFormBuilderContext\";\n\n//log with  color\nconsole.log(\"%c [ModuleLoader] module-loader webcomponent loaded\", \"background: #222; color: #bada55\", this);\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n<div style=\"display:none;\" class=\"module-loader\">  \n    <slot></slot>\n</div>`;\n \nclass ModuleLoader extends HTMLElement{\n  thisShadowRoot: ShadowRoot\n constructor(){\n     super();\n     console.log(\"%c [ModuleLoader] constructor\", \"background: #222; color: #bada55\", this);\n     this.attachShadow({ mode: 'open'});\n     if(!this.shadowRoot) throw new Error(\"No shadowRoot\");\n     this.thisShadowRoot = this.shadowRoot;\n     this.shadowRoot.appendChild(template.content.cloneNode(true));         \n } \n\n connectedCallback(){\n    console.log(\"%c [ModuleLoader] connectedCallback\", \"background: #222; color: #bada55\", this);\n     \n    // setTimeout(() => {\n    let slots = this.thisShadowRoot.querySelectorAll('slot');\n    console.log(slots);\n\n    let scriptURL = slots[0].assignedNodes()[0].textContent;\n    console.log(scriptURL);\n    if(!scriptURL) return;\n    //import the script with no cache\n    \n    let scriptUrl = window.location.origin + scriptURL + \"?v=\" + new Date().getTime();\n    import(scriptUrl).then((module) => {\n        console.log(\"module\",module);\n        let runMe = module.runMe; \n        if(!runMe) throw new Error(\"No runMe function\");\n        if(!this.parentElement) throw new Error(\"No parentElement\");\n        let closestForm = this.parentElement.closest(\"form\");\n        if(!closestForm) throw new Error(\"No closestForm\");\n        let context = createFormBuilderContext(closestForm);\n        runMe(context);\n    }).catch((err) => {\n        console.log(err);\n    });\n    \n    // }, 1000);\n  \n\n   this.render();\n }\n\n render(){\n    console.log(\"%c [ModuleLoader] render\", \"background: #222; color: #bada55\", this);\n }\n}\nwindow.customElements.define('module-loader', ModuleLoader);\n\n\nfunction createFormBuilderContext(element: HTMLElement) : IFormBuilderContext {\n    if(!element) throw new Error(\"No element\");\n    if(!element.parentElement) throw new Error(\"No element.parentElement\");\n\n    let retValue : IFormBuilderContext = {\n        koContext: window.ko.contextFor(element.parentElement),\n        element: element,\n        fields: getAlpacaFormFields(element),\n        form: getAlpacaForm(element),\n        workItemContext: (window.ko.contextFor(element.parentElement) as any).$parentContext.$data.options.model\n    }\n    //log with color\n    console.log(\"%c [ModuleLoader] createFormBuilderContext return value\", \"background: #222; color: #bada55\", retValue);\n\n    return retValue;\n\n}\n\nfunction getAlpacaFormFields(context: any) {\n    let alpaca = ($(context) as any).alpaca();\n    return alpaca.childrenByPropertyId\n}\n\nfunction getAlpacaForm(context: any) {\n    let alpaca = ($(context) as any).alpaca();\n    return alpaca;\n}"],"mappings":"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"}