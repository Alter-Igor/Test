{"version":3,"file":"ModuleLoader.js","names":["console","log","template","document","createElement","innerHTML","ModuleLoader","HTMLElement","constructor","attachShadow","mode","shadowRoot","Error","thisShadowRoot","appendChild","content","cloneNode","connectedCallback","slots","querySelectorAll","scriptURL","assignedNodes","textContent","window","location","origin","then","module","runMe","parentElement","closestForm","closest","context","createFormBuilderContext","render","customElements","define","element","retValue","koContext","ko","contextFor","alpacaForm","getAlpacaForm","workItemContext","$parentContext","$data","options","model","$","alpaca"],"sources":["../../src/ModuleLoader/ModuleLoader.ts"],"sourcesContent":["import { IFormBuilderContext } from \"../Typings/FormBuilder/IFormBuilderContext\";\n\n//log with  color\nconsole.log(\"%c [ModuleLoader] module-loader webcomponent loaded\", \"background: #222; color: #bada55\", this);\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n<div style=\"display:none;\" class=\"module-loader\">  \n    <slot></slot>\n</div>`;\n \nclass ModuleLoader extends HTMLElement{\n  thisShadowRoot: ShadowRoot\n constructor(){\n     super();\n     console.log(\"%c [ModuleLoader] constructor\", \"background: #222; color: #bada55\", this);\n     this.attachShadow({ mode: 'open'});\n     if(!this.shadowRoot) throw new Error(\"No shadowRoot\");\n     this.thisShadowRoot = this.shadowRoot;\n     this.shadowRoot.appendChild(template.content.cloneNode(true));\n     \n    \n } \n\n connectedCallback(){\n    console.log(\"%c [ModuleLoader] connectedCallback\", \"background: #222; color: #bada55\", this);\n     \n    // setTimeout(() => {\n    let slots = this.thisShadowRoot.querySelectorAll('slot');\n    console.log(slots);\n\n    let scriptURL = slots[0].assignedNodes()[0].textContent;\n    console.log(scriptURL);\n    if(!scriptURL) return;\n    import(window.location.origin + scriptURL).then((module) => {\n        console.log(\"module\",module);\n        let runMe = module.runMe; \n        if(!runMe) throw new Error(\"No runMe function\");\n        if(!this.parentElement) throw new Error(\"No parentElement\");\n        let closestForm = this.parentElement.closest(\"form\");\n        if(!closestForm) throw new Error(\"No closestForm\");\n        let context = createFormBuilderContext(closestForm);\n        runMe(context);\n    });\n    \n    // }, 1000);\n  \n\n   this.render();\n }\n\n render(){\n    console.log(\"%c [ModuleLoader] render\", \"background: #222; color: #bada55\", this);\n }\n}\nwindow.customElements.define('module-loader', ModuleLoader);\n\n\nfunction createFormBuilderContext(element: HTMLElement) : IFormBuilderContext {\n    if(!element) throw new Error(\"No element\");\n    if(!element.parentElement) throw new Error(\"No element.parentElement\");\n\n    let retValue : IFormBuilderContext = {\n        koContext: window.ko.contextFor(element.parentElement),\n        element: element,\n        alpacaForm: getAlpacaForm(element),\n        workItemContext: (window.ko.contextFor(element.parentElement) as any).$parentContext.$data.options.model\n    }\n    //log with color\n    console.log(\"%c [ModuleLoader] createFormBuilderContext return value\", \"background: #222; color: #bada55\", retValue);\n\n    return retValue;\n\n}\n\nfunction getAlpacaForm(context: any) {\n    return ($(context) as any).alpaca();\n}\n"],"mappings":"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"}