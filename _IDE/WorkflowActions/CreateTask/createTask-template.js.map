{"version":3,"file":"createTask-template.js","names":["connections","$model","Connections","taskId","Guid","NewGuid","dueOn","DateTime","Now","ctx","ToString","AddDays","Configuration","dueInDays","Parse","task","actions","sharedo","BuildTask","WithId","OfType","WithTitle","buildString","WithPriorityId","priorityId","OnComplete","step","OnOverdue","DueOn","WithTag","OnReminderDue","At","Minutes","OnPhase","parentId","ForSharedo","ownerId","Assign","To","actionPlanBuilder","WithActionPlan","itemsAsString","log","Information","JSON","stringify","items","slice","sort","a","b","Number","parseInt","order","forEach","i","description","type","actionPlanItem","buildActionPlan","AddItem","Build","Save","actionPlanModel","actionPlan","BuildActionPlanItem","WithDescription","AddCheckbox","AddInformation","AddHeader","mandatory","MarkRequired","WithOrder","callToActionVar","callToAction","Warning","cta","buildCallToAction","WithCallToAction","plan","callToActionModel","BuildCallToAction","WithDisplay","title","styles","WithStyles","CallToActionContextType","contextType","contextIdVariable","contextId","CallToActionContextId","CallToActionCommand","command","commandConfig","CallToActionCommandConfiguration","icon","CallToActionIcon","css","CallToActionCss"],"sources":["../../../src/NodeBased/WorkflowActions/CreateTask/createTask-template.ts"],"sourcesContent":["ï»¿\nlet connections = $model.Connections;\nlet taskId = Guid.NewGuid();\nlet dueOn = DateTime.Now;\n\n// $ifNotNull.Configuration.outputVariable\nctx[\"$model.Configuration.outputVariable\"] = taskId.ToString(); // It's a guid, need to to string it \n// $endif;\n\n// $ifNotNull.Configuration.dueInDays\nif (\"$model.Configuration.dueInDays\") {\n    dueOn = DateTime.Now.AddDays($model.Configuration.dueInDays);\n}\n// $endif\n\n// $ifNotNull.Configuration.dueOnVariable\ndueOn = DateTime.Parse(ctx[\"$model.Configuration.dueOnVariable\"]);\n// $endif\n\nlet task = actions.sharedo.BuildTask()\n    .WithId(taskId)\n    .OfType(\"$model.Configuration.taskType\")\n    .WithTitle(sharedo.buildString(\"$model.Configuration.taskTitle;\"))\n    // $ifNotNull.Configuration.priorityId\n    .WithPriorityId($model.Configuration.priorityId)\n    // $endif;\n    // $if.Connections.has-onComplete\n    .OnComplete(connections[\"onComplete\"].step)\n    // $endif;\n    // $if.Connections.has-onOverdue\n    .OnOverdue(connections[\"onOverdue\"].step)\n    // $endif;\n    .DueOn(dueOn)\n    // $ifNotNull.Configuration.tag\n    .WithTag(sharedo.buildString(\"$model.Configuration.tag;\"))\n    // $endif\n    // $if.Connections.has-onReminderDue\n    .OnReminderDue(connections[\"onReminderDue\"].step).At(1).Minutes;\n// $endif;\n\n// $if.Model.Configuration.has-phaseOutlets\n// $each.Model.Configuration.phaseOutlets\nif (connections[\"$current.systemName\"]) {\n    task.OnPhase(\"$current.systemName\", connections[\"$current.systemName\"].step);\n}\n// $endeach\n// $endif;\n\n// $ifNotNull.Configuration.parentWorkItemId\nlet parentId = ctx[\"$model.Configuration.parentWorkItemId\"];\nif (parentId) {\n    task = task.ForSharedo(parentId);\n}\n// $endif\n\n// $ifNotNull.Configuration.taskOwnerOdsId\nlet ownerId = ctx[\"$model.Configuration.taskOwnerOdsId\"];\nif (ownerId) {\n    task = task.Assign(\"primary-owner\").To(ownerId);\n}\n// $endif\n\n// $if.Model.Configuration.has-assignments\n// $each.Model.Configuration.assignments\nif (ctx[\"$current.odsIdVariableName\"]) task = task.Assign(\"$current.roleSystemName\").To(ctx[\"$current.odsIdVariableName\"]);\n// $endeach\n// $endif\n\n// $if.Configuration.addActionPlan\n{\n    // Add action plan\n    let actionPlanBuilder = task\n        .WithActionPlan()\n        .WithTitle(sharedo.buildString(\"$model.Configuration.actionPlanTitle;\"));\n\n    // Add action plan items\n    // $ifNotNull.Configuration.actionPlanItemsList\n    {\n        let itemsAsString = ctx[\"$model.Configuration.actionPlanItemsList\"] as IActionPlan[];\n\n        log.Information('*** itemsAsString:');\n        log.Information(JSON.stringify(itemsAsString));\n\n        if (itemsAsString) {\n            let items = itemsAsString;//JSON.parse(itemsAsString) as Array<any>;\n            items.slice()\n                .sort((a, b) => Number.parseInt(a.order, 10) - Number.parseInt(b.order, 10))\n                .forEach(function (i) {\n                    log.Information('*** i:');\n                    log.Information('description: ' + i.description);\n                    log.Information('type: ' + i.type);\n                    log.Information('order: ' + i.order);\n                    log.Information('**********');\n                    let actionPlanItem = buildActionPlan(i);\n                    log.Information('*** actionPlanItem:');\n                    log.Information(JSON.stringify(actionPlanItem));\n\n                    actionPlanBuilder = actionPlanBuilder.AddItem(actionPlanItem);\n                });\n        }\n    }\n    // $endif\n\n    log.Information('*** actionPlanBuilder:');\n    log.Information(JSON.stringify(actionPlanBuilder));\n\n    task = actionPlanBuilder.Build();\n}\n// $endif\n\ntask.Save();\n\nlog.Information('*** task:');\nlog.Information(JSON.stringify(task));\n\n\n\n\nfunction buildActionPlan(actionPlanModel: IActionPlan): any {\n    log.Information(\"*** function buildActionPlan()\");\n    let actionPlan = actions.sharedo.BuildActionPlanItem();\n\n    actionPlan = actionPlan.WithDescription(actionPlanModel.description);\n\n    let type = actionPlanModel.type;\n\n    if (type === \"checkbox\") {\n        actionPlan = actionPlan.AddCheckbox();\n    }\n\n    if (type === \"infobox\") {\n        actionPlan = actionPlan.AddInformation();\n    }\n\n    if (type === \"header\") {\n        actionPlan = actionPlan.AddHeader();\n    }\n\n    if (actionPlanModel.mandatory) {\n        actionPlan = actionPlan.MarkRequired();\n    }\n\n    let order = actionPlanModel.order;\n    actionPlan = actionPlan.WithOrder(order);\n\n\n    if (actionPlanModel.callToActionVar) {\n        let callToAction = actionPlanModel.callToActionVar;\n        if (!callToAction) {\n            log.Warning(\"Create action plan - a call to action variable ($model.Configuration.callToActionVar) was specified but was empty\");\n        }\n        else {\n            let cta = buildCallToAction(callToAction);\n            actionPlan = actionPlan.WithCallToAction(cta);\n        }\n    }\n\n\n    let plan = actionPlan.Build();\n    log.Information(\"*** function buildActionPlan() finished\");\n    return plan;\n\n}\n\n\n\n\nfunction buildCallToAction(callToActionModel: ICallToAction): any | undefined {\n    log.Information(\"*********** function buildCallToAction() *****************\");\n    log.Information(\"************-Data-****************\");\n    log.Information(JSON.stringify(callToActionModel));\n    log.Information(\"****************************\");\n    let cta = actions.sharedo\n        .BuildCallToAction()\n        .WithDisplay(callToActionModel.title);\n    if (callToActionModel.styles) {\n        cta = cta.WithStyles(callToActionModel.styles);\n    }\n    cta = cta.Build();\n\n    cta.CallToActionContextType = callToActionModel.contextType\n\n\n    log.Information(\"ContextIdVariable: \" + callToActionModel.contextIdVariable);\n    if (callToActionModel.contextIdVariable) {\n        let contextId = ctx[callToActionModel.contextIdVariable];\n        if (contextId) {\n\n            log.Information(`typeof contextId: ${typeof contextId}`);\n            if (typeof contextId === 'string') {\n                contextId = Guid.Parse(contextId);\n            }\n\n            log.Information(\"ContextId: \" + contextId);\n            cta.CallToActionContextId = contextId;\n            log.Information(\"cta.CallToActionContextId: \" + cta.CallToActionContextId);\n        }\n        else {\n            log.Warning(`ContextIdVariable: ${callToActionModel.contextIdVariable} was not found in the context`);\n        }\n    }\n\n\n    cta.CallToActionCommand = callToActionModel.command;\n\n    // ifNotNull.Configuration.commandConfig\n    if (callToActionModel.commandConfig) {\n        cta.CallToActionCommandConfiguration = callToActionModel.commandConfig;\n    }\n    // endif\n\n    // ifNull.Configuration.commandConfig\n    if (!callToActionModel.commandConfig) {\n        cta.CallToActionCommandConfiguration = \"{}\";\n    }\n    // endif\n\n    // ifNotNull.Configuration.icon\n    if (callToActionModel.icon) {\n        cta.CallToActionIcon = callToActionModel.icon;\n    }\n    // endif;    \n\n    // ifNotNull.Configuration.css\n    if (callToActionModel.css) {\n        cta.CallToActionCss = callToActionModel.css;\n    }\n    // endif;\n    log.Information('**** buildCallToAction finished');\n    return cta;\n\n}"],"mappings":"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"}