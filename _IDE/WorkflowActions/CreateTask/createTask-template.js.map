{"version":3,"file":"createTask-template.js","names":["connections","$model","Connections","taskId","Guid","NewGuid","dueOn","DateTime","Now","AddDays","Configuration","dueInDays","Parse","ctx","task","actions","sharedo","BuildTask","WithId","OfType","WithTitle","buildString","WithPriorityId","priorityId","OnComplete","step","OnOverdue","DueOn","WithTag","OnReminderDue","At","Minutes","OnPhase","parentId","ForSharedo","ownerId","Assign","To","actionPlanBuilder","WithActionPlan","itemsAsString","log","Information","JSON","stringify","items","slice","sort","a","b","Number","parseInt","order","forEach","i","actionPlanItem","buildActionPlan","AddItem","Build","Save","ToString","actionPlanModel","actionPlan","BuildActionPlanItem","WithDescription","description","type","AddCheckbox","AddInformation","AddHeader","mandatory","MarkRequired","WithOrder","callToActionVar","callToAction","Warning","WithCallToAction","buildCallToAction","plan","callToActionModel","cta","BuildCallToAction","WithDisplay","title","styles","WithStyles","CallToActionContextType","contextType","contextIdVariable","CallToActionContextId","CallToActionCommand","command","CallToActionCommandConfiguration","commandConfig","CallToActionIcon","icon","CallToActionCss","css"],"sources":["../../../src/WorkflowActions/CreateTask/createTask-template.ts"],"sourcesContent":["ï»¿\nlet connections = $model.Connections;\nlet taskId = Guid.NewGuid();\nlet dueOn = DateTime.Now;\n \n// $ifNotNull.Configuration.dueInDays\nif (\"$model.Configuration.dueInDays\")\n{\n    dueOn = DateTime.Now.AddDays($model.Configuration.dueInDays);\n} \n// $endif\n \n// $ifNotNull.Configuration.dueOnVariable\ndueOn = DateTime.Parse(ctx[\"$model.Configuration.dueOnVariable\"]);\n// $endif\n\nlet task = actions.sharedo.BuildTask()\n    .WithId(taskId)\n    .OfType(\"$model.Configuration.taskType\")\n    .WithTitle(sharedo.buildString(\"$model.Configuration.taskTitle;\"))\n    // $ifNotNull.Configuration.priorityId\n    .WithPriorityId($model.Configuration.priorityId)\n    // $endif;\n    // $if.Connections.has-onComplete\n    .OnComplete(connections[\"onComplete\"].step)\n    // $endif;\n    // $if.Connections.has-onOverdue\n    .OnOverdue(connections[\"onOverdue\"].step)\n    // $endif;\n    .DueOn(dueOn)\n    // $ifNotNull.Configuration.tag\n    .WithTag(sharedo.buildString(\"$model.Configuration.tag;\"))\n    // $endif\n    // $if.Connections.has-onReminderDue\n    .OnReminderDue(connections[\"onReminderDue\"].step).At(1).Minutes;\n    // $endif;\n    \n// $if.Model.Configuration.has-phaseOutlets\n// $each.Model.Configuration.phaseOutlets\nif (connections[\"$current.systemName\"])\n{\n    task.OnPhase(\"$current.systemName\", connections[\"$current.systemName\"].step);\n}\n// $endeach\n// $endif;\n\n// $ifNotNull.Configuration.parentWorkItemId\nlet parentId = ctx[\"$model.Configuration.parentWorkItemId\"];\nif (parentId)\n{\n    task = task.ForSharedo(parentId);\n}\n// $endif\n\n// $ifNotNull.Configuration.taskOwnerOdsId\nlet ownerId = ctx[\"$model.Configuration.taskOwnerOdsId\"];\nif (ownerId)\n{\n    task = task.Assign(\"primary-owner\").To(ownerId);\n}\n// $endif\n\n// $if.Model.Configuration.has-assignments\n// $each.Model.Configuration.assignments\nif( ctx[\"$current.odsIdVariableName\"] ) task = task.Assign(\"$current.roleSystemName\").To(ctx[\"$current.odsIdVariableName\"]);\n// $endeach\n// $endif\n\n// $if.Configuration.addActionPlan\n{\n    // Add action plan\n    let actionPlanBuilder = task\n        .WithActionPlan()\n        .WithTitle(sharedo.buildString(\"$model.Configuration.actionPlanTitle;\"));\n\n    // Add action plan items\n    // $ifNotNull.Configuration.actionPlanItemsList\n    {\n        let itemsAsString = ctx[\"$model.Configuration.actionPlanItemsList\"] as IActionPlan[];\n\n        log.Information('*** itemsAsString:');\n        log.Information(JSON.stringify(itemsAsString));\n\n        if (itemsAsString)\n        {\n            let items = itemsAsString;//JSON.parse(itemsAsString) as Array<any>;\n            items.slice()\n            .sort((a, b) => Number.parseInt(a.order,10) - Number.parseInt(b.order,10))\n            .forEach(function(i) {\n                let actionPlanItem = buildActionPlan(i);\n                actionPlanBuilder = actionPlanBuilder.AddItem(actionPlanItem);\n            });\n        }\n    }\n    // $endif\n\n    task = actionPlanBuilder.Build();\n} \n// $endif\n\ntask.Save();\n\n// $ifNotNull.Configuration.outputVariable\nctx[\"$model.Configuration.outputVariable\"] = taskId.ToString(); // It's a guid, need to to string it \n// $endif;\n\n\n function buildActionPlan(actionPlanModel: IActionPlan): any\n{\n\n    let actionPlan = actions.sharedo.BuildActionPlanItem();\n\nactionPlan = actionPlan.WithDescription(actionPlanModel.description);\n\nlet type = actionPlanModel.type;\n\nif (type === \"checkbox\") {\n    actionPlan = actionPlan.AddCheckbox();\n}\n\nif (type === \"infobox\") {\n    actionPlan = actionPlan.AddInformation();\n}\n\nif (type === \"header\") {\n    actionPlan = actionPlan.AddHeader();\n}\n\n// $if.Configuration.mandatory\nif(actionPlanModel.mandatory)\n{\n    actionPlan = actionPlan.MarkRequired();\n}\n// $endif\n\nlet order = actionPlanModel.order;\nactionPlan = actionPlan.WithOrder(order);\n\n// $ifNotNull.Configuration.callToActionVar\nif(actionPlanModel.callToActionVar)\n{\n    let callToAction = actionPlanModel.callToActionVar;\n    if (!callToAction)\n    {\n        log.Warning(\"Create action plan - a call to action variable ($model.Configuration.callToActionVar) was specified but was empty\");\n    }\n    else\n    {\n        actionPlan = actionPlan.WithCallToAction(buildCallToAction(callToAction));\n    }\n}\n// $endif\n\nlet plan = actionPlan.Build();\n\nreturn plan;\n\n}\n\n\n\n\n function buildCallToAction(callToActionModel: ICallToAction): any | undefined\n{\n    let cta = actions.sharedo\n    .BuildCallToAction()\n    .WithDisplay(callToActionModel.title);\n    if(callToActionModel.styles)\n    {\n        cta = cta.WithStyles(callToActionModel.styles);\n    }\n\n// $ifNotNull.Configuration.styles\n    //.WithStyles(\"$model.Configuration.styles\")\n// $endif\n    cta = cta.Build();\n\ncta.CallToActionContextType = callToActionModel.contextType\n\n// $ifNotNull.Configuration.contextIdVariable\nif(callToActionModel.contextIdVariable)\n{\n    cta.CallToActionContextId = Guid.Parse(callToActionModel.contextIdVariable);\n}\n// $endif\n\ncta.CallToActionCommand = callToActionModel.command;\n\n// $ifNotNull.Configuration.commandConfig\ncta.CallToActionCommandConfiguration = callToActionModel.commandConfig;\n// $endif\n\n// $ifNull.Configuration.commandConfig\ncta.CallToActionCommandConfiguration = \"{}\";\n// $endif\n\n// $ifNotNull.Configuration.icon\ncta.CallToActionIcon =  callToActionModel.icon;\n// $endif;    \n\n// $ifNotNull.Configuration.css\ncta.CallToActionCss =   callToActionModel.css;\n// $endif;\n\nreturn cta;\n\n}"],"mappings":"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"}