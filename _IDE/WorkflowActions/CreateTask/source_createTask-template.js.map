{"version":3,"file":"source_createTask-template.js","names":["buildActionPlan","connections","$model","Connections","taskId","Guid","NewGuid","dueOn","DateTime","Now","AddDays","Configuration","dueInDays","Parse","ctx","task","actions","sharedo","BuildTask","WithId","OfType","WithTitle","buildString","WithPriorityId","priorityId","OnComplete","step","OnOverdue","DueOn","WithTag","OnReminderDue","At","Minutes","OnPhase","parentId","ForSharedo","ownerId","Assign","To","actionPlanBuilder","WithActionPlan","itemsAsString","log","Information","JSON","stringify","items","slice","sort","a","b","Number","parseInt","order","forEach","i","actionPlanItem","AddItem","Build","Save","ToString"],"sources":["../../../src/WorkflowActions/CreateTask/source_createTask-template.ts"],"sourcesContent":["ï»¿import { buildActionPlan } from \"../Common/BuildActionPlan\";\n\nlet connections = $model.Connections;\nlet taskId = Guid.NewGuid();\nlet dueOn = DateTime.Now;\n \n// $ifNotNull.Configuration.dueInDays\nif (\"$model.Configuration.dueInDays\")\n{\n    dueOn = DateTime.Now.AddDays($model.Configuration.dueInDays);\n} \n// $endif\n \n// $ifNotNull.Configuration.dueOnVariable\ndueOn = DateTime.Parse(ctx[\"$model.Configuration.dueOnVariable\"]);\n// $endif\n\nlet task = actions.sharedo.BuildTask()\n    .WithId(taskId)\n    .OfType(\"$model.Configuration.taskType\")\n    .WithTitle(sharedo.buildString(\"$model.Configuration.taskTitle;\"))\n    // $ifNotNull.Configuration.priorityId\n    .WithPriorityId($model.Configuration.priorityId)\n    // $endif;\n    // $if.Connections.has-onComplete\n    .OnComplete(connections[\"onComplete\"].step)\n    // $endif;\n    // $if.Connections.has-onOverdue\n    .OnOverdue(connections[\"onOverdue\"].step)\n    // $endif;\n    .DueOn(dueOn)\n    // $ifNotNull.Configuration.tag\n    .WithTag(sharedo.buildString(\"$model.Configuration.tag;\"))\n    // $endif\n    // $if.Connections.has-onReminderDue\n    .OnReminderDue(connections[\"onReminderDue\"].step).At(1).Minutes;\n    // $endif;\n    \n// $if.Model.Configuration.has-phaseOutlets\n// $each.Model.Configuration.phaseOutlets\nif (connections[\"$current.systemName\"])\n{\n    task.OnPhase(\"$current.systemName\", connections[\"$current.systemName\"].step);\n}\n// $endeach\n// $endif;\n\n// $ifNotNull.Configuration.parentWorkItemId\nlet parentId = ctx[\"$model.Configuration.parentWorkItemId\"];\nif (parentId)\n{\n    task = task.ForSharedo(parentId);\n}\n// $endif\n\n// $ifNotNull.Configuration.taskOwnerOdsId\nlet ownerId = ctx[\"$model.Configuration.taskOwnerOdsId\"];\nif (ownerId)\n{\n    task = task.Assign(\"primary-owner\").To(ownerId);\n}\n// $endif\n\n// $if.Model.Configuration.has-assignments\n// $each.Model.Configuration.assignments\nif( ctx[\"$current.odsIdVariableName\"] ) task = task.Assign(\"$current.roleSystemName\").To(ctx[\"$current.odsIdVariableName\"]);\n// $endeach\n// $endif\n\n// $if.Configuration.addActionPlan\n{\n    // Add action plan\n    let actionPlanBuilder = task\n        .WithActionPlan()\n        .WithTitle(sharedo.buildString(\"$model.Configuration.actionPlanTitle;\"));\n\n    // Add action plan items\n    // $ifNotNull.Configuration.actionPlanItemsList\n    {\n        let itemsAsString = ctx[\"$model.Configuration.actionPlanItemsList\"] as IActionPlan[];\n\n        log.Information('*** itemsAsString:');\n        log.Information(JSON.stringify(itemsAsString));\n\n        if (itemsAsString)\n        {\n            let items = itemsAsString;//JSON.parse(itemsAsString) as Array<any>;\n            items.slice()\n            .sort((a, b) => Number.parseInt(a.order,10) - Number.parseInt(b.order,10))\n            .forEach(function(i) {\n                let actionPlanItem = buildActionPlan(i);\n                actionPlanBuilder = actionPlanBuilder.AddItem(i);\n            });\n        }\n    }\n    // $endif\n\n    task = actionPlanBuilder.Build();\n} \n// $endif\n\ntask.Save();\n\n// $ifNotNull.Configuration.outputVariable\nctx[\"$model.Configuration.outputVariable\"] = taskId.ToString(); // It's a guid, need to to string it \n// $endif;\n"],"mappings":"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"}