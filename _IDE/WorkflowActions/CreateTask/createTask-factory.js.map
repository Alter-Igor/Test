{"version":3,"file":"createTask-factory.js","names":["createModel","actionModel","actionOptions","wfModel","stepModel","self","defaults","config","taskType","taskTitle","dueOnVariable","priorityId","dueInDays","tag","addActionPlan","actionPlanTitle","parentWorkItemId","taskOwnerOdsId","actionPlanItemsList","outputVariable","onCompleteOutlet","onOverdueOutlet","phaseOutlets","assignments","connections","options","$","extend","ko","observable","validation","Validator","required","pureComputed","actionModelErrorCount","fails","addAvailableOutlet","ui","trackVariable","mustBeCollection","mustNotBeCollection","phases","Sharedo","Core","Case","WorkflowEditor","WFPhaseOutlets","WFAssignments","dispose","getModel","toJS"],"sources":["../../../src/WorkflowActions/CreateTask/createTask-factory.ts"],"sourcesContent":["ï»¿(function()\n{ \n    var createModel = function(actionModel: any, actionOptions: any, wfModel: any, stepModel: any)\n    {\n        // Reference self as the action model we're extending\n        var self = actionModel;\n\n        // Setup model defaults and extend from loaded config\n        var defaults =\n        {\n            // Your custom config is passed in this object\n            config:\n            {\n                taskType: \"task\",           // The task type to create\n                taskTitle: null,            // The title of the task to create\n                dueOnVariable: null,        // Variable holding the date the task is due\n                priorityId: null,           // The priorityId of the task\n                dueInDays: 0,               // The number of days in which the task will be due\n                tag: null,                  // Any tag required\n                addActionPlan: false,       // Whether to add an action plan to the task\n                actionPlanTitle: \"\",        // Title for the action plan,\n                parentWorkItemId: null,     // The variable holding the parent work item id\n                taskOwnerOdsId: null,       // The variable holding who to assign the task to\n                actionPlanItemsList: null,  // The variable holding an array of action plan items to associate with the task\n                outputVariable: null,       // The variable to output the new task id to\n                onCompleteOutlet: true,     // Whether to add the \"task complete\" outlet\n                onOverdueOutlet: true,      // Whether to add the \"overdue\" outlet\n                phaseOutlets: [],           // List of phase specific outlets,\n                assignments: []             // List of assignments [{roleSystemName, odsIdVariableName}]\n            },\n\n            // The list of connections as persisted\n            connections: {}\n        };\n\n        var options = $.extend(true, {}, defaults, actionOptions);\n\n        // Add this action's specific config to the model\n        self.config.taskType = ko.observable(options.config.taskType);\n        self.config.taskTitle = ko.observable(options.config.taskTitle);\n        self.config.dueInDays = ko.observable(options.config.dueInDays);\n        self.config.tag = ko.observable(options.config.tag);\n        self.config.dueOnVariable = ko.observable(options.config.dueOnVariable);\n        self.config.priorityId = ko.observable(options.config.priorityId);\n        self.config.addActionPlan = ko.observable(options.config.addActionPlan);\n        self.config.actionPlanTitle = ko.observable(options.config.actionPlanTitle);\n        self.config.parentWorkItemId = ko.observable(options.config.parentWorkItemId);\n        self.config.taskOwnerOdsId = ko.observable(options.config.taskOwnerOdsId);\n        self.config.actionPlanItemsList = ko.observable(options.config.actionPlanItemsList);\n        self.config.outputVariable = ko.observable(options.config.outputVariable);\n        self.config.onCompleteOutlet = ko.observable(options.config.onCompleteOutlet);\n        self.config.onOverdueOutlet = ko.observable(options.config.onOverdueOutlet);\n\n        // Extend with this action's specific validation\n        self.validation.taskType = Validator.required(self, self.config.taskType, \"Must specify the type of task to create\");\n        self.validation.taskTitle = Validator.required(self, self.config.taskTitle, \"Task title must be provided\");\n        self.validation.parentWorkItemId = Validator.required(self, self.config.parentWorkItemId, \"You must specify a variable holding the parent work item id\");\n\n        self.validation.actionPlanTitle = ko.pureComputed(() =>\n        {\n            var addActionPlan = self.config.addActionPlan();\n            var actionPlanTitle = self.config.actionPlanTitle();\n            if (addActionPlan && !actionPlanTitle) return \"Action plan title must be provided\";\n            return null;\n        });\n\n        // Extend the action model with our custom model validation\n        self.actionModelErrorCount = ko.pureComputed(function()\n        {\n            var fails = 0;\n            if (self.validation.taskType()) fails++;\n            if (self.validation.taskTitle()) fails++;\n            if (self.validation.parentWorkItemId()) fails++;\n            if (self.validation.actionPlanTitle()) fails++;\n            return fails;\n        });\n\n        // Add the complete and due outlets\n        if (options.config.onCompleteOutlet)\n        {\n            self.addAvailableOutlet(\"onComplete\", \"Task complete\");\n        }\n\n        if (options.config.onOverdueOutlet)\n        {\n            self.addAvailableOutlet(\"onOverdue\", \"Overdue\");\n        }\n\n        // Track variables and create selector models\n        self.ui.parentWorkItemId = self.trackVariable(self.config.parentWorkItemId, \"/Identifier/Work Type Identifier\");\n        self.ui.taskOwnerOdsId = self.trackVariable(self.config.taskOwnerOdsId, \"/Identifier/Ods Entity Identifier\");\n        self.ui.dueOnVariable = self.trackVariable(self.config.dueOnVariable, \"/Date Time\");\n        self.ui.actionPlanItemsList = self.trackVariable(self.config.actionPlanItemsList, \"/Entity/Action Plan Item\",\n            {\n                mustBeCollection: true,\n                mustNotBeCollection: false\n            });\n        self.ui.outputVariable = self.trackVariable(self.config.outputVariable, \"/Identifier/Work Type Identifier/Task Identifier\");\n\n        // Map through the phase outlets to the view model exposed by WFPhaseOutletComponent\n        self.ui.phases = new Sharedo.Core.Case.WorkflowEditor.WFPhaseOutlets(self, options.config.phaseOutlets);\n\n        // Map through the assignments to the view model exposed by WFAssignmentComponent\n        self.ui.assignments = new Sharedo.Core.Case.WorkflowEditor.WFAssignments(self, options.config.assignments);\n    };\n    \n    var dispose = function(actionModel: any)\n    {\n        var self = actionModel;\n        self.ui.parentWorkItemId.dispose();\n        self.ui.taskOwnerOdsId.dispose();\n        self.ui.dueOnVariable.dispose();\n        self.ui.actionPlanItemsList.dispose();\n        self.ui.outputVariable.dispose();\n\n        self.ui.phases.dispose();\n        self.ui.assignments.dispose();\n    };\n\n    var getModel = function(actionModel: any)\n    {\n        var self = actionModel;\n        var config = ko.toJS(self.config);\n        \n        // Transform phase outlets\n        config.phaseOutlets = self.ui.phases.getModel();\n\n        // Transform assignments\n        config.assignments = self.ui.assignments.getModel();\n\n        return config;\n    };\n\n    return {\n        createModel: createModel,\n        getModel: getModel,\n        dispose: dispose\n    };\n})();\n"],"mappings":"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"}