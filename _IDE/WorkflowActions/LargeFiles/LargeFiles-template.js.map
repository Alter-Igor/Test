{"version":3,"file":"LargeFiles-template.js","names":["getEmailAttachments","logHeading","retValue","Array","outboundEmailWorkTypeId","ctx","relatedDocumentsResult","sharedo","http","get","concat","log","Information","JSON","stringify","success","Error","body","relatedDocument","length","i","relatedDoc","fileUrlResponse","id","fileUrl","redirectTo","payload","delete","emailAttachment","link","push","emailAttachments","fileTitle","title","emailBody","heading"],"sources":["../../../src/NodeBased/WorkflowActions/LargeFiles/LargeFiles-template.ts"],"sourcesContent":["\r\ninterface IEmailAttachments {\r\n  relatedDocument: IRelatedDocument\r\n  link: string\r\n\r\n} \r\n   \r\n \r\nfunction getEmailAttachments(): Array<IEmailAttachments> {\r\n  logHeading(\"getEmailAttachments\");\r\n  let retValue = new Array<IEmailAttachments>();\r\n\r\n  let outboundEmailWorkTypeId = ctx[\"outboundEmailWorkTypeId\"];\r\n\r\n // outboundEmailWorkTypeId = \"0986b02d-8d16-4995-b514-b042006c2d0d\"; //for testing\r\n\r\n  var relatedDocumentsResult = sharedo.http.get(\"/api/sharedo/\".concat(outboundEmailWorkTypeId, \"/relatedDocuments\"));\r\n\r\n  logHeading(\"relatedDocumentsResult\");\r\n  log.Information(JSON.stringify(relatedDocumentsResult));\r\n\r\n  if (!relatedDocumentsResult.success) {\r\n    log.Error(\"failed to get related documents\");\r\n    log.Information(\"result: \" + JSON.stringify(relatedDocumentsResult));\r\n    return retValue;\r\n  }\r\n\r\n\r\n  logHeading(\"relatedDocumentsResult.body\");\r\n  log.Information(JSON.stringify(relatedDocumentsResult.body));\r\n\r\n  let relatedDocument: IRelatedDocument[] = relatedDocumentsResult.body;\r\n\r\n  if (relatedDocument.length === 0) {\r\n    log.Information(\"No related document found\");\r\n    return retValue;\r\n  }\r\n\r\n\r\n\r\n  //Loop through the related documents and remove them from the work item\r\n  for (let i = 0; i < relatedDocument.length; i++) {\r\n    let relatedDoc = relatedDocument[i];\r\n    logHeading(\"relatedDoc\");\r\n    log.Information(JSON.stringify(relatedDoc));\r\n\r\n   //https://demo-aus.sharedo.tech/api/sharedo/9723e792-4948-460d-9ecf-b013006589c9/relatedDocuments/batch-delete\r\n\r\n\r\n   //get related document file url\r\n   let fileUrlResponse = sharedo.http.get(\"/api/relatedDocument/\".concat(relatedDoc.id));\r\n\r\n   if(!fileUrlResponse.success) {\r\n    logHeading(\"/api/relatedDocument/ -  Failed\");\r\n      log.Error(\"failed to get file url for related document: \" + relatedDoc.id);\r\n      log.Information(\"result: \" + JSON.stringify(fileUrlResponse));\r\n      //continue;\r\n      fileUrlResponse.body =\r\n      {\r\n        \"redirectTo\": \"https://slicedbreaduk.sharepoint.com/sites/sharedoâ€¦ic%20Info.docx&action=default&mobileredirect=true\"\r\n      }\r\n    }\r\n\r\n    \r\n\r\n    let fileUrl = fileUrlResponse.body.redirectTo;\r\n\r\n   let payload = JSON.stringify([relatedDoc.id]);\r\n    sharedo.http.delete(\"/api/sharedo/\".concat(outboundEmailWorkTypeId, \"/relatedDocuments/batch-delete\", payload));\r\n\r\n    let emailAttachment: IEmailAttachments = {\r\n      relatedDocument: relatedDoc,\r\n      link: fileUrl\r\n    }\r\n\r\n    retValue.push(emailAttachment);\r\n    \r\n  }\r\n\r\n  return retValue;\r\n}\r\n \r\n\r\n\r\nlet emailAttachments = getEmailAttachments();\r\n\r\nfor(let i = 0; i < emailAttachments.length; i++) {\r\n  let emailAttachment = emailAttachments[i];\r\n  log.Information(\"emailAttachment: \" + JSON.stringify(emailAttachment));\r\n\r\n  let fileTitle = emailAttachment.relatedDocument.title;\r\n  let fileUrl = emailAttachment.link;\r\n\r\n  log.Information(\"fileTitle: \" + fileTitle);\r\n  log.Information(\"fileUrl: \" + fileUrl);\r\n\r\n  //add file title and link to email body\r\n  let emailBody = ctx[\"emailBody\"];\r\n  emailBody = emailBody + \"<br/><br/>\" + fileTitle + \"<br/>\" + fileUrl;\r\n  ctx[\"emailBody\"] = emailBody;\r\n\r\n\r\n}\r\n\r\nfunction logHeading(heading:string) {\r\n  log.Information(\"-------------------------------------\");\r\n  log.Information(heading);\r\n  log.Information(\"-------------------------------------\");\r\n}\r\n"],"mappings":"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"}