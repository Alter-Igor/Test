{"version":3,"file":"createCallToAction-factory.js","names":["createModel","actionModel","actionOptions","wfModel","stepModel","self","defaults","config","title","icon","css","styles","command","commandConfig","contextType","contextIdVariable","outputVariable","connections","options","$","extend","ko","observable","validation","Validator","required","pureComputed","ui","contextIdVar","value","name","actionModelErrorCount","fails","contextTypes","varType","contextTypeSystemName","_","find","t","allowedVariableType","type","contextIdVariableSelector","trackVariable","outputVariableSelector","dispose"],"sources":["../../../src/WorkflowActions/CreateCallToAction/createCallToAction-factory.ts"],"sourcesContent":["ï»¿(function()\n{\n    var createModel = function(actionModel: any, actionOptions: any, wfModel: any, stepModel: any)\n    {\n        // Reference self as the action model we're extending\n        var self = actionModel;\n\n        // Setup model defaults and extend from loaded config\n        var defaults =\n        {\n            // Your custom config is passed in this object\n            config:\n            {\n                title: null,            \n                icon: null,             \n                css: null,              \n                styles: null,\n                command: null,\n                commandConfig: \"{\\n}\",\n                contextType: null,              // Sharedo/Participant/Role\n                contextIdVariable: null,\n                outputVariable: null\n            },\n\n            // The list of connections as persisted\n            connections: {}\n        };\n        var options = $.extend(true, {}, defaults, actionOptions);\n\n        // Add this action's specific config to the model\n        self.config.title = ko.observable(options.config.title);\n        self.config.icon = ko.observable(options.config.icon);\n        self.config.css = ko.observable(options.config.css);\n        self.config.styles = ko.observable(options.config.styles);\n        self.config.command = ko.observable(options.config.command);\n        self.config.commandConfig = ko.observable(options.config.commandConfig);\n        self.config.contextType = ko.observable(options.config.contextType);\n        self.config.contextIdVariable = ko.observable(options.config.contextIdVariable);\n        self.config.outputVariable = ko.observable(options.config.outputVariable);\n\n        // Extend with this action's specific validation\n        self.validation.title = Validator.required(self, self.config.title, \"Title is required\");\n        self.validation.command = Validator.required(self, self.config.command, \"Command is required\");\n        self.validation.contextIdVariable = ko.pureComputed(() =>\n        {\n            var contextType = self.ui.contextType();\n            var contextIdVar = self.config.contextIdVariable();\n\n            // NONE selected or there is a variable selection\n            if( !contextType || !contextType.value || contextIdVar ) return null;\n\n            return \"Please select a variable holding the \" + contextType.name;\n        });\n\n        // Extend the action model with our custom model validation\n        self.actionModelErrorCount = ko.pureComputed(function()\n        {\n            var fails = 0;\n            if (self.validation.title()) fails++;\n            if (self.validation.command()) fails++;\n            if (self.validation.contextIdVariable()) fails++;\n            return fails;\n        });\n\n        // Add the list of context types to this action's UI\n        // We're adding this here because the model validation relies on it, so can't\n        // just put it in the designer. \n        self.ui.contextTypes = \n        [\n            { value: null, name: \"None\", varType: \"/\" },\n            { value: \"sharedo\", name: \"Work Item\", varType:\"/Identifier/Work Type Identifier\" },\n            { value: \"participant\", name: \"Participant\", varType:\"/Identifier/Participant Identifier\" },\n            { value: \"participantRole\", name: \"Participant Role\", varType:\"/Identifier/Participant Role Identifier\" }\n        ];\n\n        // Computed to get the current context type\n        self.ui.contextType = ko.pureComputed(() =>\n        {\n            var contextTypeSystemName = self.config.contextType();\n            if( !contextTypeSystemName ) return null;\n\n            return _.find(self.ui.contextTypes, (t: { value: any; }) => t.value === contextTypeSystemName);\n\n        });\n        \n        self.ui.allowedVariableType = ko.pureComputed(() =>\n        {\n            var type = self.ui.contextType();\n            if( type ) return type.varType;\n            return \"/\";\n        });\n        \n        // Create the variable validator/selector - this is dynamic based on context type\n        self.ui.contextIdVariableSelector = self.trackVariable(self.config.contextIdVariable, self.ui.allowedVariableType);\n        self.ui.outputVariableSelector = self.trackVariable(self.config.outputVariable, \"/Entity/Call To Action\");\n    };\n\n    var dispose = function(actionModel: any)\n    {\n        var self = actionModel;\n        self.ui.contextIdVariableSelector.dispose();\n        self.ui.outputVariableSelector.dispose();\n    };\n\n    return {\n        createModel: createModel,\n        dispose: dispose\n    };\n})();"],"mappings":"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"}