{"version":3,"file":"widget.js","names":["window","Custom","WorkflowActions","CreateCallToActionDesigner","element","configuration","base","self","defaults","node","model","options","$","extend","action","sharedoTypePickerOptions","multiSelect","selectMode","selectedItem","config","taskType","rootTypes","commandMeta","title","ko","observable","description","icon","disposables","command","subscribe","loadCommandMeta","bind","prototype","onDestroy","_","each","d","dispose","loadAndBind","chooseCommand","objectType","contextType","blade","$ui","stacks","cancelAfter","cancelAll","selectCommand","then","openPanel","menuType","closing","systemName","editCommand","JSON","parse","allowRemove","allowChange","allowEmpty","scope","result","commandConfig","stringify","commandSystemName","$ajaxMutex","getOnce","meta"],"sources":["../../../../src/NodeBased/WorkflowActions/CreateCallToAction/Designer/widget.ts"],"sourcesContent":["// Namespacing\n// namespace(\"\");\n\n\nwindow.Custom = window.Custom || {};\nwindow.Custom.WorkflowActions = window.Custom.WorkflowActions || {};\n\n// View model\nwindow.Custom.WorkflowActions.CreateCallToActionDesigner = function(element: any, configuration: any, base: any)\n{\n    var self = this;\n    var defaults =\n    {\n        // The selected node\n        node: null,\n\n        // The overall process model object\n        model: null\n    };\n\n    var options = $.extend(true, {}, defaults, configuration);\n\n    self.action = options.node;\n    self.model = options.model;\n\n    self.sharedoTypePickerOptions = {\n        multiSelect: false,\n        selectMode: \"systemName\",\n        selectedItem: self.action.config.taskType,\n        rootTypes: [\"task\"]\n    };\n\n    // Hold ref info about the selected command\n    self.commandMeta =\n    {\n        title: ko.observable(null),\n        description: ko.observable(null),\n        icon: ko.observable(null)\n    };\n\n    // Subscribe to changes to the command\n    self.disposables =\n    [\n        self.action.config.command.subscribe(self.loadCommandMeta.bind(self))\n    ];\n};\n\nwindow.Custom.WorkflowActions.CreateCallToActionDesigner.prototype.onDestroy = function()\n{\n    var self = this;\n    _.each(self.disposables, (d:any) => d.dispose());\n};\n\nwindow.Custom.WorkflowActions.CreateCallToActionDesigner.prototype.loadAndBind = function()\n{\n    var self = this;\n    self.loadCommandMeta();\n};\n\nwindow.Custom.WorkflowActions.CreateCallToActionDesigner.prototype.chooseCommand = function()\n{\n    var self = this;\n\n    // What context have we got selected - transform to menu scope\n    var objectType = \"Global\";\n    switch (self.action.config.contextType())\n    {\n        case \"sharedo\":\n            objectType = \"Sharedo\";\n            break;\n        case \"participant\":\n            objectType = \"Participant\";\n            break;\n        case \"participantRole\":\n            objectType = \"ParticipantRole\";\n            break;\n    }\n\n    if (self.model.blade) $ui.stacks.cancelAfter(self.model.blade);\n    else $ui.stacks.cancelAll();\n\n    var selectCommand = function(then:any)\n    {\n        $ui.stacks.openPanel(\n            \"Sharedo.Core.Case.Menus.SelectCommandBlade\",\n            {\n                menuType: \"General\",\n                objectType: objectType\n            },\n            {\n                closing: function(systemName:any)\n                {\n                    then(systemName);\n                }\n            });\n    };\n\n    var editCommand = function(command: any, config: string)\n    {\n        $ui.stacks.openPanel(\n            \"Sharedo.Core.Case.Menus.CommandEditorBlade\",\n            {\n                systemName: command,\n                configuration: JSON.parse(config),\n                allowRemove: true,\n                allowChange: true,\n                allowEmpty: true,\n                scope:\n                {\n                    menuType: \"General\",\n                    objectType: objectType\n                }\n            },\n            {\n                closing: function(result: { systemName: any; configuration: any; })\n                {\n                    self.action.config.command(result.systemName);\n                    self.action.config.commandConfig(JSON.stringify(result.configuration));\n                }\n            });\n    };\n\n\n    var command = self.action.config.command();\n    var config = self.action.config.commandConfig();\n\n    if (!command)\n    {\n        selectCommand((systemName: any) =>\n        {\n            editCommand(systemName, \"{}\");\n        });\n    }\n    else\n    {\n        editCommand(command, config || \"{}\");\n    }\n};\n\nwindow.Custom.WorkflowActions.CreateCallToActionDesigner.prototype.loadCommandMeta = function () \n{\n    var self = this;\n\n    var commandSystemName = self.action.config.command();\n\n    if (!commandSystemName) \n    {\n        self.commandMeta.title(null);\n        self.commandMeta.description(null);\n        self.commandMeta.icon(null);\n        return;\n    }\n\n    $ajaxMutex.getOnce(\"/api/commands/\" + commandSystemName)\n        .then((meta: { title: any; description: any; icon: any; }) =>\n        {\n            self.commandMeta.title(meta.title);\n            self.commandMeta.description(meta.description);\n            self.commandMeta.icon(meta.icon);\n        });\n};"],"mappings":"AAAA;AACA;;AAGAA,MAAM,CAACC,MAAM,GAAGD,MAAM,CAACC,MAAM,IAAI,CAAC,CAAC;AACnCD,MAAM,CAACC,MAAM,CAACC,eAAe,GAAGF,MAAM,CAACC,MAAM,CAACC,eAAe,IAAI,CAAC,CAAC;;AAEnE;AACAF,MAAM,CAACC,MAAM,CAACC,eAAe,CAACC,0BAA0B,GAAG,UAASC,OAAY,EAAEC,aAAkB,EAAEC,IAAS,EAC/G;EACI,IAAIC,IAAI,GAAG,IAAI;EACf,IAAIC,QAAQ,GACZ;IACI;IACAC,IAAI,EAAE,IAAI;IAEV;IACAC,KAAK,EAAE;EACX,CAAC;EAED,IAAIC,OAAO,GAAGC,CAAC,CAACC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,EAAEL,QAAQ,EAAEH,aAAa,CAAC;EAEzDE,IAAI,CAACO,MAAM,GAAGH,OAAO,CAACF,IAAI;EAC1BF,IAAI,CAACG,KAAK,GAAGC,OAAO,CAACD,KAAK;EAE1BH,IAAI,CAACQ,wBAAwB,GAAG;IAC5BC,WAAW,EAAE,KAAK;IAClBC,UAAU,EAAE,YAAY;IACxBC,YAAY,EAAEX,IAAI,CAACO,MAAM,CAACK,MAAM,CAACC,QAAQ;IACzCC,SAAS,EAAE,CAAC,MAAM;EACtB,CAAC;;EAED;EACAd,IAAI,CAACe,WAAW,GAChB;IACIC,KAAK,EAAEC,EAAE,CAACC,UAAU,CAAC,IAAI,CAAC;IAC1BC,WAAW,EAAEF,EAAE,CAACC,UAAU,CAAC,IAAI,CAAC;IAChCE,IAAI,EAAEH,EAAE,CAACC,UAAU,CAAC,IAAI;EAC5B,CAAC;;EAED;EACAlB,IAAI,CAACqB,WAAW,GAChB,CACIrB,IAAI,CAACO,MAAM,CAACK,MAAM,CAACU,OAAO,CAACC,SAAS,CAACvB,IAAI,CAACwB,eAAe,CAACC,IAAI,CAACzB,IAAI,CAAC,CAAC,CACxE;AACL,CAAC;AAEDP,MAAM,CAACC,MAAM,CAACC,eAAe,CAACC,0BAA0B,CAAC8B,SAAS,CAACC,SAAS,GAAG,YAC/E;EACI,IAAI3B,IAAI,GAAG,IAAI;EACf4B,CAAC,CAACC,IAAI,CAAC7B,IAAI,CAACqB,WAAW,EAAGS,CAAK,IAAKA,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC;AACpD,CAAC;AAEDtC,MAAM,CAACC,MAAM,CAACC,eAAe,CAACC,0BAA0B,CAAC8B,SAAS,CAACM,WAAW,GAAG,YACjF;EACI,IAAIhC,IAAI,GAAG,IAAI;EACfA,IAAI,CAACwB,eAAe,CAAC,CAAC;AAC1B,CAAC;AAED/B,MAAM,CAACC,MAAM,CAACC,eAAe,CAACC,0BAA0B,CAAC8B,SAAS,CAACO,aAAa,GAAG,YACnF;EACI,IAAIjC,IAAI,GAAG,IAAI;;EAEf;EACA,IAAIkC,UAAU,GAAG,QAAQ;EACzB,QAAQlC,IAAI,CAACO,MAAM,CAACK,MAAM,CAACuB,WAAW,CAAC,CAAC;IAEpC,KAAK,SAAS;MACVD,UAAU,GAAG,SAAS;MACtB;IACJ,KAAK,aAAa;MACdA,UAAU,GAAG,aAAa;MAC1B;IACJ,KAAK,iBAAiB;MAClBA,UAAU,GAAG,iBAAiB;MAC9B;EACR;EAEA,IAAIlC,IAAI,CAACG,KAAK,CAACiC,KAAK,EAAEC,GAAG,CAACC,MAAM,CAACC,WAAW,CAACvC,IAAI,CAACG,KAAK,CAACiC,KAAK,CAAC,CAAC,KAC1DC,GAAG,CAACC,MAAM,CAACE,SAAS,CAAC,CAAC;EAE3B,IAAIC,aAAa,GAAG,SAAAA,CAASC,IAAQ,EACrC;IACIL,GAAG,CAACC,MAAM,CAACK,SAAS,CAChB,4CAA4C,EAC5C;MACIC,QAAQ,EAAE,SAAS;MACnBV,UAAU,EAAEA;IAChB,CAAC,EACD;MACIW,OAAO,EAAE,SAAAA,CAASC,UAAc,EAChC;QACIJ,IAAI,CAACI,UAAU,CAAC;MACpB;IACJ,CAAC,CAAC;EACV,CAAC;EAED,IAAIC,WAAW,GAAG,SAAAA,CAASzB,OAAY,EAAEV,MAAc,EACvD;IACIyB,GAAG,CAACC,MAAM,CAACK,SAAS,CAChB,4CAA4C,EAC5C;MACIG,UAAU,EAAExB,OAAO;MACnBxB,aAAa,EAAEkD,IAAI,CAACC,KAAK,CAACrC,MAAM,CAAC;MACjCsC,WAAW,EAAE,IAAI;MACjBC,WAAW,EAAE,IAAI;MACjBC,UAAU,EAAE,IAAI;MAChBC,KAAK,EACL;QACIT,QAAQ,EAAE,SAAS;QACnBV,UAAU,EAAEA;MAChB;IACJ,CAAC,EACD;MACIW,OAAO,EAAE,SAAAA,CAASS,MAAgD,EAClE;QACItD,IAAI,CAACO,MAAM,CAACK,MAAM,CAACU,OAAO,CAACgC,MAAM,CAACR,UAAU,CAAC;QAC7C9C,IAAI,CAACO,MAAM,CAACK,MAAM,CAAC2C,aAAa,CAACP,IAAI,CAACQ,SAAS,CAACF,MAAM,CAACxD,aAAa,CAAC,CAAC;MAC1E;IACJ,CAAC,CAAC;EACV,CAAC;EAGD,IAAIwB,OAAO,GAAGtB,IAAI,CAACO,MAAM,CAACK,MAAM,CAACU,OAAO,CAAC,CAAC;EAC1C,IAAIV,MAAM,GAAGZ,IAAI,CAACO,MAAM,CAACK,MAAM,CAAC2C,aAAa,CAAC,CAAC;EAE/C,IAAI,CAACjC,OAAO,EACZ;IACImB,aAAa,CAAEK,UAAe,IAC9B;MACIC,WAAW,CAACD,UAAU,EAAE,IAAI,CAAC;IACjC,CAAC,CAAC;EACN,CAAC,MAED;IACIC,WAAW,CAACzB,OAAO,EAAEV,MAAM,IAAI,IAAI,CAAC;EACxC;AACJ,CAAC;AAEDnB,MAAM,CAACC,MAAM,CAACC,eAAe,CAACC,0BAA0B,CAAC8B,SAAS,CAACF,eAAe,GAAG,YACrF;EACI,IAAIxB,IAAI,GAAG,IAAI;EAEf,IAAIyD,iBAAiB,GAAGzD,IAAI,CAACO,MAAM,CAACK,MAAM,CAACU,OAAO,CAAC,CAAC;EAEpD,IAAI,CAACmC,iBAAiB,EACtB;IACIzD,IAAI,CAACe,WAAW,CAACC,KAAK,CAAC,IAAI,CAAC;IAC5BhB,IAAI,CAACe,WAAW,CAACI,WAAW,CAAC,IAAI,CAAC;IAClCnB,IAAI,CAACe,WAAW,CAACK,IAAI,CAAC,IAAI,CAAC;IAC3B;EACJ;EAEAsC,UAAU,CAACC,OAAO,CAAC,gBAAgB,GAAGF,iBAAiB,CAAC,CACnDf,IAAI,CAAEkB,IAAkD,IACzD;IACI5D,IAAI,CAACe,WAAW,CAACC,KAAK,CAAC4C,IAAI,CAAC5C,KAAK,CAAC;IAClChB,IAAI,CAACe,WAAW,CAACI,WAAW,CAACyC,IAAI,CAACzC,WAAW,CAAC;IAC9CnB,IAAI,CAACe,WAAW,CAACK,IAAI,CAACwC,IAAI,CAACxC,IAAI,CAAC;EACpC,CAAC,CAAC;AACV,CAAC"}