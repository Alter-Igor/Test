(()=>{var e={d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{SaveSubmitCancel:()=>d});var o=function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function a(e){try{r(s.next(e))}catch(e){i(e)}}function l(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}r((s=s.apply(e,t||[])).next())}))};const s=function(e){return t=this,s=void 0,i=function*(){return function(e){return o(this,void 0,void 0,(function*(){return function(e,t,s){return o(this,void 0,void 0,(function*(){let o=function(e){let t=window.document.location.origin;return-1===e.indexOf(t)&&(0!==e.indexOf("/")&&(e="/"+e),e=t+e),e}(e),n=function(){let e=(o=function(){let e={};return document.cookie.split(";").reduce((function(t,o){var s=o.split("=");if(2===s.length){var n=s[0].trim(),i=s[1];e[n]=i}return t}),{}),e}()._api)?"Bearer "+o:null,t=new Headers;var o;return t.append("Content-Type","application/json"),e&&t.append("Authorization",e),t}();return yield fetch(o,{method:t,headers:n,body:s?JSON.stringify(s):void 0}).then((e=>{var t;if(console.log(e),-1===(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.indexOf("application/json")))throw new Error("Response was not JSON");return e.json()}))}))}(e,"GET",void 0)}))}(`/api/modeller/sharedoTypes/${e}/phasePlan`).then((e=>{if(console.log("%c loadWorkItem","color: #ff0000"),console.log(e),e)return e;throw new Error("Not found")})).catch((e=>{console.error("Error:",e)}))},new((n=void 0)||(n=Promise))((function(e,o){function a(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(a,l)}r((i=i.apply(t,s||[])).next())}));var t,s,n,i},n=ko;var i;function a(e,t,o){let s=[],i=0;return e.forEach((e=>{let a=t.find((t=>t.systemName===e.toPhaseSystemName));if(!a)return;i++;let r={id:e.systemName,order:i,text:e.name,icon:a.iconClass||"",color:a.colour||"",enabled:n.observable(!0),visible:!0,onClick:o.onClick,tooltip:a.description||`Progress to ${a.name} phase`,type:l(e,a),isOptimumPath:e.isOptimumPath,isSystemClosedPhase:a.isSystemClosedPhase,isRemoved:a.isRemoved,isOpen:a.isOpen,isStart:a.isStart,isReportable:a.isReportable};s.push(r)})),console.log(s),s}function l(e,t){let o=i.primary;return!1===e.isOptimumPath&&(o=i.secondary),!0===t.isRemoved&&(o=i.destrustive),!0===t.isSystemClosedPhase&&(o=i.primary),o}!function(e){e.destrustive="destructive",e.primary="primary",e.secondary="secondary",e.save="save",e.cancel="cancel"}(i||(i={}));let r="SaveSubmitCancelAspect";class d{constructor(e,t,o){var s,i,a,l,r;this.monitorHandlers(),this.firedEvents=[],this.monitoredHandlers=[],this.readyForSave=!1;let d=$.extend(!0,{},{debug:{enabled:!1,logToConsole:!1,showEvents:!1,showInAspect:!1}},t);this.blade=t._host.blade,this.hostModel=t._host.model,this.model={title:null===(i=null===(s=t._host)||void 0===s?void 0:s.model)||void 0===i?void 0:i.title,saveRuns:0,debug:d.debug},this.phasePlan=n.observable(void 0),this.phasePlan.subscribe(this.handlePhasePlanChange.bind(this)),this.log("Init","background: #222; color: #bada55"),this.enabled=t._host.blade.enabled,this.instanceId=null===(a=this.hostModel)||void 0===a?void 0:a.instanceId,this.element=e,this.blade=t._host.blade,this.parentSharedoId=null===(l=this.hostModel)||void 0===l?void 0:l.parentSharedoId,this.toolbarContext=t._host.toolbarContext,this.burgerContext=t._host.burgerContext,this.sharedoId=null===(r=this.hostModel)||void 0===r?void 0:r.id,this.reloading=!1,this.sharedoTypeSystemName=this.blade.model.sharedoTypeSystemName(),this.currentPhaseSystemName=this.blade.model.phaseSystemName(),this.addDebugIfRequired()}handlePhasePlanChange(e){if(this.log("Phase Plan Changed","red",e),!e)return;let t;if(void 0!==this.currentPhaseSystemName&&void 0!==this.currentPhaseSystemName())t=e.transitions.filter((e=>e.fromPhaseSystemName==this.currentPhaseSystemName()));else{let o=e.phases.find((e=>1==e.isStart));if(!o)return void this.log("No Start Phase","red");t=e.transitions.filter((e=>e.fromPhaseSystemName==(null==o?void 0:o.systemName)))}let o={onClick:e=>{this.log("Transition Clicked","red",e)}};this.buttonGroupElement&&this.buttonGroupElement.remove(),this.log("Transitions to convert","green",t.length);let s={order:0,enabled:n.observable(!0),showTitle:n.observable(!0),name:n.observable("System"),buttons:this.createSystemButtons()},i={order:1,enabled:this.blade.isValid,showTitle:n.observable(!0),name:n.observable("Phase Plan"),buttons:a(t,e.phases,o)};this.buttonGroups=[i,s],this.buttonGroupElement=function(e,t){let o=document.createElement("div");return o.classList.add("button-groups"),e.sort(((e,t)=>e.order-t.order)).forEach((e=>{const t=document.createElement("div");let s=e.name().replace(/[^a-zA-Z0-9]/g,"");t.classList.add("button-group"),t.classList.add(s),e.enabled.subscribe((e=>{t.classList.toggle("disabled",!e)}));let n=function(e,t){const o=document.createElement("div");if(o.classList.add("buttons"),!e||0===e.length){let e=document.createElement("div");return e.innerText="No Transitions Available",o.appendChild(e),o}return function(e){e.forEach((e=>{e.id||(e.id="button_"+e.order)}))}(e),e.sort(((e,t)=>e.order-t.order)).forEach((e=>{const t=document.createElement("button");t.classList.add("btn"),t.classList.add(e.type),t.id=e.id||"button_"+e.order,t.innerText=e.text,t.addEventListener("click",e.onClick),t.disabled=!e.enabled(),t.style.display=e.visible?"block":"none",t.title=e.tooltip,function(e,t){e.isOpen&&t.classList.add("toPhaseOpen"),e.isStart&&t.classList.add("toPhaseStart"),e.isReportable&&t.classList.add("toPhaseReportable"),e.isRemoved&&t.classList.add("toPhaseRemoved"),e.isSystemClosedPhase&&t.classList.add("toPhaseSystemClosedPhase"),e.isOptimumPath&&t.classList.add("toPhaseOptimumPath")}(e,t),e.enabled.subscribe((o=>{t.disabled=!o,function(e,t,o){let s="0 8px 8px -4px lightgray",n="0px 0px 17px 4px lightgray";e.color&&(s=`0 8px 8px -4px ${e.color}`,n=`0px 0px 17px 4px ${e.color}`),t?(o.style.boxShadow=s,o.onmouseover=function(){o.style.boxShadow=n},o.onmouseout=function(){o.style.boxShadow=s}):(o.style.boxShadow="",o.onmouseover=function(){o.style.boxShadow=""},o.onmouseout=function(){o.style.boxShadow=""})}(e,o,t)}));const s=document.createElement("span");s.classList.add("icon"),s.classList.add("fa"),s.classList.add(e.icon),s.classList.add("fa-xl"),t.appendChild(s),o.appendChild(t)})),o}(e.buttons);t.appendChild(n),o.appendChild(t)})),o}(this.buttonGroups,this.blade),this.saveSubmitCancelElement=this.element.querySelector(".save-submit-cancel"),this.saveSubmitCancelElement?this.saveSubmitCancelElement.appendChild(this.buttonGroupElement):this.log("Save Submit Cancel Element Not Found","red")}createSystemButtons(){let e=[],t={order:1,text:"Save",onClick:()=>{this.saveClicked()},id:"",icon:"fa-save",enabled:n.observable(!0),visible:!0,tooltip:"Save the current record",type:i.save,color:void 0,isOptimumPath:!1,isSystemClosedPhase:!1,isRemoved:!1,isOpen:!1,isStart:!1,isReportable:!1};e.push(t);let o={order:2,text:"Cancel",onClick:()=>{this.saveClicked()},id:"",icon:"fa-times",enabled:n.observable(!0),visible:!0,tooltip:"Cancel the current record",type:i.cancel,color:void 0,isOptimumPath:!1,isSystemClosedPhase:!1,isRemoved:!1,isOpen:!1,isStart:!1,isReportable:!1};return e.push(o),e}loadAndBind(){this.log("Load And Bind"),this.sharedoTypeSystemName?s(this.sharedoTypeSystemName).then((e=>{this.log("Phase Plan Loaded","red",e),this.phasePlan(e)})):this.log("No Sharedo Type Name")}load(e){this.log("Load")}reload(e){this.log("Reload")}saveClicked(){}save(){}runSaveWithNoValidation(){}areAllAspectsLoaded(){}saveCompleted(){}monitorHandlers(e){}addSubscription(e){}log(e,t,o){var s;(null===(s=this.model.debug)||void 0===s?void 0:s.enabled)&&this.model.debug.logToConsole&&console.log(`%c ${r} - ${e}`,t,o)}addDebugIfRequired(){var e,t;(null===(t=null===(e=this.model)||void 0===e?void 0:e.debug)||void 0===t?void 0:t.enabled)&&(window.aspectDebug=window.aspectDebug||{},window.aspectDebug[r]=this)}}})();var o=Aspects="undefined"==typeof Aspects?{}:Aspects;for(var s in t)o[s]=t[s];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dUJBU2pCLENBRUF5SSxLQUFLckUsR0FDRGQsS0FBS3RELElBQUksT0FDYixDQUVBMEksT0FBT3RFLEdBQ0hkLEtBQUt0RCxJQUFJLFNBQ2IsQ0FHQW9JLGNBRUEsQ0FFQUMsT0FFQSxDQUlBTSwwQkFFQSxDQUVBQyxzQkFFQSxDQUVBQyxnQkFFQSxDQUVBdEYsZ0JBQWdCdUYsR0FFaEIsQ0FFQUMsZ0JBQWdCQyxHQUVoQixDQVFBaEosSUFBSWlKLEVBQWlCcEgsRUFBZ0I3RCxHLE9BQ2IsUUFBaEIsRUFBQXNGLEtBQUtjLE1BQU1QLGFBQUssZUFBRTlCLFVBQ2R1QixLQUFLYyxNQUFNUCxNQUFNQyxjQUNqQi9ELFFBQVFDLElBQUksTUFBTWdELE9BQTBCaUcsSUFBV3BILEVBQU83RCxFQUcxRSxDQUVRb0gscUIsU0FDaUIsUUFBakIsRUFBVSxRQUFWLEVBQUE5QixLQUFLYyxhQUFLLGVBQUVQLGFBQUssZUFBRTlCLFdBQ2xCNUQsT0FBZStLLFlBQWUvSyxPQUFlK0ssYUFBZSxDQUFDLEVBQzdEL0ssT0FBZStLLFlBQVlsRyxHQUF3Qk0sS0FFNUQsRSIsInNvdXJjZXMiOlsid2VicGFjazovL0FzcGVjdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vQXNwZWN0cy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQXNwZWN0cy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL0FzcGVjdHMvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9Bc3BlY3RzLy4vU2F2ZVN1Ym1pdENhbmNlbEFzcGVjdEFnZW50LnRzIiwid2VicGFjazovL0FzcGVjdHMvLi4vLi4vQ29tbW9uL2FwaS9hcGkudHMiLCJ3ZWJwYWNrOi8vQXNwZWN0cy9leHRlcm5hbCB2YXIgXCJrb1wiIiwid2VicGFjazovL0FzcGVjdHMvLi9CdXR0b25CdWlsZGVyLnRzIiwid2VicGFjazovL0FzcGVjdHMvLi9UcmFuc2l0aW9uVG9CdXR0b25Db252ZXJ0ZXIudHMiLCJ3ZWJwYWNrOi8vQXNwZWN0cy8uL1NhdmVTdWJtaXRDYW5jZWxBc3BlY3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJpbXBvcnQgeyBJUGhhc2VQbGFuIH0gZnJvbSBcIi4uLy4uLy4uL1R5cGluZ3MvYXBpL1BoYXNlUGxhbi9QaGFzZVBsYW5cIjtcbmltcG9ydCB7IGV4ZWN1dGVHZXQsIGV4ZWN1dGVQb3N0LCBleGVjdXRlUHV0IH0gZnJvbSBcIi4uLy4uL0NvbW1vbi9hcGkvYXBpXCI7XG5cblxuZXhwb3J0IGludGVyZmFjZSBEYXRhIHtcbiAgICBpbmZvcm1hdGlvbkJhcnJpZXI6IGJvb2xlYW47XG4gICAgbGFzdENoZWNrRGF0ZTogRGF0ZTtcbn1cblxuLyoqXG4gKiBFeGFtcGxlIG9mIHVzaW5nIGZpbmRCeVF1ZXJ5IEFQSSB0byBsb2FkIHdvcmsgaXRlbVxuICogYnkgaXQncyBJRCwgYW5kIGVucmljaCB3aXRoIHNwZWNpZmljIHBhcmFtZXRlcnNcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFBoYXNlUGxhbiA9IGFzeW5jIGZ1bmN0aW9uICh3b3JrVHlwZVN5c3RlbU5hbWU6IHN0cmluZykgOiBQcm9taXNlPElQaGFzZVBsYW4gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gZXhlY3V0ZUdldDxhbnk+KGAvYXBpL21vZGVsbGVyL3NoYXJlZG9UeXBlcy8ke3dvcmtUeXBlU3lzdGVtTmFtZX0vcGhhc2VQbGFuYCkgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIFxuICAgICAgICAvL2xvZyBjb2xvclxuICAgICAgICBjb25zb2xlLmxvZyhcIiVjIGxvYWRXb3JrSXRlbVwiLCBcImNvbG9yOiAjZmYwMDAwXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBmb3VuZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhIGFzIElQaGFzZVBsYW47XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3Qgc2F2ZUFzcGVjdCA9IGFzeW5jIGZ1bmN0aW9uIChpZDogc3RyaW5nLCBkYXRhOmFueSkgOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGV4ZWN1dGVQdXQ8YW55PihgL2FwaS92MS9wdWJsaWMvd29ya0l0ZW0vJHtpZH1gLCBkYXRhKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidXBkYXRlZFwiLGRhdGEpO1xuICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcbiAgICB9KTtcbn0iLCJcbi8qKlxuICogVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBhcGkgY2FsbHMgdG8gdGhlIGJhY2tlbmQuXG4gKiB1dGlsaXNpbmcgdGhlIGF4aW9zIGxpYnJhcnkgdG8gbWFrZSB0aGUgY2FsbHMuXG4gKiBpbmNsdXNpbmcgb2Ygd2VicGFja0lnbm9yZSBpcyB0byBhbGxvdyB0aGUgd2VicGFjayB0byBpZ25vcmUgdGhlIGNhbGxzIGFuZCBub3QgdHJ5IHRvIGJ1bmRsZSB0aGVtLlxuICovXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlUG9zdDxUPihhcGk6IHN0cmluZywgcG9zdEJvZHk6IGFueSkgOiBQcm9taXNlPFQ+e1xuICAgIC8vcmV0dXJuIGF3YWl0ICRhamF4LnBvc3QoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyB2YWxpZGF0ZUFwaShhcGkpLCBwb3N0Qm9keSk7XG4gICAgcmV0dXJuIGV4ZWN1dGVGZXRjaDxUPihhcGksXCJQT1NUXCIscG9zdEJvZHkpO1xufVxuXG4vLyBleHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUdldDxUPihhcGk6IHN0cmluZykgOiBQcm9taXNlPFQ+e1xuLy8gICAgIHJldHVybiBhd2FpdCAkYWpheC5nZXQoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyB2YWxpZGF0ZUFwaShhcGkpKTtcbi8vIH0gXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlR2V0PFQ+KGFwaTogc3RyaW5nKSA6IFByb21pc2U8VD57XG4gICByZXR1cm4gZXhlY3V0ZUZldGNoPFQ+KGFwaSxcIkdFVFwiLHVuZGVmaW5lZCk7XG59XG5cblxuXG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVQdXQ8VD4oYXBpOiBzdHJpbmcsIHBvc3RCb2R5OiBhbnkpIDogUHJvbWlzZTxUPntcbiAgICAvL3JldHVybiBhd2FpdCAkYWpheC5wdXQoLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLyB2YWxpZGF0ZUFwaShhcGkpLCBwb3N0Qm9keSk7XG4gICAgcmV0dXJuIGV4ZWN1dGVGZXRjaDxUPihhcGksXCJQVVRcIixwb3N0Qm9keSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlRGVsZXRlPFQ+KGFwaTogc3RyaW5nKSA6IFByb21pc2U8VD57XG4gICAgLy9yZXR1cm4gYXdhaXQgJGFqYXguZGVsZXRlKC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSk7XG4gICAgcmV0dXJuIGV4ZWN1dGVGZXRjaDxUPihhcGksXCJERUxFVEVcIix1bmRlZmluZWQpO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUFwaShhcGk6IHN0cmluZykgOiBzdHJpbmd7XG4gICBsZXQgbG9jYXRpb249ICB3aW5kb3cuZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luO1xuXG4gICAvL2lmIGFwaSBkb2VzIG5vdCBpbmNsdWRlIHRoZSBsb2NhdGlvbiB0aGVuIGFkZCBpdC5cbiAgICBpZihhcGkuaW5kZXhPZihsb2NhdGlvbikgPT09IC0xKXtcbiAgICAgICAgLy9jaGVjayBpZiBhcGkgc3RhcnQgd2l0aCBhIC8gaWYgbm90IGFkZCBpdC5cbiAgICAgICAgaWYoYXBpLmluZGV4T2YoXCIvXCIpICE9PSAwKXtcbiAgICAgICAgICAgIGFwaSA9IFwiL1wiICsgYXBpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBhcGkgPSBsb2NhdGlvbiArIGFwaTtcbiAgICB9XG4gICAgcmV0dXJuIGFwaTtcbiAgICBcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVGZXRjaDxUPihhcGk6IHN0cmluZywgbWV0aG9kOnN0cmluZyxkYXRhOmFueSkgOiBQcm9taXNlPFQ+e1xuICAgIGxldCB1cmwgPSB2YWxpZGF0ZUFwaShhcGkpO1xuICAgIGxldCBmZXRjaEhlYWRlcnMgPSBidWlsZEhlYWRlcnMoKTtcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwse1xuICAgICAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICAgICAgaGVhZGVyczogZmV0Y2hIZWFkZXJzLFxuICAgICAgICBib2R5OiBkYXRhPyBKU09OLnN0cmluZ2lmeShkYXRhKTogdW5kZWZpbmVkXG4gICAgfVxuICAgICkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgLy9jaGVjayBpZiByZXNwb25zZSBpcyBKU09OXG4gICAgICAgIGlmKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpPy5pbmRleE9mKFwiYXBwbGljYXRpb24vanNvblwiKSA9PT0gLTEpe1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVzcG9uc2Ugd2FzIG5vdCBKU09OXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vcmV0dXJuIHRoZSBqc29uIGFzIG9iamVjdFxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXNwb25zZTtcbn1cblxuZnVuY3Rpb24gYnVpbGRIZWFkZXJzKCkge1xuICAgIGxldCBiZWFyZXIgPSBnZXRCZWFyZXJUb2tlbigpO1xuICAgIGxldCBmZXRjaEhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgIGZldGNoSGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgIGlmIChiZWFyZXIpIHtcbiAgICAgICAgZmV0Y2hIZWFkZXJzLmFwcGVuZChcIkF1dGhvcml6YXRpb25cIiwgYmVhcmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGZldGNoSGVhZGVycztcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29va2llcygpOiB7IFtrZXk6c3RyaW5nXTpzdHJpbmcgfVxue1xuICAgIGxldCByZXRWYWx1ZTogeyBba2V5OnN0cmluZ106c3RyaW5nIH0gPSB7fTtcbiAgICBsZXQgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIikucmVkdWNlKGZ1bmN0aW9uIChjb29raWVzLCBjb29raWUpXG4gICAge1xuICAgICAgICB2YXIgcGFydHMgPSBjb29raWUuc3BsaXQoXCI9XCIpO1xuICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIga2V5ID0gcGFydHNbMF0udHJpbSgpO1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gcGFydHNbMV07XG5cbiAgICAgICAgICAgIHJldFZhbHVlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29va2llcztcbiAgICB9LCB7fSk7XG5cbiAgICByZXR1cm4gcmV0VmFsdWU7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmVhcmVyVG9rZW4oKVxue1xuICAgIHZhciBjb29raWVzID0gZ2V0Q29va2llcygpO1xuICAgIHZhciB0b2tlbiA9IGNvb2tpZXNbXCJfYXBpXCJdO1xuXG4gICAgaWYoIHRva2VuICkgcmV0dXJuIFwiQmVhcmVyIFwiICsgdG9rZW47XG4gICAgcmV0dXJuIG51bGw7XG59OyIsImNvbnN0IF9fV0VCUEFDS19OQU1FU1BBQ0VfT0JKRUNUX18gPSBrbzsiLCJpbXBvcnQgaW52ZXJ0LCB7IFJHQiwgUmdiQXJyYXksIEhleENvbG9yLCBCbGFja1doaXRlIH0gZnJvbSAnaW52ZXJ0LWNvbG9yJztcbmltcG9ydCB7IFRTaGFyZURvQmxhZGUgfSBmcm9tICcuLi8uLi8uLi9UeXBpbmdzL1NoYXJlRG9KUy9BZGRFZGl0U2hhcmVkbyc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBJQnV0dG9uR3JvdXAge1xuICAgIG5hbWU6IGtvLk9ic2VydmFibGU8c3RyaW5nPjtcbiAgICBzaG93VGl0bGU6IGtvLk9ic2VydmFibGU8Ym9vbGVhbj47XG4gICAgZW5hYmxlZDoga28uT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgICBvcmRlcjogbnVtYmVyO1xuICAgIGJ1dHRvbnM6IElCdXR0b25bXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQnV0dG9uIHtcbiAgICBncm91cD86IElCdXR0b25Hcm91cDsgLy8gZ3JvdXAgYnV0dG9ucyB0b2dldGhlclxuICAgIGlkOiBzdHJpbmc7XG4gICAgb3JkZXI6IG51bWJlcjsgLy8gb3JkZXIgb2YgdGhlIGJ1dHRvbiBpbiB0aGUgZ3JvdXBcbiAgICB0ZXh0OiBzdHJpbmc7XG4gICAgaWNvbjogc3RyaW5nO1xuICAgIGVuYWJsZWQ6IGtvLk9ic2VydmFibGU8Ym9vbGVhbj47XG4gICAgdmlzaWJsZTogYm9vbGVhbjtcbiAgICBvbkNsaWNrOiBhbnk7XG4gICAgdG9vbHRpcDogc3RyaW5nO1xuICAgIHR5cGU6IEJ1dHRvblR5cGU7IC8vIHByaW1hcnksIHNlY29uZGFyeSwgZGVzdHJ1Y3RpdmUsIHNhdmUgYWRkZWQgdG8gY2xhc3NcbiAgICBjb2xvcjogc3RyaW5nIHwgdW5kZWZpbmVkOyAgLy8gY29sb3Igb2YgdGhlIGJ1dHRvbiBmb3IgZW1waGFzaXNcbiAgICBpc09wdGltdW1QYXRoOiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiB0aGUgb3B0aW11bSBwYXRoIGZvciBjc3NcbiAgICBpc1N5c3RlbUNsb3NlZFBoYXNlOiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiBhIGNsb3NlZCBwaGFzZSBmb3IgY3NzXG4gICAgaXNSZW1vdmVkOiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiBhIHJlbW92ZWQgcGhhc2UgZm9yIGNzc1xuICAgIGlzT3BlbjogYm9vbGVhbjsgLy8gaXMgdGhpcyBidXR0b24gb24gYW4gb3BlbiBwaGFzZSBmb3IgY3NzXG4gICAgaXNTdGFydDogYm9vbGVhbjsgLy8gaXMgdGhpcyBidXR0b24gb24gYSBzdGFydCBwaGFzZSBmb3IgY3NzXG4gICAgaXNSZXBvcnRhYmxlOiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiBhIHJlcG9ydGFibGUgcGhhc2UgZm9yIGNzc1xufVxuXG5leHBvcnQgZW51bSBCdXR0b25UeXBlIHtcbiAgICBkZXN0cnVzdGl2ZSA9IFwiZGVzdHJ1Y3RpdmVcIixcbiAgICBwcmltYXJ5ID0gXCJwcmltYXJ5XCIsXG4gICAgc2Vjb25kYXJ5ID0gXCJzZWNvbmRhcnlcIixcbiAgICBzYXZlID0gXCJzYXZlXCIsXG4gICAgY2FuY2VsID0gXCJjYW5jZWxcIlxufVxuXG5mdW5jdGlvbiBlbnN1cmVCdXR0b25JZHMoYnV0dG9uczogSUJ1dHRvbltdKSB7XG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgIGlmICghYnV0dG9uLmlkKSB7XG4gICAgICAgICAgICBidXR0b24uaWQgPSBcImJ1dHRvbl9cIiArIGJ1dHRvbi5vcmRlcjtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLyoqXG4gKiBDcmVhdGVzIHRoZSBidXR0b24gZ3JvdXAgZWxlbWVudHMgXG4gKiBAcGFyYW0gYnV0dG9uR3JvdXBzIFxuICogQHBhcmFtIGJsYWRlIFxuICogQHJldHVybnMgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZEJ1dHRvbkdyb3VwRWxlbWVudChidXR0b25Hcm91cHM6IElCdXR0b25Hcm91cFtdLCBibGFkZTogVFNoYXJlRG9CbGFkZSk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgYnV0dG9uR3JvdXBFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGJ1dHRvbkdyb3VwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYnV0dG9uLWdyb3Vwc1wiKTtcbiAgICAvL3NvcnQgZ3JvdXBzIGJ5IG9yZGVyXG4gICAgbGV0IHNvcnRlZEJ1dHRvbkdyb3VwcyA9IGJ1dHRvbkdyb3Vwcy5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7XG4gICAgc29ydGVkQnV0dG9uR3JvdXBzLmZvckVhY2goZ3JvdXAgPT4ge1xuICAgICAgICBjb25zdCBncm91cEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBsZXQgY3NzR3JvdXBOYW1lID0gZ3JvdXAubmFtZSgpLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCBcIlwiKTtcbiAgICAgICAgXG4gICAgICAgIGdyb3VwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYnV0dG9uLWdyb3VwXCIpO1xuICAgICAgICBncm91cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjc3NHcm91cE5hbWUpO1xuICAgICAgICBncm91cC5lbmFibGVkLnN1YnNjcmliZSgoZW5hYmxlZCkgPT4ge1xuICAgICAgICAgICAgZ3JvdXBFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCAhZW5hYmxlZCk7XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgYnV0dG9ucyA9IGJ1aWxkQnV0dG9uc0VsZW1lbnQoZ3JvdXAuYnV0dG9ucywgYmxhZGUpO1xuICAgICAgICBncm91cEVsZW1lbnQuYXBwZW5kQ2hpbGQoYnV0dG9ucyk7XG4gICAgICAgIGJ1dHRvbkdyb3VwRWxlbWVudC5hcHBlbmRDaGlsZChncm91cEVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGJ1dHRvbkdyb3VwRWxlbWVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQnV0dG9uc0VsZW1lbnQoYnV0dG9uczogSUJ1dHRvbltdLCBibGFkZTogVFNoYXJlRG9CbGFkZSk6IEhUTUxFbGVtZW50IHtcbiAgICBcbiAgICBjb25zdCBidXR0b25zRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgYnV0dG9uc0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcImJ1dHRvbnNcIik7XG4gICAgaWYgKCFidXR0b25zIHx8IGJ1dHRvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGxldCBub0J1dHRvbnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBub0J1dHRvbnMuaW5uZXJUZXh0ID0gXCJObyBUcmFuc2l0aW9ucyBBdmFpbGFibGVcIjtcbiAgICAgICAgYnV0dG9uc0VsZW1lbnQuYXBwZW5kQ2hpbGQobm9CdXR0b25zKTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbnNFbGVtZW50O1xuICAgIH1cblxuICAgIGVuc3VyZUJ1dHRvbklkcyhidXR0b25zKTtcblxuICAgIGxldCBzb3J0ZWRCdXR0b25zID0gYnV0dG9ucy5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7XG5cbiAgICBzb3J0ZWRCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgY29uc3QgbmV3QnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImJ0blwiKTtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGJ1dHRvbi50eXBlKTtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5pZCA9IGJ1dHRvbi5pZCB8fCBcImJ1dHRvbl9cIiArIGJ1dHRvbi5vcmRlcjtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5pbm5lclRleHQgPSBidXR0b24udGV4dDtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYnV0dG9uLm9uQ2xpY2spO1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmRpc2FibGVkID0gIWJ1dHRvbi5lbmFibGVkKCk7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGJ1dHRvbi52aXNpYmxlID8gXCJibG9ja1wiIDogXCJub25lXCI7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQudGl0bGUgPSBidXR0b24udG9vbHRpcDtcblxuICAgICAgICBhcHBseUJ1dHRvbklzQ2xhc3NlcyhidXR0b24sIG5ld0J1dHRvbkVsZW1lbnQpO1xuXG4gICAgICAgIGJ1dHRvbi5lbmFibGVkLnN1YnNjcmliZSgoZW5hYmxlZCkgPT4ge1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9ICFlbmFibGVkO1xuICAgICAgICAgICAgYXBwbHlCdXR0b25FbXBoYXNpcyhidXR0b24sIGVuYWJsZWQsIG5ld0J1dHRvbkVsZW1lbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZChcImljb25cIik7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZChcImZhXCIpO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoYnV0dG9uLmljb24pO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoXCJmYS14bFwiKTtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5hcHBlbmRDaGlsZChpY29uKTtcbiAgICAgICAgYnV0dG9uc0VsZW1lbnQuYXBwZW5kQ2hpbGQobmV3QnV0dG9uRWxlbWVudCk7XG4gICAgfSlcbiAgICByZXR1cm4gYnV0dG9uc0VsZW1lbnQ7XG5cbiAgICBmdW5jdGlvbiBhcHBseUJ1dHRvbkVtcGhhc2lzKGJ1dHRvbjogSUJ1dHRvbiwgaXNWYWxpZDogYW55LCBuZXdCdXR0b25FbGVtZW50OiBIVE1MQnV0dG9uRWxlbWVudCkge1xuICAgICAgICBsZXQgYm94U2hhZG93ID0gYDAgOHB4IDhweCAtNHB4IGxpZ2h0Z3JheWA7XG4gICAgICAgIGxldCBib3hTaGFkb3dIb3ZlciA9IGAwcHggMHB4IDE3cHggNHB4IGxpZ2h0Z3JheWA7XG4gICAgICAgIGlmIChidXR0b24uY29sb3IpIHtcbiAgICAgICAgICAgIGJveFNoYWRvdyA9IGAwIDhweCA4cHggLTRweCAke2J1dHRvbi5jb2xvcn1gO1xuICAgICAgICAgICAgYm94U2hhZG93SG92ZXIgPSBgMHB4IDBweCAxN3B4IDRweCAke2J1dHRvbi5jb2xvcn1gO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzVmFsaWQpIHtcbiAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuYm94U2hhZG93ID0gYm94U2hhZG93O1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5vbm1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9IGJveFNoYWRvd0hvdmVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5vbm1vdXNlb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuYm94U2hhZG93ID0gYm94U2hhZG93O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSBgYDtcbiAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQub25tb3VzZW92ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSBgYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQub25tb3VzZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9IGBgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhcHBseUJ1dHRvbklzQ2xhc3NlcyhidXR0b246IElCdXR0b24sIG5ld0J1dHRvbkVsZW1lbnQ6IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgaWYgKGJ1dHRvbi5pc09wZW4pIHtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidG9QaGFzZU9wZW5cIik7XG4gICAgfVxuICAgIGlmIChidXR0b24uaXNTdGFydCkge1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0b1BoYXNlU3RhcnRcIik7XG4gICAgfVxuICAgIGlmIChidXR0b24uaXNSZXBvcnRhYmxlKSB7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRvUGhhc2VSZXBvcnRhYmxlXCIpO1xuICAgIH1cbiAgICBpZiAoYnV0dG9uLmlzUmVtb3ZlZCkge1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0b1BoYXNlUmVtb3ZlZFwiKTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbi5pc1N5c3RlbUNsb3NlZFBoYXNlKSB7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRvUGhhc2VTeXN0ZW1DbG9zZWRQaGFzZVwiKTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbi5pc09wdGltdW1QYXRoKSB7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRvUGhhc2VPcHRpbXVtUGF0aFwiKTtcbiAgICB9XG5cbn1cblxuZnVuY3Rpb24gcnVuVGhyb3VnaENvbG9ycyhmb3JDb2xvcjogYW55LCBuZXdCdXR0b25FbGVtZW50OiBIVE1MQnV0dG9uRWxlbWVudCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yQ29sb3IubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBsZXQgcmdiID0gXCJyZ2IoXCIgKyBmb3JDb2xvcltpXS5yICsgXCIsXCIgKyBmb3JDb2xvcltpXS5nICsgXCIsXCIgKyBmb3JDb2xvcltpXS5iICsgXCIpXCI7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtpfSA6YCwgcmdiKTtcbiAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuY29sb3IgPSByZ2I7XG4gICAgICAgIH0sIChpICsgMSkgKiAyMDAwKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgKiBhcyBrbyBmcm9tIFwia25vY2tvdXRcIjtcbmltcG9ydCB7IFBoYXNlLCBUcmFuc2l0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL1R5cGluZ3MvYXBpL1BoYXNlUGxhbi9QaGFzZVBsYW5cIjtcbmltcG9ydCB7IEJ1dHRvblR5cGUsIElCdXR0b24gfSBmcm9tIFwiLi9CdXR0b25CdWlsZGVyXCI7XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRUcmFuc2l0aW9uVG9CdXR0b24gKHRyYW5zaXRpb25zRm9yQnV0dG9uczogVHJhbnNpdGlvbltdLCBwaGFzZVBsYW5zOlBoYXNlW10sIG9wdGlvbnM6IGFueSkgOiBJQnV0dG9uW10ge1xuXG4gICAgbGV0IGJ1dHRvbnM6IElCdXR0b25bXSA9IFtdO1xuICAgIGxldCBpID0gMDtcbiAgICB0cmFuc2l0aW9uc0ZvckJ1dHRvbnMuZm9yRWFjaCgodHJhbnNpdGlvbikgPT4ge1xuICAgIFxuICAgICAgICBsZXQgdG9QaGFzZSA9IHBoYXNlUGxhbnMuZmluZCgocGhhc2UpID0+IHBoYXNlLnN5c3RlbU5hbWUgPT09IHRyYW5zaXRpb24udG9QaGFzZVN5c3RlbU5hbWUpO1xuXG4gICAgICAgIGlmKCF0b1BoYXNlKVxuICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpKys7XG4gICAgICAgIGxldCBidXR0b246IElCdXR0b24gPSB7XG4gICAgICAgICAgICBpZDogdHJhbnNpdGlvbi5zeXN0ZW1OYW1lLFxuICAgICAgICAgICAgb3JkZXI6IGksXG4gICAgICAgICAgICB0ZXh0OiB0cmFuc2l0aW9uLm5hbWUsXG4gICAgICAgICAgICBpY29uOiB0b1BoYXNlLmljb25DbGFzcyB8fCBcIlwiLFxuICAgICAgICAgICAgY29sb3I6IHRvUGhhc2UuY29sb3VyIHx8IFwiXCIsXG4gICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpLFxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IG9wdGlvbnMub25DbGljayxcbiAgICAgICAgICAgIHRvb2x0aXA6IHRvUGhhc2UuZGVzY3JpcHRpb24gfHwgYFByb2dyZXNzIHRvICR7dG9QaGFzZS5uYW1lfSBwaGFzZWAsXG4gICAgICAgICAgICB0eXBlOiBnZXRCdXR0b25UeXBlKHRyYW5zaXRpb24sIHRvUGhhc2UpLFxuICAgICAgICAgICAgaXNPcHRpbXVtUGF0aDogdHJhbnNpdGlvbi5pc09wdGltdW1QYXRoLFxuICAgICAgICAgICAgaXNTeXN0ZW1DbG9zZWRQaGFzZTogdG9QaGFzZS5pc1N5c3RlbUNsb3NlZFBoYXNlLFxuICAgICAgICAgICAgaXNSZW1vdmVkOiB0b1BoYXNlLmlzUmVtb3ZlZCxcbiAgICAgICAgICAgIGlzT3BlbjogdG9QaGFzZS5pc09wZW4sXG4gICAgICAgICAgICBpc1N0YXJ0OiB0b1BoYXNlLmlzU3RhcnQsXG4gICAgICAgICAgICBpc1JlcG9ydGFibGU6IHRvUGhhc2UuaXNSZXBvcnRhYmxlXG4gICAgICAgIH1cbiAgICAgICAgYnV0dG9ucy5wdXNoKGJ1dHRvbik7XG4gICAgfSk7XG5cblxuICAgIGNvbnNvbGUubG9nKGJ1dHRvbnMpO1xuXG4gICAgcmV0dXJuIGJ1dHRvbnM7XG5cblxufVxuXG5mdW5jdGlvbiBnZXRCdXR0b25UeXBlKHRyYW5zaXRpb246IFRyYW5zaXRpb24sIHRvUGhhc2U6IFBoYXNlKTpCdXR0b25UeXBlIHtcbiAgICBcbiAgICBsZXQgcmV0VmFsdWUgPSBCdXR0b25UeXBlLnByaW1hcnk7XG5cbiAgICBpZih0cmFuc2l0aW9uLmlzT3B0aW11bVBhdGggPT09IGZhbHNlKVxuICAgIHtcbiAgICAgICAgcmV0VmFsdWUgPSBCdXR0b25UeXBlLnNlY29uZGFyeTtcbiAgICB9XG5cbiAgICBpZih0b1BoYXNlLmlzUmVtb3ZlZCA9PT0gdHJ1ZSlcbiAgICB7XG4gICAgICAgIHJldFZhbHVlID0gQnV0dG9uVHlwZS5kZXN0cnVzdGl2ZTtcbiAgICB9XG5cbiAgICBpZih0b1BoYXNlLmlzU3lzdGVtQ2xvc2VkUGhhc2UgPT09IHRydWUpXG4gICAge1xuICAgICAgICByZXRWYWx1ZSA9IEJ1dHRvblR5cGUucHJpbWFyeTtcbiAgICB9XG5cblxuXG4gICAgcmV0dXJuIHJldFZhbHVlO1xufVxuIiwiXHJcbmltcG9ydCB7IElQaGFzZVBsYW4sIFRyYW5zaXRpb24gfSBmcm9tIFwiLi4vLi4vLi4vVHlwaW5ncy9hcGkvUGhhc2VQbGFuL1BoYXNlUGxhblwiO1xyXG5pbXBvcnQgeyBnZXRQaGFzZVBsYW4gfSBmcm9tIFwiLi9TYXZlU3VibWl0Q2FuY2VsQXNwZWN0QWdlbnRcIjtcclxuaW1wb3J0ICogYXMga28gZnJvbSBcImtub2Nrb3V0XCI7XHJcbmltcG9ydCB7IGNvbnZlcnRUcmFuc2l0aW9uVG9CdXR0b24gfSBmcm9tIFwiLi9UcmFuc2l0aW9uVG9CdXR0b25Db252ZXJ0ZXJcIjtcclxuaW1wb3J0IHsgQnV0dG9uVHlwZSwgSUJ1dHRvbiwgSUJ1dHRvbkdyb3VwLCBidWlsZEJ1dHRvbkdyb3VwRWxlbWVudCB9IGZyb20gXCIuL0J1dHRvbkJ1aWxkZXJcIjtcclxubGV0IHRoaXNXaWRnZXRTeXN0ZW1OYW1lID0gXCJTYXZlU3VibWl0Q2FuY2VsQXNwZWN0XCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENvbmZpZ3VyYXRpb24ge1xyXG4gICAgX2hvc3Q6IEhvc3Q7XHJcbiAgICBldmVudFRvRmlyZVNhdmVPbjogYW55O1xyXG4gICAgc2luZ2xlRXZlbnQ/OiBib29sZWFuO1xyXG4gICAgcnVuU2F2ZUFmdGVyTWlsbGlzZWNvbmRzPzogbnVtYmVyO1xyXG4gICAgZGVidWc/OiBEZWJ1ZyB8IG51bGw7XHJcbn1cclxuXHJcbmludGVyZmFjZSBEZWZhdWx0cyB7XHJcbiAgICBkZWJ1ZzogRGVidWcgfCBudWxsIHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBIb3N0IHtcclxuICAgIG1vZGVsOiBIb3N0TW9kZWwgfCBudWxsO1xyXG4gICAgYmxhZGU6IGFueSB8IG51bGw7XHJcbiAgICBlbmFibGVkOiBib29sZWFuIHwgbnVsbDtcclxuICAgIHRvb2xiYXJDb250ZXh0PzogYW55IHwgbnVsbDtcclxuICAgIGJ1cmdlckNvbnRleHQ/OiBhbnkgfCBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEhvc3RNb2RlbCB7XHJcbiAgICB0aXRsZTogc3RyaW5nO1xyXG4gICAgaW5zdGFuY2VJZDogc3RyaW5nO1xyXG4gICAgcGFyZW50U2hhcmVkb0lkOiBzdHJpbmc7XHJcbiAgICBpZDogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERlYnVnIHtcclxuICAgIGVuYWJsZWQ/OiBib29sZWFuIHwgbnVsbDtcclxuICAgIGxvZ1RvQ29uc29sZT86IGJvb2xlYW4gfCBudWxsO1xyXG4gICAgc2hvd0V2ZW50cz86IGJvb2xlYW4gfCBudWxsO1xyXG4gICAgc2hvd0luQXNwZWN0PzogYm9vbGVhbiB8IG51bGw7XHJcbn1cclxuXHJcbnR5cGUgT3B0aW9ucyA9IENvbmZpZ3VyYXRpb24gfCBEZWZhdWx0cyB8IHtcclxuICAgIHRpdGxlOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkO1xyXG4gICAgc2F2ZVJ1bnM6IG51bWJlcjtcclxuICAgIGV2ZW50VG9GaXJlU2F2ZU9uOiBhbnk7XHJcbiAgICBkZWJ1ZzogRGVidWdcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBTYXZlU3VibWl0Q2FuY2VsIHtcclxuXHJcbiAgICBwcml2YXRlIGZpcmVkRXZlbnRzOiBhbnlbXTtcclxuICAgIHByaXZhdGUgbW9uaXRvcmVkSGFuZGxlcnM6IGFueVtdO1xyXG4gICAgcHJpdmF0ZSByZWFkeUZvclNhdmU6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIG9wdGlvbnM/OiBDb25maWd1cmF0aW9uO1xyXG4gICAgcHJpdmF0ZSBkaXNwb3NhYmxlcz86IGFueVtdO1xyXG4gICAgcHJpdmF0ZSBlbmFibGVkPzogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgaW5zdGFuY2VJZD86IHN0cmluZztcclxuICAgIHByaXZhdGUgZWxlbWVudD86IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBibGFkZTogYW55O1xyXG4gICAgcHJpdmF0ZSBwYXJlbnRTaGFyZWRvSWQ/OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHRvb2xiYXJDb250ZXh0OiBhbnk7XHJcbiAgICBwcml2YXRlIGJ1cmdlckNvbnRleHQ6IGFueTtcclxuICAgIHByaXZhdGUgc2hhcmVkb0lkOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSBzaGFyZWRvVHlwZVN5c3RlbU5hbWU6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICBwcml2YXRlIHJlbG9hZGluZz86IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIG1vZGVsOiBPcHRpb25zO1xyXG4gICAgcHJpdmF0ZSBpc1ZhbGlkVGVtcDogYW55O1xyXG4gICAgcHJpdmF0ZSBwaGFzZVBsYW46ICBrby5PYnNlcnZhYmxlPElQaGFzZVBsYW4gfCB1bmRlZmluZWQ+O1xyXG4gICAgaG9zdE1vZGVsOiBIb3N0TW9kZWwgfCBudWxsO1xyXG4gICAgY3VycmVudFBoYXNlU3lzdGVtTmFtZToga28uT2JzZXJ2YWJsZTxzdHJpbmcgfCB1bmRlZmluZWQ+IHwgIHVuZGVmaW5lZDtcclxuICAgIGJ1dHRvbkdyb3VwRWxlbWVudDogSFRNTEVsZW1lbnQgfCB1bmRlZmluZWQ7XHJcbiAgICBidXR0b25Hcm91cHM6IElCdXR0b25Hcm91cFtdIHwgdW5kZWZpbmVkO1xyXG4gICAgc2F2ZVN1Ym1pdENhbmNlbEVsZW1lbnQ6IGFueTtcclxuICAgIFxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBjb25maWd1cmF0aW9uOiBDb25maWd1cmF0aW9uLCBiYXNlTW9kZWw6IGFueSkge1xyXG4gICAgICAgIHRoaXMubW9uaXRvckhhbmRsZXJzKCk7XHJcbiAgICAgICAgdGhpcy5maXJlZEV2ZW50cyA9IFtdO1xyXG4gICAgICAgIHRoaXMubW9uaXRvcmVkSGFuZGxlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLnJlYWR5Rm9yU2F2ZSA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBkZWZhdWx0czogRGVmYXVsdHMgPVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQXNwZWN0IHdpZGdldCBjb25maWcgcGFyYW1ldGVyc1xyXG4gICAgICAgICAgICBkZWJ1Zzoge1xyXG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBsb2dUb0NvbnNvbGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2hvd0V2ZW50czogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93SW5Bc3BlY3Q6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG9wdGlvbnM6IE9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIGNvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAgIHRoaXMuYmxhZGUgPSBjb25maWd1cmF0aW9uLl9ob3N0LmJsYWRlO1xyXG4gICAgICAgIHRoaXMuaG9zdE1vZGVsID0gY29uZmlndXJhdGlvbi5faG9zdC5tb2RlbDtcclxuICAgICAgICB0aGlzLm1vZGVsID1cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgcmVmZXJlbmNpbmcgYSBzdGFuZGFyZCBvYnNlcnZhYmxlIGl0ZW0gZnJvbSB0aGUgbWFpbiBtb2RlbFxyXG4gICAgICAgICAgICB0aXRsZTogY29uZmlndXJhdGlvbi5faG9zdD8ubW9kZWw/LnRpdGxlLFxyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBjb25maWd1cmVkIG1lc3NhZ2UgYWdhaW5zdCB0aGUgYXNwZWN0IGluc3RhbmNlXHJcbiAgICAgICAgICAgIHNhdmVSdW5zOiAwLFxyXG4gICAgICAgICAgICBkZWJ1Zzogb3B0aW9ucy5kZWJ1ZyxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMucGhhc2VQbGFuID0ga28ub2JzZXJ2YWJsZTxJUGhhc2VQbGFuIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xyXG4gICAgICAgIHRoaXMucGhhc2VQbGFuLnN1YnNjcmliZSh0aGlzLmhhbmRsZVBoYXNlUGxhbkNoYW5nZS5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLmxvZyhcIkluaXRcIiwgJ2JhY2tncm91bmQ6ICMyMjI7IGNvbG9yOiAjYmFkYTU1Jyk7XHJcblxyXG4gICAgICAgIC8vIGlmICh0aGlzLm1vZGVsLmV2ZW50VG9GaXJlU2F2ZU9uKSB7XHJcbiAgICAgICAgLy8gICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBbXHJcbiAgICAgICAgLy8gICAgICAgICAkdWkuZXZlbnRzLnN1YnNjcmliZSh0aGlzLm1vZGVsLmV2ZW50VG9GaXJlU2F2ZU9uLCB0aGlzLnNhdmUsIHRoaXMpXHJcbiAgICAgICAgLy8gICAgIF07XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICAvLyBFdmVyeSB3aWRnZXQgZ2V0cyB0aGlzXHJcbiAgICAgICAgdGhpcy5lbmFibGVkID0gY29uZmlndXJhdGlvbi5faG9zdC5ibGFkZS5lbmFibGVkO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VJZCA9IHRoaXMuaG9zdE1vZGVsPy5pbnN0YW5jZUlkO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5ibGFkZSA9IGNvbmZpZ3VyYXRpb24uX2hvc3QuYmxhZGVcclxuICAgICAgICB0aGlzLnBhcmVudFNoYXJlZG9JZCA9IHRoaXMuaG9zdE1vZGVsPy5wYXJlbnRTaGFyZWRvSWQ7XHJcbiAgICAgICAgdGhpcy50b29sYmFyQ29udGV4dCA9IGNvbmZpZ3VyYXRpb24uX2hvc3QudG9vbGJhckNvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5idXJnZXJDb250ZXh0ID0gY29uZmlndXJhdGlvbi5faG9zdC5idXJnZXJDb250ZXh0O1xyXG4gICAgICAgIHRoaXMuc2hhcmVkb0lkID0gdGhpcy5ob3N0TW9kZWw/LmlkO1xyXG4gICAgICAgIHRoaXMucmVsb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zaGFyZWRvVHlwZVN5c3RlbU5hbWUgPSB0aGlzLmJsYWRlLm1vZGVsLnNoYXJlZG9UeXBlU3lzdGVtTmFtZSgpXHJcbiAgICAgICAgdGhpcy5jdXJyZW50UGhhc2VTeXN0ZW1OYW1lID0gdGhpcy5ibGFkZS5tb2RlbC5waGFzZVN5c3RlbU5hbWUoKVxyXG5cclxuICAgXHJcblxyXG4gICAgICAgIHRoaXMuYWRkRGVidWdJZlJlcXVpcmVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlUGhhc2VQbGFuQ2hhbmdlKHBoYXNlUGxhbjogSVBoYXNlUGxhbiB8IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMubG9nKFwiUGhhc2UgUGxhbiBDaGFuZ2VkXCIsIFwicmVkXCIsIHBoYXNlUGxhbik7XHJcblxyXG4gICAgICAgIGlmKCFwaGFzZVBsYW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBnZXQgYWxsIHRoZSB0cmFuc2l0aW9ucyBmb3IgdGhlIGN1cnJlbnQgcGhhc2VcclxuICAgICAgICBsZXQgdHJhbnNpdGlvbnMgOiBUcmFuc2l0aW9uW107XHJcblxyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudFBoYXNlU3lzdGVtTmFtZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuY3VycmVudFBoYXNlU3lzdGVtTmFtZSgpICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgeyAgICAgICAgXHJcbiAgICAgICAgICAgICB0cmFuc2l0aW9ucyA9IHBoYXNlUGxhbi50cmFuc2l0aW9ucy5maWx0ZXIodCA9PiB0LmZyb21QaGFzZVN5c3RlbU5hbWUgPT0gdGhpcy5jdXJyZW50UGhhc2VTeXN0ZW1OYW1lISgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGV0IHN0YXJ0UGhhc2UgPSBwaGFzZVBsYW4ucGhhc2VzLmZpbmQocCA9PiBwLmlzU3RhcnQgPT0gdHJ1ZSk7XHJcbiAgICAgICAgICAgIGlmKCFzdGFydFBoYXNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIk5vIFN0YXJ0IFBoYXNlXCIsXCJyZWRcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHJhbnNpdGlvbnMgPSBwaGFzZVBsYW4udHJhbnNpdGlvbnMuZmlsdGVyKHQgPT4gdC5mcm9tUGhhc2VTeXN0ZW1OYW1lID09IHN0YXJ0UGhhc2U/LnN5c3RlbU5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG9uQ2xpY2sgOiAodHJhbnNpdGlvbjogVHJhbnNpdGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2coXCJUcmFuc2l0aW9uIENsaWNrZWRcIiwgXCJyZWRcIiwgdHJhbnNpdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL1JlbW92ZSBleGlzdGluZyBidXR0b25zXHJcbiAgICAgICAgaWYodGhpcy5idXR0b25Hcm91cEVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvbkdyb3VwRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiBcclxuICAgICAgICB0aGlzLmxvZyhcIlRyYW5zaXRpb25zIHRvIGNvbnZlcnRcIiwgXCJncmVlblwiLCB0cmFuc2l0aW9ucy5sZW5ndGgpO1xyXG5cclxuICAgICAgICAvL0NyZWF0ZSBTYXZlIGFuZCBDYW5jZWwgQnV0dG9uc1xyXG4gICAgICAgIGxldCBzeXN0ZW1UcmFuc2l0aW9uR3JvdXAgOiBJQnV0dG9uR3JvdXAgPSB7XHJcbiAgICAgICAgICAgIG9yZGVyOiAwLFxyXG4gICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpLFxyXG4gICAgICAgICAgICBzaG93VGl0bGU6IGtvLm9ic2VydmFibGUodHJ1ZSksXHJcbiAgICAgICAgICAgIG5hbWU6IGtvLm9ic2VydmFibGUoXCJTeXN0ZW1cIiksXHJcbiAgICAgICAgICAgIGJ1dHRvbnM6IHRoaXMuY3JlYXRlU3lzdGVtQnV0dG9ucygpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9DcmVhdGUgUGhhc2UgUGxhbiBCdXR0b25zXHJcbiAgICAgICAgbGV0IGJ1dHRvblRyYW5zaXRpb25Hcm91cCA6IElCdXR0b25Hcm91cCA9IHtcclxuICAgICAgICAgICAgb3JkZXI6IDEsXHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRoaXMuYmxhZGUuaXNWYWxpZCxcclxuICAgICAgICAgICAgc2hvd1RpdGxlOiBrby5vYnNlcnZhYmxlKHRydWUpLFxyXG4gICAgICAgICAgICBuYW1lOiBrby5vYnNlcnZhYmxlKFwiUGhhc2UgUGxhblwiKSxcclxuICAgICAgICAgICAgYnV0dG9uczogY29udmVydFRyYW5zaXRpb25Ub0J1dHRvbih0cmFuc2l0aW9ucyxwaGFzZVBsYW4ucGhhc2VzLG9wdGlvbnMpXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvL0NyZWF0ZSBCdXR0b24gR3JvdXBzIGFuZCBhZGQgU3lzdGVtIGFuZCBQaGFzZSBQbGFuIEJ1dHRvbnMgXHJcbiAgICAgICAgdGhpcy5idXR0b25Hcm91cHMgPSBbYnV0dG9uVHJhbnNpdGlvbkdyb3VwLHN5c3RlbVRyYW5zaXRpb25Hcm91cF07XHJcbiAgICAgICAgLy9HZW5lcmF0ZSBCdXR0b25zIEdyb3VwIEVsZW1lbnRzXHJcbiAgICAgICAgdGhpcy5idXR0b25Hcm91cEVsZW1lbnQgPSBidWlsZEJ1dHRvbkdyb3VwRWxlbWVudCh0aGlzLmJ1dHRvbkdyb3VwcywgdGhpcy5ibGFkZSk7XHJcbiAgICAgICAgLy9BZGQgQnV0dG9ucyB0byB0aGUgQXNwZWN0XHJcblxyXG4gICAgICAgIC8vZmluZCBzYXZlLXN1Ym1pdC1jYW5jZWwgY2xhc3MgaW4gdGhpcy5lbGVtZW50XHJcbiAgICAgICAgdGhpcy5zYXZlU3VibWl0Q2FuY2VsRWxlbWVudCA9IHRoaXMuZWxlbWVudCEucXVlcnlTZWxlY3RvcihcIi5zYXZlLXN1Ym1pdC1jYW5jZWxcIik7XHJcbiAgICBcclxuICAgICAgICBpZighdGhpcy5zYXZlU3VibWl0Q2FuY2VsRWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubG9nKFwiU2F2ZSBTdWJtaXQgQ2FuY2VsIEVsZW1lbnQgTm90IEZvdW5kXCIsIFwicmVkXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2F2ZVN1Ym1pdENhbmNlbEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5idXR0b25Hcm91cEVsZW1lbnQpO1xyXG4gICAgICAgIFxyXG4gXHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVN5c3RlbUJ1dHRvbnMoKSB7XHJcbiAgICAgICAgbGV0IHJldFZhbHVlOiBJQnV0dG9uW10gPSBbXTtcclxuICAgICAgICBsZXQgc2F2ZUJ1dHRvbjogSUJ1dHRvbiA9IHtcclxuICAgICAgICAgICAgb3JkZXI6IDEsXHJcbiAgICAgICAgICAgIHRleHQ6IFwiU2F2ZVwiLFxyXG4gICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVDbGlja2VkKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlkOiBcIlwiLFxyXG4gICAgICAgICAgICBpY29uOiBcImZhLXNhdmVcIixcclxuICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKSxcclxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgdG9vbHRpcDogXCJTYXZlIHRoZSBjdXJyZW50IHJlY29yZFwiLFxyXG4gICAgICAgICAgICB0eXBlOiBCdXR0b25UeXBlLnNhdmUsXHJcbiAgICAgICAgICAgIGNvbG9yOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGlzT3B0aW11bVBhdGg6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1N5c3RlbUNsb3NlZFBoYXNlOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNSZW1vdmVkOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNPcGVuOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNTdGFydDogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzUmVwb3J0YWJsZTogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldFZhbHVlLnB1c2goc2F2ZUJ1dHRvbik7XHJcblxyXG4gICAgICAgIGxldCBjYW5jZWxCdXR0b246IElCdXR0b24gPSB7XHJcbiAgICAgICAgICAgIG9yZGVyOiAyLFxyXG4gICAgICAgICAgICB0ZXh0OiBcIkNhbmNlbFwiLFxyXG4gICAgICAgICAgICBvbkNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVDbGlja2VkKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlkOiBcIlwiLFxyXG4gICAgICAgICAgICBpY29uOiBcImZhLXRpbWVzXCIsXHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSksXHJcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgIHRvb2x0aXA6IFwiQ2FuY2VsIHRoZSBjdXJyZW50IHJlY29yZFwiLFxyXG4gICAgICAgICAgICB0eXBlOiBCdXR0b25UeXBlLmNhbmNlbCxcclxuICAgICAgICAgICAgY29sb3I6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgaXNPcHRpbXVtUGF0aDogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzU3lzdGVtQ2xvc2VkUGhhc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1JlbW92ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc09wZW46IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1N0YXJ0OiBmYWxzZSxcclxuICAgICAgICAgICAgaXNSZXBvcnRhYmxlOiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0VmFsdWUucHVzaChjYW5jZWxCdXR0b24pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmV0VmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgYnkgdGhlIFVJIGZyYW1ld29yayBhZnRlciBpbml0aWFsIGNyZWF0aW9uIGFuZCBiaW5kaW5nIHRvIGxvYWQgZGF0YVxyXG4gICAgICogaW50byBpdCdzIG1vZGVsXHJcbiAgICAgKi9cclxuICAgIGxvYWRBbmRCaW5kKCkge1xyXG4gICAgICAgIHRoaXMubG9nKFwiTG9hZCBBbmQgQmluZFwiKTtcclxuXHJcbiAgICAgICAgaWYoIXRoaXMuc2hhcmVkb1R5cGVTeXN0ZW1OYW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5sb2coXCJObyBTaGFyZWRvIFR5cGUgTmFtZVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBnZXRQaGFzZVBsYW4odGhpcy5zaGFyZWRvVHlwZVN5c3RlbU5hbWUpLnRoZW4oKHBoYXNlUGxhbikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvZyhcIlBoYXNlIFBsYW4gTG9hZGVkXCIsXCJyZWRcIixwaGFzZVBsYW4pO1xyXG4gICAgICAgICAgICB0aGlzLnBoYXNlUGxhbihwaGFzZVBsYW4pO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGxvYWQobW9kZWw6IGFueSkge1xyXG4gICAgICAgIHRoaXMubG9nKFwiTG9hZFwiKTtcclxuICAgIH07IFxyXG5cclxuICAgIHJlbG9hZChtb2RlbDogYW55KSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJSZWxvYWRcIik7XHJcbiAgICB9O1xyXG4gIFxyXG4gXHJcbiAgICBzYXZlQ2xpY2tlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyAuLi4gYXMgaW4geW91ciBKYXZhU2NyaXB0IGNvZGVcclxuICAgIH1cclxuXHJcbiAgICBzYXZlKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG4gICAgfVxyXG5cclxuICAgIC8vIC4uLiByZXN0IG9mIHlvdXIgbWV0aG9kcyBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG5cclxuICAgIHJ1blNhdmVXaXRoTm9WYWxpZGF0aW9uKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG4gICAgfVxyXG5cclxuICAgIGFyZUFsbEFzcGVjdHNMb2FkZWQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8gLi4uIGFzIGluIHlvdXIgSmF2YVNjcmlwdCBjb2RlXHJcbiAgICB9XHJcblxyXG4gICAgc2F2ZUNvbXBsZXRlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyAuLi4gYXMgaW4geW91ciBKYXZhU2NyaXB0IGNvZGVcclxuICAgIH1cclxuXHJcbiAgICBtb25pdG9ySGFuZGxlcnMoaXNTYXZlU3VibWl0Q2FuY2VsPzogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZSBcclxuICAgIH1cclxuXHJcbiAgICBhZGRTdWJzY3JpcHRpb24oZXZlbnROYW1lOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICAvLyAuLi4gYXMgaW4geW91ciBKYXZhU2NyaXB0IGNvZGVcclxuICAgIH1cclxuXHJcbiAgICAvLyAuLi4gYWxsIG90aGVyIG1ldGhvZHMgc2ltaWxhciB0byB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICBsb2cobWVzc2FnZTogc3RyaW5nLCBjb2xvcj86IHN0cmluZywgZGF0YT86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsLmRlYnVnPy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmRlYnVnLmxvZ1RvQ29uc29sZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCVjICR7dGhpc1dpZGdldFN5c3RlbU5hbWV9IC0gJHttZXNzYWdlfWAsIGNvbG9yLCBkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkZERlYnVnSWZSZXF1aXJlZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RlbD8uZGVidWc/LmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgKHdpbmRvdyBhcyBhbnkpLmFzcGVjdERlYnVnID0gKHdpbmRvdyBhcyBhbnkpLmFzcGVjdERlYnVnIHx8IHt9O1xyXG4gICAgICAgICAgICAod2luZG93IGFzIGFueSkuYXNwZWN0RGVidWdbdGhpc1dpZGdldFN5c3RlbU5hbWVdID0gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwiZ2V0UGhhc2VQbGFuIiwid29ya1R5cGVTeXN0ZW1OYW1lIiwiYXBpIiwibWV0aG9kIiwiZGF0YSIsInVybCIsImxvY2F0aW9uIiwid2luZG93IiwiZG9jdW1lbnQiLCJvcmlnaW4iLCJpbmRleE9mIiwidmFsaWRhdGVBcGkiLCJmZXRjaEhlYWRlcnMiLCJiZWFyZXIiLCJ0b2tlbiIsInJldFZhbHVlIiwiY29va2llIiwic3BsaXQiLCJyZWR1Y2UiLCJjb29raWVzIiwicGFydHMiLCJsZW5ndGgiLCJ0cmltIiwiZ2V0Q29va2llcyIsIkhlYWRlcnMiLCJhcHBlbmQiLCJidWlsZEhlYWRlcnMiLCJmZXRjaCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVuZGVmaW5lZCIsInRoZW4iLCJyZXNwb25zZSIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImpzb24iLCJleGVjdXRlRmV0Y2giLCJleGVjdXRlR2V0IiwiY2F0Y2giLCJlcnJvciIsImtvIiwiQnV0dG9uVHlwZSIsImNvbnZlcnRUcmFuc2l0aW9uVG9CdXR0b24iLCJ0cmFuc2l0aW9uc0ZvckJ1dHRvbnMiLCJwaGFzZVBsYW5zIiwib3B0aW9ucyIsImJ1dHRvbnMiLCJpIiwiZm9yRWFjaCIsInRyYW5zaXRpb24iLCJ0b1BoYXNlIiwiZmluZCIsInBoYXNlIiwic3lzdGVtTmFtZSIsInRvUGhhc2VTeXN0ZW1OYW1lIiwiYnV0dG9uIiwiaWQiLCJvcmRlciIsInRleHQiLCJuYW1lIiwiaWNvbiIsImljb25DbGFzcyIsImNvbG9yIiwiY29sb3VyIiwiZW5hYmxlZCIsInZpc2libGUiLCJvbkNsaWNrIiwidG9vbHRpcCIsImRlc2NyaXB0aW9uIiwidHlwZSIsImdldEJ1dHRvblR5cGUiLCJpc09wdGltdW1QYXRoIiwiaXNTeXN0ZW1DbG9zZWRQaGFzZSIsImlzUmVtb3ZlZCIsImlzT3BlbiIsImlzU3RhcnQiLCJpc1JlcG9ydGFibGUiLCJwdXNoIiwicHJpbWFyeSIsInNlY29uZGFyeSIsImRlc3RydXN0aXZlIiwidGhpc1dpZGdldFN5c3RlbU5hbWUiLCJTYXZlU3VibWl0Q2FuY2VsIiwiY29uc3RydWN0b3IiLCJlbGVtZW50IiwiY29uZmlndXJhdGlvbiIsImJhc2VNb2RlbCIsInRoaXMiLCJtb25pdG9ySGFuZGxlcnMiLCJmaXJlZEV2ZW50cyIsIm1vbml0b3JlZEhhbmRsZXJzIiwicmVhZHlGb3JTYXZlIiwiJCIsImV4dGVuZCIsImRlYnVnIiwibG9nVG9Db25zb2xlIiwic2hvd0V2ZW50cyIsInNob3dJbkFzcGVjdCIsImJsYWRlIiwiX2hvc3QiLCJob3N0TW9kZWwiLCJtb2RlbCIsInRpdGxlIiwic2F2ZVJ1bnMiLCJwaGFzZVBsYW4iLCJzdWJzY3JpYmUiLCJoYW5kbGVQaGFzZVBsYW5DaGFuZ2UiLCJiaW5kIiwiaW5zdGFuY2VJZCIsInBhcmVudFNoYXJlZG9JZCIsInRvb2xiYXJDb250ZXh0IiwiYnVyZ2VyQ29udGV4dCIsInNoYXJlZG9JZCIsInJlbG9hZGluZyIsInNoYXJlZG9UeXBlU3lzdGVtTmFtZSIsImN1cnJlbnRQaGFzZVN5c3RlbU5hbWUiLCJwaGFzZVN5c3RlbU5hbWUiLCJhZGREZWJ1Z0lmUmVxdWlyZWQiLCJ0cmFuc2l0aW9ucyIsImZpbHRlciIsInQiLCJmcm9tUGhhc2VTeXN0ZW1OYW1lIiwic3RhcnRQaGFzZSIsInBoYXNlcyIsInAiLCJidXR0b25Hcm91cEVsZW1lbnQiLCJyZW1vdmUiLCJzeXN0ZW1UcmFuc2l0aW9uR3JvdXAiLCJzaG93VGl0bGUiLCJjcmVhdGVTeXN0ZW1CdXR0b25zIiwiYnV0dG9uVHJhbnNpdGlvbkdyb3VwIiwiaXNWYWxpZCIsImJ1dHRvbkdyb3VwcyIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzb3J0IiwiYSIsImIiLCJncm91cCIsImdyb3VwRWxlbWVudCIsImNzc0dyb3VwTmFtZSIsInJlcGxhY2UiLCJ0b2dnbGUiLCJidXR0b25zRWxlbWVudCIsIm5vQnV0dG9ucyIsImlubmVyVGV4dCIsImFwcGVuZENoaWxkIiwiZW5zdXJlQnV0dG9uSWRzIiwibmV3QnV0dG9uRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNhYmxlZCIsInN0eWxlIiwiZGlzcGxheSIsImFwcGx5QnV0dG9uSXNDbGFzc2VzIiwiYm94U2hhZG93IiwiYm94U2hhZG93SG92ZXIiLCJvbm1vdXNlb3ZlciIsIm9ubW91c2VvdXQiLCJhcHBseUJ1dHRvbkVtcGhhc2lzIiwiYnVpbGRCdXR0b25zRWxlbWVudCIsImJ1aWxkQnV0dG9uR3JvdXBFbGVtZW50Iiwic2F2ZVN1Ym1pdENhbmNlbEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2F2ZUJ1dHRvbiIsInNhdmVDbGlja2VkIiwic2F2ZSIsImNhbmNlbEJ1dHRvbiIsImNhbmNlbCIsImxvYWRBbmRCaW5kIiwibG9hZCIsInJlbG9hZCIsInJ1blNhdmVXaXRoTm9WYWxpZGF0aW9uIiwiYXJlQWxsQXNwZWN0c0xvYWRlZCIsInNhdmVDb21wbGV0ZWQiLCJpc1NhdmVTdWJtaXRDYW5jZWwiLCJhZGRTdWJzY3JpcHRpb24iLCJldmVudE5hbWUiLCJtZXNzYWdlIiwiYXNwZWN0RGVidWciXSwic291cmNlUm9vdCI6IiJ9