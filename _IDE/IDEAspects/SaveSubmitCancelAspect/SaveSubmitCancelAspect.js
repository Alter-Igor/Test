(()=>{var e={d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{SaveSubmitCancel:()=>d});var o=function(e,t,o,s){return new(o||(o=Promise))((function(n,i){function a(e){try{r(s.next(e))}catch(e){i(e)}}function l(e){try{r(s.throw(e))}catch(e){i(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}r((s=s.apply(e,t||[])).next())}))};const s=function(e){return t=this,s=void 0,i=function*(){return function(e){return o(this,void 0,void 0,(function*(){return function(e,t,s){return o(this,void 0,void 0,(function*(){let o=function(e){let t=window.document.location.origin;return-1===e.indexOf(t)&&(0!==e.indexOf("/")&&(e="/"+e),e=t+e),e}(e),n=function(){let e=(o=function(){let e={};return document.cookie.split(";").reduce((function(t,o){var s=o.split("=");if(2===s.length){var n=s[0].trim(),i=s[1];e[n]=i}return t}),{}),e}()._api)?"Bearer "+o:null,t=new Headers;var o;return t.append("Content-Type","application/json"),e&&t.append("Authorization",e),t}();return yield fetch(o,{method:t,headers:n,body:s?JSON.stringify(s):void 0}).then((e=>{var t;if(console.log(e),-1===(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.indexOf("application/json")))throw new Error("Response was not JSON");return e.json()}))}))}(e,"GET",void 0)}))}(`/api/modeller/sharedoTypes/${e}/phasePlan`).then((e=>{if(console.log("%c loadWorkItem","color: #ff0000"),console.log(e),e)return e;throw new Error("Not found")})).catch((e=>{console.error("Error:",e)}))},new((n=void 0)||(n=Promise))((function(e,o){function a(e){try{r(i.next(e))}catch(e){o(e)}}function l(e){try{r(i.throw(e))}catch(e){o(e)}}function r(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(a,l)}r((i=i.apply(t,s||[])).next())}));var t,s,n,i},n=ko;var i;function a(e,t,o){let s=[],i=0;return e.forEach((e=>{let a=t.find((t=>t.systemName===e.toPhaseSystemName));if(!a)return;i++;let r={id:e.systemName,order:i,text:e.name,icon:a.iconClass||"",color:a.colour||"",enabled:n.observable(!0),visible:!0,onClick:o.onClick,tooltip:a.description||`Progress to ${a.name} phase`,type:l(e,a),isOptimumPath:e.isOptimumPath,isSystemClosedPhase:a.isSystemClosedPhase,isRemoved:a.isRemoved,isOpen:a.isOpen,isStart:a.isStart,isReportable:a.isReportable};s.push(r)})),console.log(s),s}function l(e,t){let o=i.primary;return!1===e.isOptimumPath&&(o=i.secondary),!0===t.isRemoved&&(o=i.destrustive),!0===t.isSystemClosedPhase&&(o=i.primary),o}!function(e){e.destrustive="destructive",e.primary="primary",e.secondary="secondary",e.save="save",e.cancel="cancel"}(i||(i={}));let r="SaveSubmitCancelAspect";document.head.insertAdjacentHTML("beforeend",'<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">');class d{constructor(e,t,o){var s,i,a,l,r;this.monitorHandlers(),this.firedEvents=[],this.monitoredHandlers=[],this.readyForSave=!1;let d=$.extend(!0,{},{debug:{enabled:!1,logToConsole:!1,showEvents:!1,showInAspect:!1}},t);this.blade=t._host.blade,this.hostModel=t._host.model,this.model={title:null===(i=null===(s=t._host)||void 0===s?void 0:s.model)||void 0===i?void 0:i.title,saveRuns:0,debug:d.debug},this.phasePlan=n.observable(void 0),this.phasePlan.subscribe(this.handlePhasePlanChange.bind(this)),this.log("Init","background: #222; color: #bada55"),this.enabled=t._host.blade.enabled,this.instanceId=null===(a=this.hostModel)||void 0===a?void 0:a.instanceId,this.element=e,this.blade=t._host.blade,this.parentSharedoId=null===(l=this.hostModel)||void 0===l?void 0:l.parentSharedoId,this.toolbarContext=t._host.toolbarContext,this.burgerContext=t._host.burgerContext,this.sharedoId=null===(r=this.hostModel)||void 0===r?void 0:r.id,this.reloading=!1,this.sharedoTypeSystemName=this.blade.model.sharedoTypeSystemName(),this.currentPhaseSystemName=this.blade.model.phaseSystemName(),this.addDebugIfRequired()}handlePhasePlanChange(e){if(this.log("Phase Plan Changed","red",e),!e)return;let t;if(void 0!==this.currentPhaseSystemName&&void 0!==this.currentPhaseSystemName())t=e.transitions.filter((e=>e.fromPhaseSystemName==this.currentPhaseSystemName()));else{let o=e.phases.find((e=>1==e.isStart));if(!o)return void this.log("No Start Phase","red");t=e.transitions.filter((e=>e.fromPhaseSystemName==(null==o?void 0:o.systemName)))}let o={onClick:e=>{this.log("Transition Clicked","red",e)}};this.buttonGroupElement&&this.buttonGroupElement.remove(),this.log("Transitions to convert","green",t.length);let s={order:0,enabled:n.observable(!0),showTitle:n.observable(!0),name:n.observable("System"),buttons:this.createSystemButtons()},i={order:1,enabled:this.blade.isValid,showTitle:n.observable(!0),name:n.observable("Phase Plan"),buttons:a(t,e.phases,o)};this.buttonGroups=[i,s],this.buttonGroupElement=function(e,t){let o=document.createElement("div");return o.classList.add("button-groups"),e.sort(((e,t)=>e.order-t.order)).forEach((e=>{const t=document.createElement("div");let s=e.name().replace(/[^a-zA-Z0-9]/g,"");t.classList.add("button-group"),t.classList.add(s),e.enabled.subscribe((e=>{t.classList.toggle("disabled",!e)}));let n=function(e,t){const o=document.createElement("div");if(o.classList.add("buttons"),!e||0===e.length){let e=document.createElement("div");return e.innerText="No Transitions Available",o.appendChild(e),o}return function(e){e.forEach((e=>{e.id||(e.id="button_"+e.order)}))}(e),e.sort(((e,t)=>e.order-t.order)).forEach((e=>{const t=document.createElement("button");t.classList.add("btn"),t.classList.add(e.type),t.id=e.id||"button_"+e.order,t.innerText=e.text,t.addEventListener("click",e.onClick),t.disabled=!e.enabled(),t.style.display=e.visible?"block":"none",t.title=e.tooltip,function(e,t){e.isOpen&&t.classList.add("toPhaseOpen"),e.isStart&&t.classList.add("toPhaseStart"),e.isReportable&&t.classList.add("toPhaseReportable"),e.isRemoved&&t.classList.add("toPhaseRemoved"),e.isSystemClosedPhase&&t.classList.add("toPhaseSystemClosedPhase"),e.isOptimumPath&&t.classList.add("toPhaseOptimumPath")}(e,t),e.enabled.subscribe((o=>{t.disabled=!o,function(e,t,o){let s="0 8px 8px -4px lightgray",n="0px 0px 17px 4px lightgray";e.color&&(s=`0 8px 8px -4px ${e.color}`,n=`0px 0px 17px 4px ${e.color}`),t?(o.style.boxShadow=s,o.onmouseover=function(){o.style.boxShadow=n},o.onmouseout=function(){o.style.boxShadow=s}):(o.style.boxShadow="",o.onmouseover=function(){o.style.boxShadow=""},o.onmouseout=function(){o.style.boxShadow=""})}(e,o,t)}));const s=document.createElement("span");s.classList.add("icon"),s.classList.add("fa"),s.classList.add(e.icon),s.classList.add("fa-xl"),t.appendChild(s),o.appendChild(t)})),o}(e.buttons);t.appendChild(n),o.appendChild(t)})),o}(this.buttonGroups,this.blade),this.saveSubmitCancelElement=this.element.querySelector(".save-submit-cancel"),this.saveSubmitCancelElement?this.saveSubmitCancelElement.appendChild(this.buttonGroupElement):this.log("Save Submit Cancel Element Not Found","red")}createSystemButtons(){let e=[],t={order:1,text:"Save",onClick:()=>{this.saveClicked()},id:"",icon:"fa-save",enabled:n.observable(!0),visible:!0,tooltip:"Save the current record",type:i.save,color:void 0,isOptimumPath:!1,isSystemClosedPhase:!1,isRemoved:!1,isOpen:!1,isStart:!1,isReportable:!1};e.push(t);let o={order:2,text:"Cancel",onClick:()=>{this.saveClicked()},id:"",icon:"fa-times",enabled:n.observable(!0),visible:!0,tooltip:"Cancel the current record",type:i.cancel,color:void 0,isOptimumPath:!1,isSystemClosedPhase:!1,isRemoved:!1,isOpen:!1,isStart:!1,isReportable:!1};return e.push(o),e}loadAndBind(){this.log("Load And Bind"),this.sharedoTypeSystemName?s(this.sharedoTypeSystemName).then((e=>{this.log("Phase Plan Loaded","red",e),this.phasePlan(e)})):this.log("No Sharedo Type Name")}load(e){this.log("Load")}reload(e){this.log("Reload")}saveClicked(){}save(){}runSaveWithNoValidation(){}areAllAspectsLoaded(){}saveCompleted(){}monitorHandlers(e){}addSubscription(e){}log(e,t,o){var s;(null===(s=this.model.debug)||void 0===s?void 0:s.enabled)&&this.model.debug.logToConsole&&console.log(`%c ${r} - ${e}`,t,o)}addDebugIfRequired(){var e,t;(null===(t=null===(e=this.model)||void 0===e?void 0:e.debug)||void 0===t?void 0:t.enabled)&&(window.aspectDebug=window.aspectDebug||{},window.aspectDebug[r]=this)}}})();var o=Aspects="undefined"==typeof Aspects?{}:Aspects;for(var s in t)o[s]=t[s];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUIsVUFBVUEsRUFBVSxJQUx6QmpCLEtBQUt4RCxJQUFJLHVCQVNqQixDQUVBMkksS0FBS3JFLEdBQ0RkLEtBQUt4RCxJQUFJLE9BQ2IsQ0FFQTRJLE9BQU90RSxHQUNIZCxLQUFLeEQsSUFBSSxTQUNiLENBR0FzSSxjQUVBLENBRUFDLE9BRUEsQ0FJQU0sMEJBRUEsQ0FFQUMsc0JBRUEsQ0FFQUMsZ0JBRUEsQ0FFQXRGLGdCQUFnQnVGLEdBRWhCLENBRUFDLGdCQUFnQkMsR0FFaEIsQ0FRQWxKLElBQUltSixFQUFpQnRILEVBQWdCN0QsRyxPQUNiLFFBQWhCLEVBQUF3RixLQUFLYyxNQUFNUCxhQUFLLGVBQUVoQyxVQUNkeUIsS0FBS2MsTUFBTVAsTUFBTUMsY0FDakJqRSxRQUFRQyxJQUFJLE1BQU1nRCxPQUEwQm1HLElBQVd0SCxFQUFPN0QsRUFHMUUsQ0FFUXNILHFCLFNBQ2lCLFFBQWpCLEVBQVUsUUFBVixFQUFBOUIsS0FBS2MsYUFBSyxlQUFFUCxhQUFLLGVBQUVoQyxXQUNsQjVELE9BQWVpTCxZQUFlakwsT0FBZWlMLGFBQWUsQ0FBQyxFQUM3RGpMLE9BQWVpTCxZQUFZcEcsR0FBd0JRLEtBRTVELEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Bc3BlY3RzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0FzcGVjdHMvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0FzcGVjdHMvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9Bc3BlY3RzL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vQXNwZWN0cy8uL1NhdmVTdWJtaXRDYW5jZWxBc3BlY3RBZ2VudC50cyIsIndlYnBhY2s6Ly9Bc3BlY3RzLy4uLy4uL0NvbW1vbi9hcGkvYXBpLnRzIiwid2VicGFjazovL0FzcGVjdHMvZXh0ZXJuYWwgdmFyIFwia29cIiIsIndlYnBhY2s6Ly9Bc3BlY3RzLy4vQnV0dG9uQnVpbGRlci50cyIsIndlYnBhY2s6Ly9Bc3BlY3RzLy4vVHJhbnNpdGlvblRvQnV0dG9uQ29udmVydGVyLnRzIiwid2VicGFjazovL0FzcGVjdHMvLi9TYXZlU3VibWl0Q2FuY2VsQXNwZWN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgSVBoYXNlUGxhbiB9IGZyb20gXCIuLi8uLi8uLi9UeXBpbmdzL2FwaS9QaGFzZVBsYW4vUGhhc2VQbGFuXCI7XG5pbXBvcnQgeyBleGVjdXRlR2V0LCBleGVjdXRlUG9zdCwgZXhlY3V0ZVB1dCB9IGZyb20gXCIuLi8uLi9Db21tb24vYXBpL2FwaVwiO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YSB7XG4gICAgaW5mb3JtYXRpb25CYXJyaWVyOiBib29sZWFuO1xuICAgIGxhc3RDaGVja0RhdGU6IERhdGU7XG59XG5cbi8qKlxuICogRXhhbXBsZSBvZiB1c2luZyBmaW5kQnlRdWVyeSBBUEkgdG8gbG9hZCB3b3JrIGl0ZW1cbiAqIGJ5IGl0J3MgSUQsIGFuZCBlbnJpY2ggd2l0aCBzcGVjaWZpYyBwYXJhbWV0ZXJzXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRQaGFzZVBsYW4gPSBhc3luYyBmdW5jdGlvbiAod29ya1R5cGVTeXN0ZW1OYW1lOiBzdHJpbmcpIDogUHJvbWlzZTxJUGhhc2VQbGFuIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIGV4ZWN1dGVHZXQ8YW55PihgL2FwaS9tb2RlbGxlci9zaGFyZWRvVHlwZXMvJHt3b3JrVHlwZVN5c3RlbU5hbWV9L3BoYXNlUGxhbmApIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICBcbiAgICAgICAgLy9sb2cgY29sb3JcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyBsb2FkV29ya0l0ZW1cIiwgXCJjb2xvcjogI2ZmMDAwMFwiKTtcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgZm91bmRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YSBhcyBJUGhhc2VQbGFuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IHNhdmVBc3BlY3QgPSBhc3luYyBmdW5jdGlvbiAoaWQ6IHN0cmluZywgZGF0YTphbnkpIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgICBleGVjdXRlUHV0PGFueT4oYC9hcGkvdjEvcHVibGljL3dvcmtJdGVtLyR7aWR9YCwgZGF0YSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInVwZGF0ZWRcIixkYXRhKTtcbiAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvcik7XG4gICAgfSk7XG59IiwiXG4vKipcbiAqIFRoaXMgZmlsZSBjb250YWlucyB0aGUgYXBpIGNhbGxzIHRvIHRoZSBiYWNrZW5kLlxuICogdXRpbGlzaW5nIHRoZSBheGlvcyBsaWJyYXJ5IHRvIG1ha2UgdGhlIGNhbGxzLlxuICogaW5jbHVzaW5nIG9mIHdlYnBhY2tJZ25vcmUgaXMgdG8gYWxsb3cgdGhlIHdlYnBhY2sgdG8gaWdub3JlIHRoZSBjYWxscyBhbmQgbm90IHRyeSB0byBidW5kbGUgdGhlbS5cbiAqL1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVBvc3Q8VD4oYXBpOiBzdHJpbmcsIHBvc3RCb2R5OiBhbnkpIDogUHJvbWlzZTxUPntcbiAgICAvL3JldHVybiBhd2FpdCAkYWpheC5wb3N0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSwgcG9zdEJvZHkpO1xuICAgIHJldHVybiBleGVjdXRlRmV0Y2g8VD4oYXBpLFwiUE9TVFwiLHBvc3RCb2R5KTtcbn1cblxuLy8gZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVHZXQ8VD4oYXBpOiBzdHJpbmcpIDogUHJvbWlzZTxUPntcbi8vICAgICByZXR1cm4gYXdhaXQgJGFqYXguZ2V0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSk7XG4vLyB9IFxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUdldDxUPihhcGk6IHN0cmluZykgOiBQcm9taXNlPFQ+e1xuICAgcmV0dXJuIGV4ZWN1dGVGZXRjaDxUPihhcGksXCJHRVRcIix1bmRlZmluZWQpO1xufVxuXG5cblxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlUHV0PFQ+KGFwaTogc3RyaW5nLCBwb3N0Qm9keTogYW55KSA6IFByb21pc2U8VD57XG4gICAgLy9yZXR1cm4gYXdhaXQgJGFqYXgucHV0KC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gdmFsaWRhdGVBcGkoYXBpKSwgcG9zdEJvZHkpO1xuICAgIHJldHVybiBleGVjdXRlRmV0Y2g8VD4oYXBpLFwiUFVUXCIscG9zdEJvZHkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZURlbGV0ZTxUPihhcGk6IHN0cmluZykgOiBQcm9taXNlPFQ+e1xuICAgIC8vcmV0dXJuIGF3YWl0ICRhamF4LmRlbGV0ZSgvKiB3ZWJwYWNrSWdub3JlOiB0cnVlICovIHZhbGlkYXRlQXBpKGFwaSkpO1xuICAgIHJldHVybiBleGVjdXRlRmV0Y2g8VD4oYXBpLFwiREVMRVRFXCIsdW5kZWZpbmVkKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVBcGkoYXBpOiBzdHJpbmcpIDogc3RyaW5ne1xuICAgbGV0IGxvY2F0aW9uPSAgd2luZG93LmRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbjtcblxuICAgLy9pZiBhcGkgZG9lcyBub3QgaW5jbHVkZSB0aGUgbG9jYXRpb24gdGhlbiBhZGQgaXQuXG4gICAgaWYoYXBpLmluZGV4T2YobG9jYXRpb24pID09PSAtMSl7XG4gICAgICAgIC8vY2hlY2sgaWYgYXBpIHN0YXJ0IHdpdGggYSAvIGlmIG5vdCBhZGQgaXQuXG4gICAgICAgIGlmKGFwaS5pbmRleE9mKFwiL1wiKSAhPT0gMCl7XG4gICAgICAgICAgICBhcGkgPSBcIi9cIiArIGFwaTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYXBpID0gbG9jYXRpb24gKyBhcGk7XG4gICAgfVxuICAgIHJldHVybiBhcGk7XG4gICAgXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlRmV0Y2g8VD4oYXBpOiBzdHJpbmcsIG1ldGhvZDpzdHJpbmcsZGF0YTphbnkpIDogUHJvbWlzZTxUPntcbiAgICBsZXQgdXJsID0gdmFsaWRhdGVBcGkoYXBpKTtcbiAgICBsZXQgZmV0Y2hIZWFkZXJzID0gYnVpbGRIZWFkZXJzKCk7XG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLHtcbiAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgIGhlYWRlcnM6IGZldGNoSGVhZGVycyxcbiAgICAgICAgYm9keTogZGF0YT8gSlNPTi5zdHJpbmdpZnkoZGF0YSk6IHVuZGVmaW5lZFxuICAgIH1cbiAgICApLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgIC8vY2hlY2sgaWYgcmVzcG9uc2UgaXMgSlNPTlxuICAgICAgICBpZihyZXNwb25zZS5oZWFkZXJzLmdldChcImNvbnRlbnQtdHlwZVwiKT8uaW5kZXhPZihcImFwcGxpY2F0aW9uL2pzb25cIikgPT09IC0xKXtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlc3BvbnNlIHdhcyBub3QgSlNPTlwiKTtcbiAgICAgICAgfVxuICAgICAgICAvL3JldHVybiB0aGUganNvbiBhcyBvYmplY3RcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkSGVhZGVycygpIHtcbiAgICBsZXQgYmVhcmVyID0gZ2V0QmVhcmVyVG9rZW4oKTtcbiAgICBsZXQgZmV0Y2hIZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICBmZXRjaEhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICBpZiAoYmVhcmVyKSB7XG4gICAgICAgIGZldGNoSGVhZGVycy5hcHBlbmQoXCJBdXRob3JpemF0aW9uXCIsIGJlYXJlcik7XG4gICAgfVxuICAgIHJldHVybiBmZXRjaEhlYWRlcnM7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvb2tpZXMoKTogeyBba2V5OnN0cmluZ106c3RyaW5nIH1cbntcbiAgICBsZXQgcmV0VmFsdWU6IHsgW2tleTpzdHJpbmddOnN0cmluZyB9ID0ge307XG4gICAgbGV0IGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoXCI7XCIpLnJlZHVjZShmdW5jdGlvbiAoY29va2llcywgY29va2llKVxuICAgIHtcbiAgICAgICAgdmFyIHBhcnRzID0gY29va2llLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGtleSA9IHBhcnRzWzBdLnRyaW0oKTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcnRzWzFdO1xuXG4gICAgICAgICAgICByZXRWYWx1ZVtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvb2tpZXM7XG4gICAgfSwge30pO1xuXG4gICAgcmV0dXJuIHJldFZhbHVlO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldEJlYXJlclRva2VuKClcbntcbiAgICB2YXIgY29va2llcyA9IGdldENvb2tpZXMoKTtcbiAgICB2YXIgdG9rZW4gPSBjb29raWVzW1wiX2FwaVwiXTtcblxuICAgIGlmKCB0b2tlbiApIHJldHVybiBcIkJlYXJlciBcIiArIHRva2VuO1xuICAgIHJldHVybiBudWxsO1xufTsiLCJjb25zdCBfX1dFQlBBQ0tfTkFNRVNQQUNFX09CSkVDVF9fID0ga287IiwiXG5pbXBvcnQgeyBUU2hhcmVEb0JsYWRlIH0gZnJvbSAnLi4vLi4vLi4vVHlwaW5ncy9TaGFyZURvSlMvQWRkRWRpdFNoYXJlZG8nO1xuaW1wb3J0IHsgQVNNYXRlcmlhbEJ1dHRvbiB9IGZyb20gJ2FsdGVyc3BlY3RpdmUtbWF0ZXJpYWwtZGVzaWduLXdlYi1jb21wb25lbnRzJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIElCdXR0b25Hcm91cCB7XG4gICAgbmFtZToga28uT2JzZXJ2YWJsZTxzdHJpbmc+O1xuICAgIHNob3dUaXRsZToga28uT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgICBlbmFibGVkOiBrby5PYnNlcnZhYmxlPGJvb2xlYW4+O1xuICAgIG9yZGVyOiBudW1iZXI7XG4gICAgYnV0dG9uczogSUJ1dHRvbltdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElCdXR0b24ge1xuICAgIGdyb3VwPzogSUJ1dHRvbkdyb3VwOyAvLyBncm91cCBidXR0b25zIHRvZ2V0aGVyXG4gICAgaWQ6IHN0cmluZztcbiAgICBvcmRlcjogbnVtYmVyOyAvLyBvcmRlciBvZiB0aGUgYnV0dG9uIGluIHRoZSBncm91cFxuICAgIHRleHQ6IHN0cmluZztcbiAgICBpY29uOiBzdHJpbmc7XG4gICAgZW5hYmxlZDoga28uT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgICB2aXNpYmxlOiBib29sZWFuO1xuICAgIG9uQ2xpY2s6IGFueTtcbiAgICB0b29sdGlwOiBzdHJpbmc7XG4gICAgdHlwZTogQnV0dG9uVHlwZTsgLy8gcHJpbWFyeSwgc2Vjb25kYXJ5LCBkZXN0cnVjdGl2ZSwgc2F2ZSBhZGRlZCB0byBjbGFzc1xuICAgIGNvbG9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7ICAvLyBjb2xvciBvZiB0aGUgYnV0dG9uIGZvciBlbXBoYXNpc1xuICAgIGlzT3B0aW11bVBhdGg6IGJvb2xlYW47IC8vIGlzIHRoaXMgYnV0dG9uIG9uIHRoZSBvcHRpbXVtIHBhdGggZm9yIGNzc1xuICAgIGlzU3lzdGVtQ2xvc2VkUGhhc2U6IGJvb2xlYW47IC8vIGlzIHRoaXMgYnV0dG9uIG9uIGEgY2xvc2VkIHBoYXNlIGZvciBjc3NcbiAgICBpc1JlbW92ZWQ6IGJvb2xlYW47IC8vIGlzIHRoaXMgYnV0dG9uIG9uIGEgcmVtb3ZlZCBwaGFzZSBmb3IgY3NzXG4gICAgaXNPcGVuOiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiBhbiBvcGVuIHBoYXNlIGZvciBjc3NcbiAgICBpc1N0YXJ0OiBib29sZWFuOyAvLyBpcyB0aGlzIGJ1dHRvbiBvbiBhIHN0YXJ0IHBoYXNlIGZvciBjc3NcbiAgICBpc1JlcG9ydGFibGU6IGJvb2xlYW47IC8vIGlzIHRoaXMgYnV0dG9uIG9uIGEgcmVwb3J0YWJsZSBwaGFzZSBmb3IgY3NzXG59XG5cbmV4cG9ydCBlbnVtIEJ1dHRvblR5cGUge1xuICAgIGRlc3RydXN0aXZlID0gXCJkZXN0cnVjdGl2ZVwiLFxuICAgIHByaW1hcnkgPSBcInByaW1hcnlcIixcbiAgICBzZWNvbmRhcnkgPSBcInNlY29uZGFyeVwiLFxuICAgIHNhdmUgPSBcInNhdmVcIixcbiAgICBjYW5jZWwgPSBcImNhbmNlbFwiXG59XG5cbmZ1bmN0aW9uIGVuc3VyZUJ1dHRvbklkcyhidXR0b25zOiBJQnV0dG9uW10pIHtcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgaWYgKCFidXR0b24uaWQpIHtcbiAgICAgICAgICAgIGJ1dHRvbi5pZCA9IFwiYnV0dG9uX1wiICsgYnV0dG9uLm9yZGVyO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vKipcbiAqIENyZWF0ZXMgdGhlIGJ1dHRvbiBncm91cCBlbGVtZW50cyBcbiAqIEBwYXJhbSBidXR0b25Hcm91cHMgXG4gKiBAcGFyYW0gYmxhZGUgXG4gKiBAcmV0dXJucyBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQnV0dG9uR3JvdXBFbGVtZW50KGJ1dHRvbkdyb3VwczogSUJ1dHRvbkdyb3VwW10sIGJsYWRlOiBUU2hhcmVEb0JsYWRlKTogSFRNTEVsZW1lbnQge1xuICAgIGxldCBidXR0b25Hcm91cEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgYnV0dG9uR3JvdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJidXR0b24tZ3JvdXBzXCIpO1xuICAgIC8vc29ydCBncm91cHMgYnkgb3JkZXJcbiAgICBsZXQgc29ydGVkQnV0dG9uR3JvdXBzID0gYnV0dG9uR3JvdXBzLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcbiAgICBzb3J0ZWRCdXR0b25Hcm91cHMuZm9yRWFjaChncm91cCA9PiB7XG4gICAgICAgIGNvbnN0IGdyb3VwRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGxldCBjc3NHcm91cE5hbWUgPSBncm91cC5uYW1lKCkucmVwbGFjZSgvW15hLXpBLVowLTldL2csIFwiXCIpO1xuICAgICAgICBcbiAgICAgICAgZ3JvdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJidXR0b24tZ3JvdXBcIik7XG4gICAgICAgIGdyb3VwRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNzc0dyb3VwTmFtZSk7XG4gICAgICAgIGdyb3VwLmVuYWJsZWQuc3Vic2NyaWJlKChlbmFibGVkKSA9PiB7XG4gICAgICAgICAgICBncm91cEVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcImRpc2FibGVkXCIsICFlbmFibGVkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBidXR0b25zID0gYnVpbGRCdXR0b25zRWxlbWVudChncm91cC5idXR0b25zLCBibGFkZSk7XG4gICAgICAgIGdyb3VwRWxlbWVudC5hcHBlbmRDaGlsZChidXR0b25zKTtcbiAgICAgICAgYnV0dG9uR3JvdXBFbGVtZW50LmFwcGVuZENoaWxkKGdyb3VwRWxlbWVudCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYnV0dG9uR3JvdXBFbGVtZW50O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRCdXR0b25zRWxlbWVudChidXR0b25zOiBJQnV0dG9uW10sIGJsYWRlOiBUU2hhcmVEb0JsYWRlKTogSFRNTEVsZW1lbnQge1xuICAgIFxuICAgIGNvbnN0IGJ1dHRvbnNFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBidXR0b25zRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYnV0dG9uc1wiKTtcbiAgICBpZiAoIWJ1dHRvbnMgfHwgYnV0dG9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbGV0IG5vQnV0dG9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIG5vQnV0dG9ucy5pbm5lclRleHQgPSBcIk5vIFRyYW5zaXRpb25zIEF2YWlsYWJsZVwiO1xuICAgICAgICBidXR0b25zRWxlbWVudC5hcHBlbmRDaGlsZChub0J1dHRvbnMpO1xuICAgICAgICByZXR1cm4gYnV0dG9uc0VsZW1lbnQ7XG4gICAgfVxuXG4gICAgZW5zdXJlQnV0dG9uSWRzKGJ1dHRvbnMpO1xuXG4gICAgbGV0IHNvcnRlZEJ1dHRvbnMgPSBidXR0b25zLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcblxuICAgIHNvcnRlZEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgICBjb25zdCBuZXdCdXR0b25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYnRuXCIpO1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoYnV0dG9uLnR5cGUpO1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmlkID0gYnV0dG9uLmlkIHx8IFwiYnV0dG9uX1wiICsgYnV0dG9uLm9yZGVyO1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmlubmVyVGV4dCA9IGJ1dHRvbi50ZXh0O1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBidXR0b24ub25DbGljayk7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSAhYnV0dG9uLmVuYWJsZWQoKTtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gYnV0dG9uLnZpc2libGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC50aXRsZSA9IGJ1dHRvbi50b29sdGlwO1xuXG4gICAgICAgIGFwcGx5QnV0dG9uSXNDbGFzc2VzKGJ1dHRvbiwgbmV3QnV0dG9uRWxlbWVudCk7XG5cbiAgICAgICAgYnV0dG9uLmVuYWJsZWQuc3Vic2NyaWJlKChlbmFibGVkKSA9PiB7XG4gICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50LmRpc2FibGVkID0gIWVuYWJsZWQ7XG4gICAgICAgICAgICBhcHBseUJ1dHRvbkVtcGhhc2lzKGJ1dHRvbiwgZW5hYmxlZCwgbmV3QnV0dG9uRWxlbWVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKFwiaWNvblwiKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKFwiZmFcIik7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZChidXR0b24uaWNvbik7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZChcImZhLXhsXCIpO1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmFwcGVuZENoaWxkKGljb24pO1xuICAgICAgICBidXR0b25zRWxlbWVudC5hcHBlbmRDaGlsZChuZXdCdXR0b25FbGVtZW50KTtcbiAgICB9KVxuICAgIHJldHVybiBidXR0b25zRWxlbWVudDtcblxuICAgIGZ1bmN0aW9uIGFwcGx5QnV0dG9uRW1waGFzaXMoYnV0dG9uOiBJQnV0dG9uLCBpc1ZhbGlkOiBhbnksIG5ld0J1dHRvbkVsZW1lbnQ6IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgICAgIGxldCBib3hTaGFkb3cgPSBgMCA4cHggOHB4IC00cHggbGlnaHRncmF5YDtcbiAgICAgICAgbGV0IGJveFNoYWRvd0hvdmVyID0gYDBweCAwcHggMTdweCA0cHggbGlnaHRncmF5YDtcbiAgICAgICAgaWYgKGJ1dHRvbi5jb2xvcikge1xuICAgICAgICAgICAgYm94U2hhZG93ID0gYDAgOHB4IDhweCAtNHB4ICR7YnV0dG9uLmNvbG9yfWA7XG4gICAgICAgICAgICBib3hTaGFkb3dIb3ZlciA9IGAwcHggMHB4IDE3cHggNHB4ICR7YnV0dG9uLmNvbG9yfWA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSBib3hTaGFkb3c7XG4gICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50Lm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuYm94U2hhZG93ID0gYm94U2hhZG93SG92ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50Lm9ubW91c2VvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5ib3hTaGFkb3cgPSBib3hTaGFkb3c7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9IGBgO1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5vbm1vdXNlb3ZlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBuZXdCdXR0b25FbGVtZW50LnN0eWxlLmJveFNoYWRvdyA9IGBgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5vbm1vdXNlb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuc3R5bGUuYm94U2hhZG93ID0gYGA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFwcGx5QnV0dG9uSXNDbGFzc2VzKGJ1dHRvbjogSUJ1dHRvbiwgbmV3QnV0dG9uRWxlbWVudDogSFRNTEJ1dHRvbkVsZW1lbnQpIHtcbiAgICBpZiAoYnV0dG9uLmlzT3Blbikge1xuICAgICAgICBuZXdCdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0b1BoYXNlT3BlblwiKTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbi5pc1N0YXJ0KSB7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRvUGhhc2VTdGFydFwiKTtcbiAgICB9XG4gICAgaWYgKGJ1dHRvbi5pc1JlcG9ydGFibGUpIHtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidG9QaGFzZVJlcG9ydGFibGVcIik7XG4gICAgfVxuICAgIGlmIChidXR0b24uaXNSZW1vdmVkKSB7XG4gICAgICAgIG5ld0J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRvUGhhc2VSZW1vdmVkXCIpO1xuICAgIH1cbiAgICBpZiAoYnV0dG9uLmlzU3lzdGVtQ2xvc2VkUGhhc2UpIHtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidG9QaGFzZVN5c3RlbUNsb3NlZFBoYXNlXCIpO1xuICAgIH1cbiAgICBpZiAoYnV0dG9uLmlzT3B0aW11bVBhdGgpIHtcbiAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidG9QaGFzZU9wdGltdW1QYXRoXCIpO1xuICAgIH1cblxufVxuXG5mdW5jdGlvbiBydW5UaHJvdWdoQ29sb3JzKGZvckNvbG9yOiBhbnksIG5ld0J1dHRvbkVsZW1lbnQ6IEhUTUxCdXR0b25FbGVtZW50KSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JDb2xvci5sZW5ndGg7IGkrKykge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGxldCByZ2IgPSBcInJnYihcIiArIGZvckNvbG9yW2ldLnIgKyBcIixcIiArIGZvckNvbG9yW2ldLmcgKyBcIixcIiArIGZvckNvbG9yW2ldLmIgKyBcIilcIjtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke2l9IDpgLCByZ2IpO1xuICAgICAgICAgICAgbmV3QnV0dG9uRWxlbWVudC5zdHlsZS5jb2xvciA9IHJnYjtcbiAgICAgICAgfSwgKGkgKyAxKSAqIDIwMDApO1xuICAgIH1cbn1cbiIsImltcG9ydCAqIGFzIGtvIGZyb20gXCJrbm9ja291dFwiO1xuaW1wb3J0IHsgUGhhc2UsIFRyYW5zaXRpb24gfSBmcm9tIFwiLi4vLi4vLi4vVHlwaW5ncy9hcGkvUGhhc2VQbGFuL1BoYXNlUGxhblwiO1xuaW1wb3J0IHsgQnV0dG9uVHlwZSwgSUJ1dHRvbiB9IGZyb20gXCIuL0J1dHRvbkJ1aWxkZXJcIjtcblxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydFRyYW5zaXRpb25Ub0J1dHRvbiAodHJhbnNpdGlvbnNGb3JCdXR0b25zOiBUcmFuc2l0aW9uW10sIHBoYXNlUGxhbnM6UGhhc2VbXSwgb3B0aW9uczogYW55KSA6IElCdXR0b25bXSB7XG5cbiAgICBsZXQgYnV0dG9uczogSUJ1dHRvbltdID0gW107XG4gICAgbGV0IGkgPSAwO1xuICAgIHRyYW5zaXRpb25zRm9yQnV0dG9ucy5mb3JFYWNoKCh0cmFuc2l0aW9uKSA9PiB7XG4gICAgXG4gICAgICAgIGxldCB0b1BoYXNlID0gcGhhc2VQbGFucy5maW5kKChwaGFzZSkgPT4gcGhhc2Uuc3lzdGVtTmFtZSA9PT0gdHJhbnNpdGlvbi50b1BoYXNlU3lzdGVtTmFtZSk7XG5cbiAgICAgICAgaWYoIXRvUGhhc2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGkrKztcbiAgICAgICAgbGV0IGJ1dHRvbjogSUJ1dHRvbiA9IHtcbiAgICAgICAgICAgIGlkOiB0cmFuc2l0aW9uLnN5c3RlbU5hbWUsXG4gICAgICAgICAgICBvcmRlcjogaSxcbiAgICAgICAgICAgIHRleHQ6IHRyYW5zaXRpb24ubmFtZSxcbiAgICAgICAgICAgIGljb246IHRvUGhhc2UuaWNvbkNsYXNzIHx8IFwiXCIsXG4gICAgICAgICAgICBjb2xvcjogdG9QaGFzZS5jb2xvdXIgfHwgXCJcIixcbiAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSksXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgb25DbGljazogb3B0aW9ucy5vbkNsaWNrLFxuICAgICAgICAgICAgdG9vbHRpcDogdG9QaGFzZS5kZXNjcmlwdGlvbiB8fCBgUHJvZ3Jlc3MgdG8gJHt0b1BoYXNlLm5hbWV9IHBoYXNlYCxcbiAgICAgICAgICAgIHR5cGU6IGdldEJ1dHRvblR5cGUodHJhbnNpdGlvbiwgdG9QaGFzZSksXG4gICAgICAgICAgICBpc09wdGltdW1QYXRoOiB0cmFuc2l0aW9uLmlzT3B0aW11bVBhdGgsXG4gICAgICAgICAgICBpc1N5c3RlbUNsb3NlZFBoYXNlOiB0b1BoYXNlLmlzU3lzdGVtQ2xvc2VkUGhhc2UsXG4gICAgICAgICAgICBpc1JlbW92ZWQ6IHRvUGhhc2UuaXNSZW1vdmVkLFxuICAgICAgICAgICAgaXNPcGVuOiB0b1BoYXNlLmlzT3BlbixcbiAgICAgICAgICAgIGlzU3RhcnQ6IHRvUGhhc2UuaXNTdGFydCxcbiAgICAgICAgICAgIGlzUmVwb3J0YWJsZTogdG9QaGFzZS5pc1JlcG9ydGFibGVcbiAgICAgICAgfVxuICAgICAgICBidXR0b25zLnB1c2goYnV0dG9uKTtcbiAgICB9KTtcblxuXG4gICAgY29uc29sZS5sb2coYnV0dG9ucyk7XG5cbiAgICByZXR1cm4gYnV0dG9ucztcblxuXG59XG5cbmZ1bmN0aW9uIGdldEJ1dHRvblR5cGUodHJhbnNpdGlvbjogVHJhbnNpdGlvbiwgdG9QaGFzZTogUGhhc2UpOkJ1dHRvblR5cGUge1xuICAgIFxuICAgIGxldCByZXRWYWx1ZSA9IEJ1dHRvblR5cGUucHJpbWFyeTtcblxuICAgIGlmKHRyYW5zaXRpb24uaXNPcHRpbXVtUGF0aCA9PT0gZmFsc2UpXG4gICAge1xuICAgICAgICByZXRWYWx1ZSA9IEJ1dHRvblR5cGUuc2Vjb25kYXJ5O1xuICAgIH1cblxuICAgIGlmKHRvUGhhc2UuaXNSZW1vdmVkID09PSB0cnVlKVxuICAgIHtcbiAgICAgICAgcmV0VmFsdWUgPSBCdXR0b25UeXBlLmRlc3RydXN0aXZlO1xuICAgIH1cblxuICAgIGlmKHRvUGhhc2UuaXNTeXN0ZW1DbG9zZWRQaGFzZSA9PT0gdHJ1ZSlcbiAgICB7XG4gICAgICAgIHJldFZhbHVlID0gQnV0dG9uVHlwZS5wcmltYXJ5O1xuICAgIH1cblxuXG5cbiAgICByZXR1cm4gcmV0VmFsdWU7XG59XG4iLCJcclxuaW1wb3J0IHsgSVBoYXNlUGxhbiwgVHJhbnNpdGlvbiB9IGZyb20gXCIuLi8uLi8uLi9UeXBpbmdzL2FwaS9QaGFzZVBsYW4vUGhhc2VQbGFuXCI7XHJcbmltcG9ydCB7IGdldFBoYXNlUGxhbiB9IGZyb20gXCIuL1NhdmVTdWJtaXRDYW5jZWxBc3BlY3RBZ2VudFwiO1xyXG5pbXBvcnQgKiBhcyBrbyBmcm9tIFwia25vY2tvdXRcIjtcclxuaW1wb3J0IHsgY29udmVydFRyYW5zaXRpb25Ub0J1dHRvbiB9IGZyb20gXCIuL1RyYW5zaXRpb25Ub0J1dHRvbkNvbnZlcnRlclwiO1xyXG5pbXBvcnQgeyBCdXR0b25UeXBlLCBJQnV0dG9uLCBJQnV0dG9uR3JvdXAsIGJ1aWxkQnV0dG9uR3JvdXBFbGVtZW50IH0gZnJvbSBcIi4vQnV0dG9uQnVpbGRlclwiO1xyXG5sZXQgdGhpc1dpZGdldFN5c3RlbU5hbWUgPSBcIlNhdmVTdWJtaXRDYW5jZWxBc3BlY3RcIjtcclxuXHJcblxyXG4vL2FkZCBzdHlsZSB0byBoZWFkOiBodHRwczovL3VucGtnLmNvbS9tYXRlcmlhbC1jb21wb25lbnRzLXdlYkBsYXRlc3QvZGlzdC9tYXRlcmlhbC1jb21wb25lbnRzLXdlYi5taW4uY3NzXHJcbmRvY3VtZW50LmhlYWQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIGA8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgaHJlZj1cImh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vaWNvbj9mYW1pbHk9TWF0ZXJpYWwrSWNvbnNcIj5gKTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmlndXJhdGlvbiB7XHJcbiAgICBfaG9zdDogSG9zdDtcclxuICAgIGV2ZW50VG9GaXJlU2F2ZU9uOiBhbnk7XHJcbiAgICBzaW5nbGVFdmVudD86IGJvb2xlYW47XHJcbiAgICBydW5TYXZlQWZ0ZXJNaWxsaXNlY29uZHM/OiBudW1iZXI7XHJcbiAgICBkZWJ1Zz86IERlYnVnIHwgbnVsbDtcclxufVxyXG5cclxuaW50ZXJmYWNlIERlZmF1bHRzIHtcclxuICAgIGRlYnVnOiBEZWJ1ZyB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEhvc3Qge1xyXG4gICAgbW9kZWw6IEhvc3RNb2RlbCB8IG51bGw7XHJcbiAgICBibGFkZTogYW55IHwgbnVsbDtcclxuICAgIGVuYWJsZWQ6IGJvb2xlYW4gfCBudWxsO1xyXG4gICAgdG9vbGJhckNvbnRleHQ/OiBhbnkgfCBudWxsO1xyXG4gICAgYnVyZ2VyQ29udGV4dD86IGFueSB8IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSG9zdE1vZGVsIHtcclxuICAgIHRpdGxlOiBzdHJpbmc7XHJcbiAgICBpbnN0YW5jZUlkOiBzdHJpbmc7XHJcbiAgICBwYXJlbnRTaGFyZWRvSWQ6IHN0cmluZztcclxuICAgIGlkOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGVidWcge1xyXG4gICAgZW5hYmxlZD86IGJvb2xlYW4gfCBudWxsO1xyXG4gICAgbG9nVG9Db25zb2xlPzogYm9vbGVhbiB8IG51bGw7XHJcbiAgICBzaG93RXZlbnRzPzogYm9vbGVhbiB8IG51bGw7XHJcbiAgICBzaG93SW5Bc3BlY3Q/OiBib29sZWFuIHwgbnVsbDtcclxufVxyXG5cclxudHlwZSBPcHRpb25zID0gQ29uZmlndXJhdGlvbiB8IERlZmF1bHRzIHwge1xyXG4gICAgdGl0bGU6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICBzYXZlUnVuczogbnVtYmVyO1xyXG4gICAgZXZlbnRUb0ZpcmVTYXZlT246IGFueTtcclxuICAgIGRlYnVnOiBEZWJ1Z1xyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIFNhdmVTdWJtaXRDYW5jZWwge1xyXG5cclxuICAgIHByaXZhdGUgZmlyZWRFdmVudHM6IGFueVtdO1xyXG4gICAgcHJpdmF0ZSBtb25pdG9yZWRIYW5kbGVyczogYW55W107XHJcbiAgICBwcml2YXRlIHJlYWR5Rm9yU2F2ZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgb3B0aW9ucz86IENvbmZpZ3VyYXRpb247XHJcbiAgICBwcml2YXRlIGRpc3Bvc2FibGVzPzogYW55W107XHJcbiAgICBwcml2YXRlIGVuYWJsZWQ/OiBib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBpbnN0YW5jZUlkPzogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBlbGVtZW50PzogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIGJsYWRlOiBhbnk7XHJcbiAgICBwcml2YXRlIHBhcmVudFNoYXJlZG9JZD86IHN0cmluZztcclxuICAgIHByaXZhdGUgdG9vbGJhckNvbnRleHQ6IGFueTtcclxuICAgIHByaXZhdGUgYnVyZ2VyQ29udGV4dDogYW55O1xyXG4gICAgcHJpdmF0ZSBzaGFyZWRvSWQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7XHJcbiAgICBwcml2YXRlIHNoYXJlZG9UeXBlU3lzdGVtTmFtZTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZDtcclxuICAgIHByaXZhdGUgcmVsb2FkaW5nPzogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgbW9kZWw6IE9wdGlvbnM7XHJcbiAgICBwcml2YXRlIGlzVmFsaWRUZW1wOiBhbnk7XHJcbiAgICBwcml2YXRlIHBoYXNlUGxhbjogIGtvLk9ic2VydmFibGU8SVBoYXNlUGxhbiB8IHVuZGVmaW5lZD47XHJcbiAgICBob3N0TW9kZWw6IEhvc3RNb2RlbCB8IG51bGw7XHJcbiAgICBjdXJyZW50UGhhc2VTeXN0ZW1OYW1lOiBrby5PYnNlcnZhYmxlPHN0cmluZyB8IHVuZGVmaW5lZD4gfCAgdW5kZWZpbmVkO1xyXG4gICAgYnV0dG9uR3JvdXBFbGVtZW50OiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZDtcclxuICAgIGJ1dHRvbkdyb3VwczogSUJ1dHRvbkdyb3VwW10gfCB1bmRlZmluZWQ7XHJcbiAgICBzYXZlU3VibWl0Q2FuY2VsRWxlbWVudDogYW55O1xyXG4gICAgXHJcblxyXG4gICAgY29uc3RydWN0b3IoZWxlbWVudDogSFRNTEVsZW1lbnQsIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRpb24sIGJhc2VNb2RlbDogYW55KSB7XHJcbiAgICAgICAgdGhpcy5tb25pdG9ySGFuZGxlcnMoKTtcclxuICAgICAgICB0aGlzLmZpcmVkRXZlbnRzID0gW107XHJcbiAgICAgICAgdGhpcy5tb25pdG9yZWRIYW5kbGVycyA9IFtdO1xyXG4gICAgICAgIHRoaXMucmVhZHlGb3JTYXZlID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IGRlZmF1bHRzOiBEZWZhdWx0cyA9XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBBc3BlY3Qgd2lkZ2V0IGNvbmZpZyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgICAgIGRlYnVnOiB7XHJcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGxvZ1RvQ29uc29sZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93RXZlbnRzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNob3dJbkFzcGVjdDogZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgb3B0aW9uczogT3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgY29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgdGhpcy5ibGFkZSA9IGNvbmZpZ3VyYXRpb24uX2hvc3QuYmxhZGU7XHJcbiAgICAgICAgdGhpcy5ob3N0TW9kZWwgPSBjb25maWd1cmF0aW9uLl9ob3N0Lm1vZGVsO1xyXG4gICAgICAgIHRoaXMubW9kZWwgPVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gVGhpcyBpcyByZWZlcmVuY2luZyBhIHN0YW5kYXJkIG9ic2VydmFibGUgaXRlbSBmcm9tIHRoZSBtYWluIG1vZGVsXHJcbiAgICAgICAgICAgIHRpdGxlOiBjb25maWd1cmF0aW9uLl9ob3N0Py5tb2RlbD8udGl0bGUsXHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNvbmZpZ3VyZWQgbWVzc2FnZSBhZ2FpbnN0IHRoZSBhc3BlY3QgaW5zdGFuY2VcclxuICAgICAgICAgICAgc2F2ZVJ1bnM6IDAsXHJcbiAgICAgICAgICAgIGRlYnVnOiBvcHRpb25zLmRlYnVnLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5waGFzZVBsYW4gPSBrby5vYnNlcnZhYmxlPElQaGFzZVBsYW4gfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XHJcbiAgICAgICAgdGhpcy5waGFzZVBsYW4uc3Vic2NyaWJlKHRoaXMuaGFuZGxlUGhhc2VQbGFuQ2hhbmdlLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMubG9nKFwiSW5pdFwiLCAnYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNiYWRhNTUnKTtcclxuXHJcbiAgICAgICAgLy8gaWYgKHRoaXMubW9kZWwuZXZlbnRUb0ZpcmVTYXZlT24pIHtcclxuICAgICAgICAvLyAgICAgdGhpcy5kaXNwb3NhYmxlcyA9IFtcclxuICAgICAgICAvLyAgICAgICAgICR1aS5ldmVudHMuc3Vic2NyaWJlKHRoaXMubW9kZWwuZXZlbnRUb0ZpcmVTYXZlT24sIHRoaXMuc2F2ZSwgdGhpcylcclxuICAgICAgICAvLyAgICAgXTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIC8vIEV2ZXJ5IHdpZGdldCBnZXRzIHRoaXNcclxuICAgICAgICB0aGlzLmVuYWJsZWQgPSBjb25maWd1cmF0aW9uLl9ob3N0LmJsYWRlLmVuYWJsZWQ7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZUlkID0gdGhpcy5ob3N0TW9kZWw/Lmluc3RhbmNlSWQ7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLmJsYWRlID0gY29uZmlndXJhdGlvbi5faG9zdC5ibGFkZVxyXG4gICAgICAgIHRoaXMucGFyZW50U2hhcmVkb0lkID0gdGhpcy5ob3N0TW9kZWw/LnBhcmVudFNoYXJlZG9JZDtcclxuICAgICAgICB0aGlzLnRvb2xiYXJDb250ZXh0ID0gY29uZmlndXJhdGlvbi5faG9zdC50b29sYmFyQ29udGV4dDtcclxuICAgICAgICB0aGlzLmJ1cmdlckNvbnRleHQgPSBjb25maWd1cmF0aW9uLl9ob3N0LmJ1cmdlckNvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5zaGFyZWRvSWQgPSB0aGlzLmhvc3RNb2RlbD8uaWQ7XHJcbiAgICAgICAgdGhpcy5yZWxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNoYXJlZG9UeXBlU3lzdGVtTmFtZSA9IHRoaXMuYmxhZGUubW9kZWwuc2hhcmVkb1R5cGVTeXN0ZW1OYW1lKClcclxuICAgICAgICB0aGlzLmN1cnJlbnRQaGFzZVN5c3RlbU5hbWUgPSB0aGlzLmJsYWRlLm1vZGVsLnBoYXNlU3lzdGVtTmFtZSgpXHJcblxyXG4gICBcclxuXHJcbiAgICAgICAgdGhpcy5hZGREZWJ1Z0lmUmVxdWlyZWQoKTtcclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVQaGFzZVBsYW5DaGFuZ2UocGhhc2VQbGFuOiBJUGhhc2VQbGFuIHwgdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJQaGFzZSBQbGFuIENoYW5nZWRcIiwgXCJyZWRcIiwgcGhhc2VQbGFuKTtcclxuXHJcbiAgICAgICAgaWYoIXBoYXNlUGxhbikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGdldCBhbGwgdGhlIHRyYW5zaXRpb25zIGZvciB0aGUgY3VycmVudCBwaGFzZVxyXG4gICAgICAgIGxldCB0cmFuc2l0aW9ucyA6IFRyYW5zaXRpb25bXTtcclxuXHJcbiAgICAgICAgaWYodGhpcy5jdXJyZW50UGhhc2VTeXN0ZW1OYW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy5jdXJyZW50UGhhc2VTeXN0ZW1OYW1lKCkgIT09IHVuZGVmaW5lZClcclxuICAgICAgICB7ICAgICAgICBcclxuICAgICAgICAgICAgIHRyYW5zaXRpb25zID0gcGhhc2VQbGFuLnRyYW5zaXRpb25zLmZpbHRlcih0ID0+IHQuZnJvbVBoYXNlU3lzdGVtTmFtZSA9PSB0aGlzLmN1cnJlbnRQaGFzZVN5c3RlbU5hbWUhKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsZXQgc3RhcnRQaGFzZSA9IHBoYXNlUGxhbi5waGFzZXMuZmluZChwID0+IHAuaXNTdGFydCA9PSB0cnVlKTtcclxuICAgICAgICAgICAgaWYoIXN0YXJ0UGhhc2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nKFwiTm8gU3RhcnQgUGhhc2VcIixcInJlZFwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0cmFuc2l0aW9ucyA9IHBoYXNlUGxhbi50cmFuc2l0aW9ucy5maWx0ZXIodCA9PiB0LmZyb21QaGFzZVN5c3RlbU5hbWUgPT0gc3RhcnRQaGFzZT8uc3lzdGVtTmFtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgb25DbGljayA6ICh0cmFuc2l0aW9uOiBUcmFuc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZyhcIlRyYW5zaXRpb24gQ2xpY2tlZFwiLCBcInJlZFwiLCB0cmFuc2l0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vUmVtb3ZlIGV4aXN0aW5nIGJ1dHRvbnNcclxuICAgICAgICBpZih0aGlzLmJ1dHRvbkdyb3VwRWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uR3JvdXBFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuIFxyXG4gICAgICAgIHRoaXMubG9nKFwiVHJhbnNpdGlvbnMgdG8gY29udmVydFwiLCBcImdyZWVuXCIsIHRyYW5zaXRpb25zLmxlbmd0aCk7XHJcblxyXG4gICAgICAgIC8vQ3JlYXRlIFNhdmUgYW5kIENhbmNlbCBCdXR0b25zXHJcbiAgICAgICAgbGV0IHN5c3RlbVRyYW5zaXRpb25Hcm91cCA6IElCdXR0b25Hcm91cCA9IHtcclxuICAgICAgICAgICAgb3JkZXI6IDAsXHJcbiAgICAgICAgICAgIGVuYWJsZWQ6IGtvLm9ic2VydmFibGUodHJ1ZSksXHJcbiAgICAgICAgICAgIHNob3dUaXRsZToga28ub2JzZXJ2YWJsZSh0cnVlKSxcclxuICAgICAgICAgICAgbmFtZToga28ub2JzZXJ2YWJsZShcIlN5c3RlbVwiKSxcclxuICAgICAgICAgICAgYnV0dG9uczogdGhpcy5jcmVhdGVTeXN0ZW1CdXR0b25zKClcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL0NyZWF0ZSBQaGFzZSBQbGFuIEJ1dHRvbnNcclxuICAgICAgICBsZXQgYnV0dG9uVHJhbnNpdGlvbkdyb3VwIDogSUJ1dHRvbkdyb3VwID0ge1xyXG4gICAgICAgICAgICBvcmRlcjogMSxcclxuICAgICAgICAgICAgZW5hYmxlZDogdGhpcy5ibGFkZS5pc1ZhbGlkLFxyXG4gICAgICAgICAgICBzaG93VGl0bGU6IGtvLm9ic2VydmFibGUodHJ1ZSksXHJcbiAgICAgICAgICAgIG5hbWU6IGtvLm9ic2VydmFibGUoXCJQaGFzZSBQbGFuXCIpLFxyXG4gICAgICAgICAgICBidXR0b25zOiBjb252ZXJ0VHJhbnNpdGlvblRvQnV0dG9uKHRyYW5zaXRpb25zLHBoYXNlUGxhbi5waGFzZXMsb3B0aW9ucylcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vQ3JlYXRlIEJ1dHRvbiBHcm91cHMgYW5kIGFkZCBTeXN0ZW0gYW5kIFBoYXNlIFBsYW4gQnV0dG9ucyBcclxuICAgICAgICB0aGlzLmJ1dHRvbkdyb3VwcyA9IFtidXR0b25UcmFuc2l0aW9uR3JvdXAsc3lzdGVtVHJhbnNpdGlvbkdyb3VwXTtcclxuICAgICAgICAvL0dlbmVyYXRlIEJ1dHRvbnMgR3JvdXAgRWxlbWVudHNcclxuICAgICAgICB0aGlzLmJ1dHRvbkdyb3VwRWxlbWVudCA9IGJ1aWxkQnV0dG9uR3JvdXBFbGVtZW50KHRoaXMuYnV0dG9uR3JvdXBzLCB0aGlzLmJsYWRlKTtcclxuICAgICAgICAvL0FkZCBCdXR0b25zIHRvIHRoZSBBc3BlY3RcclxuXHJcbiAgICAgICAgLy9maW5kIHNhdmUtc3VibWl0LWNhbmNlbCBjbGFzcyBpbiB0aGlzLmVsZW1lbnRcclxuICAgICAgICB0aGlzLnNhdmVTdWJtaXRDYW5jZWxFbGVtZW50ID0gdGhpcy5lbGVtZW50IS5xdWVyeVNlbGVjdG9yKFwiLnNhdmUtc3VibWl0LWNhbmNlbFwiKTtcclxuICAgIFxyXG4gICAgICAgIGlmKCF0aGlzLnNhdmVTdWJtaXRDYW5jZWxFbGVtZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5sb2coXCJTYXZlIFN1Ym1pdCBDYW5jZWwgRWxlbWVudCBOb3QgRm91bmRcIiwgXCJyZWRcIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zYXZlU3VibWl0Q2FuY2VsRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmJ1dHRvbkdyb3VwRWxlbWVudCk7XHJcbiAgICAgICAgXHJcbiBcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlU3lzdGVtQnV0dG9ucygpIHtcclxuICAgICAgICBsZXQgcmV0VmFsdWU6IElCdXR0b25bXSA9IFtdO1xyXG4gICAgICAgIGxldCBzYXZlQnV0dG9uOiBJQnV0dG9uID0ge1xyXG4gICAgICAgICAgICBvcmRlcjogMSxcclxuICAgICAgICAgICAgdGV4dDogXCJTYXZlXCIsXHJcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUNsaWNrZWQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaWQ6IFwiXCIsXHJcbiAgICAgICAgICAgIGljb246IFwiZmEtc2F2ZVwiLFxyXG4gICAgICAgICAgICBlbmFibGVkOiBrby5vYnNlcnZhYmxlKHRydWUpLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICB0b29sdGlwOiBcIlNhdmUgdGhlIGN1cnJlbnQgcmVjb3JkXCIsXHJcbiAgICAgICAgICAgIHR5cGU6IEJ1dHRvblR5cGUuc2F2ZSxcclxuICAgICAgICAgICAgY29sb3I6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgaXNPcHRpbXVtUGF0aDogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzU3lzdGVtQ2xvc2VkUGhhc2U6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1JlbW92ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc09wZW46IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1N0YXJ0OiBmYWxzZSxcclxuICAgICAgICAgICAgaXNSZXBvcnRhYmxlOiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0VmFsdWUucHVzaChzYXZlQnV0dG9uKTtcclxuXHJcbiAgICAgICAgbGV0IGNhbmNlbEJ1dHRvbjogSUJ1dHRvbiA9IHtcclxuICAgICAgICAgICAgb3JkZXI6IDIsXHJcbiAgICAgICAgICAgIHRleHQ6IFwiQ2FuY2VsXCIsXHJcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZUNsaWNrZWQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaWQ6IFwiXCIsXHJcbiAgICAgICAgICAgIGljb246IFwiZmEtdGltZXNcIixcclxuICAgICAgICAgICAgZW5hYmxlZDoga28ub2JzZXJ2YWJsZSh0cnVlKSxcclxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgdG9vbHRpcDogXCJDYW5jZWwgdGhlIGN1cnJlbnQgcmVjb3JkXCIsXHJcbiAgICAgICAgICAgIHR5cGU6IEJ1dHRvblR5cGUuY2FuY2VsLFxyXG4gICAgICAgICAgICBjb2xvcjogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBpc09wdGltdW1QYXRoOiBmYWxzZSxcclxuICAgICAgICAgICAgaXNTeXN0ZW1DbG9zZWRQaGFzZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzUmVtb3ZlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzT3BlbjogZmFsc2UsXHJcbiAgICAgICAgICAgIGlzU3RhcnQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBpc1JlcG9ydGFibGU6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXRWYWx1ZS5wdXNoKGNhbmNlbEJ1dHRvbik7XHJcblxyXG4gICAgICAgIHJldHVybiByZXRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCBieSB0aGUgVUkgZnJhbWV3b3JrIGFmdGVyIGluaXRpYWwgY3JlYXRpb24gYW5kIGJpbmRpbmcgdG8gbG9hZCBkYXRhXHJcbiAgICAgKiBpbnRvIGl0J3MgbW9kZWxcclxuICAgICAqL1xyXG4gICAgbG9hZEFuZEJpbmQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJMb2FkIEFuZCBCaW5kXCIpO1xyXG5cclxuICAgICAgICBpZighdGhpcy5zaGFyZWRvVHlwZVN5c3RlbU5hbWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmxvZyhcIk5vIFNoYXJlZG8gVHlwZSBOYW1lXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGdldFBoYXNlUGxhbih0aGlzLnNoYXJlZG9UeXBlU3lzdGVtTmFtZSkudGhlbigocGhhc2VQbGFuKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9nKFwiUGhhc2UgUGxhbiBMb2FkZWRcIixcInJlZFwiLHBoYXNlUGxhbik7XHJcbiAgICAgICAgICAgIHRoaXMucGhhc2VQbGFuKHBoYXNlUGxhbik7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgbG9hZChtb2RlbDogYW55KSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJMb2FkXCIpO1xyXG4gICAgfTsgXHJcblxyXG4gICAgcmVsb2FkKG1vZGVsOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmxvZyhcIlJlbG9hZFwiKTtcclxuICAgIH07XHJcbiAgXHJcbiBcclxuICAgIHNhdmVDbGlja2VkKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG4gICAgfVxyXG5cclxuICAgIHNhdmUoKTogdm9pZCB7XHJcbiAgICAgICAgLy8gLi4uIGFzIGluIHlvdXIgSmF2YVNjcmlwdCBjb2RlXHJcbiAgICB9XHJcblxyXG4gICAgLy8gLi4uIHJlc3Qgb2YgeW91ciBtZXRob2RzIGFzIGluIHlvdXIgSmF2YVNjcmlwdCBjb2RlXHJcblxyXG4gICAgcnVuU2F2ZVdpdGhOb1ZhbGlkYXRpb24oKTogdm9pZCB7XHJcbiAgICAgICAgLy8gLi4uIGFzIGluIHlvdXIgSmF2YVNjcmlwdCBjb2RlXHJcbiAgICB9XHJcblxyXG4gICAgYXJlQWxsQXNwZWN0c0xvYWRlZCgpOiB2b2lkIHtcclxuICAgICAgICAvLyAuLi4gYXMgaW4geW91ciBKYXZhU2NyaXB0IGNvZGVcclxuICAgIH1cclxuXHJcbiAgICBzYXZlQ29tcGxldGVkKCk6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG4gICAgfVxyXG5cclxuICAgIG1vbml0b3JIYW5kbGVycyhpc1NhdmVTdWJtaXRDYW5jZWw/OiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgLy8gLi4uIGFzIGluIHlvdXIgSmF2YVNjcmlwdCBjb2RlIFxyXG4gICAgfVxyXG5cclxuICAgIGFkZFN1YnNjcmlwdGlvbihldmVudE5hbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIC8vIC4uLiBhcyBpbiB5b3VyIEphdmFTY3JpcHQgY29kZVxyXG4gICAgfVxyXG5cclxuICAgIC8vIC4uLiBhbGwgb3RoZXIgbWV0aG9kcyBzaW1pbGFyIHRvIHlvdXIgSmF2YVNjcmlwdCBjb2RlXHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgIGxvZyhtZXNzYWdlOiBzdHJpbmcsIGNvbG9yPzogc3RyaW5nLCBkYXRhPzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuZGVidWc/LmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZGVidWcubG9nVG9Db25zb2xlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJWMgJHt0aGlzV2lkZ2V0U3lzdGVtTmFtZX0gLSAke21lc3NhZ2V9YCwgY29sb3IsIGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYWRkRGVidWdJZlJlcXVpcmVkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsPy5kZWJ1Zz8uZW5hYmxlZCkge1xyXG4gICAgICAgICAgICAod2luZG93IGFzIGFueSkuYXNwZWN0RGVidWcgPSAod2luZG93IGFzIGFueSkuYXNwZWN0RGVidWcgfHwge307XHJcbiAgICAgICAgICAgICh3aW5kb3cgYXMgYW55KS5hc3BlY3REZWJ1Z1t0aGlzV2lkZ2V0U3lzdGVtTmFtZV0gPSB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuXHJcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJnZXRQaGFzZVBsYW4iLCJ3b3JrVHlwZVN5c3RlbU5hbWUiLCJhcGkiLCJtZXRob2QiLCJkYXRhIiwidXJsIiwibG9jYXRpb24iLCJ3aW5kb3ciLCJkb2N1bWVudCIsIm9yaWdpbiIsImluZGV4T2YiLCJ2YWxpZGF0ZUFwaSIsImZldGNoSGVhZGVycyIsImJlYXJlciIsInRva2VuIiwicmV0VmFsdWUiLCJjb29raWUiLCJzcGxpdCIsInJlZHVjZSIsImNvb2tpZXMiLCJwYXJ0cyIsImxlbmd0aCIsInRyaW0iLCJnZXRDb29raWVzIiwiSGVhZGVycyIsImFwcGVuZCIsImJ1aWxkSGVhZGVycyIsImZldGNoIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidW5kZWZpbmVkIiwidGhlbiIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsIkVycm9yIiwianNvbiIsImV4ZWN1dGVGZXRjaCIsImV4ZWN1dGVHZXQiLCJjYXRjaCIsImVycm9yIiwia28iLCJCdXR0b25UeXBlIiwiY29udmVydFRyYW5zaXRpb25Ub0J1dHRvbiIsInRyYW5zaXRpb25zRm9yQnV0dG9ucyIsInBoYXNlUGxhbnMiLCJvcHRpb25zIiwiYnV0dG9ucyIsImkiLCJmb3JFYWNoIiwidHJhbnNpdGlvbiIsInRvUGhhc2UiLCJmaW5kIiwicGhhc2UiLCJzeXN0ZW1OYW1lIiwidG9QaGFzZVN5c3RlbU5hbWUiLCJidXR0b24iLCJpZCIsIm9yZGVyIiwidGV4dCIsIm5hbWUiLCJpY29uIiwiaWNvbkNsYXNzIiwiY29sb3IiLCJjb2xvdXIiLCJlbmFibGVkIiwidmlzaWJsZSIsIm9uQ2xpY2siLCJ0b29sdGlwIiwiZGVzY3JpcHRpb24iLCJ0eXBlIiwiZ2V0QnV0dG9uVHlwZSIsImlzT3B0aW11bVBhdGgiLCJpc1N5c3RlbUNsb3NlZFBoYXNlIiwiaXNSZW1vdmVkIiwiaXNPcGVuIiwiaXNTdGFydCIsImlzUmVwb3J0YWJsZSIsInB1c2giLCJwcmltYXJ5Iiwic2Vjb25kYXJ5IiwiZGVzdHJ1c3RpdmUiLCJ0aGlzV2lkZ2V0U3lzdGVtTmFtZSIsImhlYWQiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJTYXZlU3VibWl0Q2FuY2VsIiwiY29uc3RydWN0b3IiLCJlbGVtZW50IiwiY29uZmlndXJhdGlvbiIsImJhc2VNb2RlbCIsInRoaXMiLCJtb25pdG9ySGFuZGxlcnMiLCJmaXJlZEV2ZW50cyIsIm1vbml0b3JlZEhhbmRsZXJzIiwicmVhZHlGb3JTYXZlIiwiJCIsImV4dGVuZCIsImRlYnVnIiwibG9nVG9Db25zb2xlIiwic2hvd0V2ZW50cyIsInNob3dJbkFzcGVjdCIsImJsYWRlIiwiX2hvc3QiLCJob3N0TW9kZWwiLCJtb2RlbCIsInRpdGxlIiwic2F2ZVJ1bnMiLCJwaGFzZVBsYW4iLCJzdWJzY3JpYmUiLCJoYW5kbGVQaGFzZVBsYW5DaGFuZ2UiLCJiaW5kIiwiaW5zdGFuY2VJZCIsInBhcmVudFNoYXJlZG9JZCIsInRvb2xiYXJDb250ZXh0IiwiYnVyZ2VyQ29udGV4dCIsInNoYXJlZG9JZCIsInJlbG9hZGluZyIsInNoYXJlZG9UeXBlU3lzdGVtTmFtZSIsImN1cnJlbnRQaGFzZVN5c3RlbU5hbWUiLCJwaGFzZVN5c3RlbU5hbWUiLCJhZGREZWJ1Z0lmUmVxdWlyZWQiLCJ0cmFuc2l0aW9ucyIsImZpbHRlciIsInQiLCJmcm9tUGhhc2VTeXN0ZW1OYW1lIiwic3RhcnRQaGFzZSIsInBoYXNlcyIsInAiLCJidXR0b25Hcm91cEVsZW1lbnQiLCJyZW1vdmUiLCJzeXN0ZW1UcmFuc2l0aW9uR3JvdXAiLCJzaG93VGl0bGUiLCJjcmVhdGVTeXN0ZW1CdXR0b25zIiwiYnV0dG9uVHJhbnNpdGlvbkdyb3VwIiwiaXNWYWxpZCIsImJ1dHRvbkdyb3VwcyIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzb3J0IiwiYSIsImIiLCJncm91cCIsImdyb3VwRWxlbWVudCIsImNzc0dyb3VwTmFtZSIsInJlcGxhY2UiLCJ0b2dnbGUiLCJidXR0b25zRWxlbWVudCIsIm5vQnV0dG9ucyIsImlubmVyVGV4dCIsImFwcGVuZENoaWxkIiwiZW5zdXJlQnV0dG9uSWRzIiwibmV3QnV0dG9uRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNhYmxlZCIsInN0eWxlIiwiZGlzcGxheSIsImFwcGx5QnV0dG9uSXNDbGFzc2VzIiwiYm94U2hhZG93IiwiYm94U2hhZG93SG92ZXIiLCJvbm1vdXNlb3ZlciIsIm9ubW91c2VvdXQiLCJhcHBseUJ1dHRvbkVtcGhhc2lzIiwiYnVpbGRCdXR0b25zRWxlbWVudCIsImJ1aWxkQnV0dG9uR3JvdXBFbGVtZW50Iiwic2F2ZVN1Ym1pdENhbmNlbEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2F2ZUJ1dHRvbiIsInNhdmVDbGlja2VkIiwic2F2ZSIsImNhbmNlbEJ1dHRvbiIsImNhbmNlbCIsImxvYWRBbmRCaW5kIiwibG9hZCIsInJlbG9hZCIsInJ1blNhdmVXaXRoTm9WYWxpZGF0aW9uIiwiYXJlQWxsQXNwZWN0c0xvYWRlZCIsInNhdmVDb21wbGV0ZWQiLCJpc1NhdmVTdWJtaXRDYW5jZWwiLCJhZGRTdWJzY3JpcHRpb24iLCJldmVudE5hbWUiLCJtZXNzYWdlIiwiYXNwZWN0RGVidWciXSwic291cmNlUm9vdCI6IiJ9